import{u as H,b as Q,e as k,d as E,A as ee,q as ae,r as p,c as A,o as y,a,w as t,f as l,g as V,h as se,aA as le,aB as te,K as P,i as g,D as O,F as J,v as M,C as oe,M as re,aC as ne,Y as de,E as f,aD as ue,aE as ie,aF as me}from"./index-BsXkJmm5.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R="/assets/avatar1-BbFmvARF.jpg",ce="/assets/avatar2-Bh4bEuay.jpg",fe="/assets/avatar3-BAZJ-hP6.jpg",ve="/assets/avatar4-D21nUqCj.jpg",ge="/assets/avatar5-BX7MIEmt.jpg",_e="/assets/avatar6-BtsMDCIW.jpg",we={class:"profile-page"},be={class:"user-info-section"},Pe={class:"avatar-section"},ye={class:"avatar-container"},Ve={class:"info-section"},Ce={class:"info-header"},Se={class:"title-section"},Ue={class:"role-badge"},ke={class:"action-buttons"},Ae={class:"info-details"},Ne={class:"info-item"},Ie={class:"value"},Be={key:0,class:"info-item"},xe={class:"value"},je={class:"info-item"},De={class:"value"},Ee={key:1,class:"info-item"},he={class:"value"},Fe={class:"info-item"},Oe={class:"value"},Je={class:"preferences-section"},Me={class:"preferences-form"},Re={class:"cover-selection"},ze=["onClick"],$e=["src","alt"],Te={class:"cover-name"},qe={__name:"Profile",setup(Le){const z=H(),r=Q(),N=[{id:1,name:"头像1",url:R},{id:2,name:"头像2",url:ce},{id:3,name:"头像3",url:fe},{id:4,name:"头像4",url:ve},{id:5,name:"头像5",url:ge},{id:6,name:"头像6",url:_e}],x=R,d=k({}),c=E({defaultPage:"dashboard",language:"zh-CN",notifications:!0}),C=k(!1),S=k(!1),I=k(!1),i=E({username:"",email:""}),m=E({oldPassword:"",newPassword:"",confirmPassword:""}),h=k(),$=ee(()=>{const o=[{label:"工作台",value:"dashboard"},{label:"知识库列表",value:"knowledge"}];return(r.tenantSuperAdmin||r.platformAdmin)&&o.push({label:"系统管理中心",value:"system"}),r.platformAdmin&&o.push({label:"租户管理中心",value:"tenant"}),o}),T={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{validator:(o,e,n)=>{e!==m.newPassword?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}]},q=()=>{const o=[];return r.platformAdmin&&o.push("平台管理员"),r.tenantSuperAdmin&&o.push("超级管理员"),o.length===0?"普通用户":o.join("、")},L=async o=>{try{const e=N.find(n=>n.id===o);if(!e){f.error("头像选择失败");return}await me({avatar:o}),d.value.avatar=e.url,d.value.avatarId=o,r.updateUserAvatar(o),I.value=!1,f.success("头像更新成功"),console.log("头像已更新并保存到本地缓存:",{avatarId:o,url:e.url})}catch(e){console.error("更新头像失败:",e),f.error("更新头像失败")}},K=async()=>{try{await de.confirm("确定要退出登录吗？","提示",{type:"warning"}),localStorage.clear(),r.logout(),z.push("/login"),f.success("已退出登录")}catch{}},W=async()=>{try{const o=await ue({email:i.email});d.value.email=i.email;const e=JSON.parse(localStorage.getItem("user")||"{}");e.email=i.email,localStorage.setItem("user",JSON.stringify(e)),r.user&&(r.user.email=i.email),C.value=!1,f.success("信息更新成功"),console.log("用户信息已更新并保存到本地缓存")}catch(o){console.error("更新用户信息失败:",o),f.error("更新用户信息失败")}},X=async()=>{try{await h.value.validate(),await ie({oldPassword:m.oldPassword,newPassword:m.newPassword}),m.oldPassword="",m.newPassword="",m.confirmPassword="",S.value=!1,f.success("密码修改成功")}catch(o){console.error("修改密码失败:",o),f.error("修改密码失败")}},Y=async()=>{try{localStorage.setItem("preferences",JSON.stringify(c)),r.setPreferences(c),f.success("偏好设置保存成功")}catch(o){console.error("保存偏好设置失败:",o),f.error("保存偏好设置失败")}},Z=async()=>{try{const o=JSON.parse(localStorage.getItem("user")||"{}"),e=parseInt(localStorage.getItem("avatar"))||1,n=await ne();let _=x,u=e||n.avatar||1;const w=N.find(B=>B.id===u);_=w?w.url:x,d.value={id:n.id||r.user?.id,username:n.username||r.user?.username||"未知用户",email:o.email||n.email||r.user?.email||"",tenantName:n.tenantName||r.tenantName||"—",knowledgeBaseCount:n.knowledgeBaseCount||0,createTime:n.createTime||"—",roles:n.roles||r.roles||[],avatar:_,avatarId:u},localStorage.setItem("user",JSON.stringify({id:d.value.id,username:d.value.username,email:d.value.email,avatar:u})),localStorage.setItem("avatar",u.toString()),r.updateUserAvatar(u);const b={defaultPage:"dashboard",language:"zh-CN",notifications:!0};Object.assign(c,b),localStorage.setItem("preferences",JSON.stringify(b)),r.setPreferences(b),i.username=d.value.username,i.email=d.value.email}catch(o){console.error("获取用户信息失败，使用本地缓存数据:",o);const e=JSON.parse(localStorage.getItem("user")||"{}"),n=parseInt(localStorage.getItem("avatar"))||1,_=N.find(w=>w.id===n),u=_?_.url:x;d.value={id:e.id||r.user?.id,username:e.username||r.user?.username||"未知用户",email:e.email||r.user?.email||"",tenantName:r.tenantName||"—",knowledgeBaseCount:0,createTime:"—",roles:r.roles||[],avatar:u,avatarId:n},Object.assign(c,{defaultPage:"dashboard",language:"zh-CN",notifications:!0}),i.username=d.value.username,i.email=d.value.email}};return ae(()=>{Z()}),(o,e)=>{const n=p("el-icon"),_=p("el-avatar"),u=p("el-button"),w=p("el-card"),b=p("el-option"),B=p("el-select"),v=p("el-form-item"),F=p("el-radio"),G=p("el-radio-group"),j=p("el-form"),U=p("el-input"),D=p("el-dialog");return y(),A("div",we,[a(w,{class:"profile-card"},{default:t(()=>[l("div",be,[l("div",Pe,[l("div",ye,[a(_,{size:80,src:V(r).userAvatar,class:"user-avatar",onClick:e[0]||(e[0]=s=>I.value=!0)},{default:t(()=>[a(n,null,{default:t(()=>[a(V(se))]),_:1})]),_:1},8,["src"])]),l("div",{class:"logout-link",onClick:K},[a(n,null,{default:t(()=>[a(V(le))]),_:1}),e[16]||(e[16]=l("span",null,"退出账号",-1))])]),l("div",Ve,[l("div",Ce,[l("div",Se,[e[17]||(e[17]=l("h2",null,"用户信息",-1)),l("div",Ue,[a(n,null,{default:t(()=>[a(V(te))]),_:1}),l("span",null,P(q()),1)])]),l("div",ke,[a(u,{type:"primary",onClick:e[1]||(e[1]=s=>C.value=!0)},{default:t(()=>e[18]||(e[18]=[g(" 修改信息 ")])),_:1,__:[18]}),a(u,{type:"primary",onClick:e[2]||(e[2]=s=>S.value=!0)},{default:t(()=>e[19]||(e[19]=[g(" 修改密码 ")])),_:1,__:[19]})])]),l("div",Ae,[l("div",Ne,[e[20]||(e[20]=l("span",{class:"label"},"用户名：",-1)),l("span",Ie,P(d.value.username),1)]),V(r).platformAdmin?O("",!0):(y(),A("div",Be,[e[21]||(e[21]=l("span",{class:"label"},"所属租户：",-1)),l("span",xe,P(d.value.tenantName||"—"),1)])),e[25]||(e[25]=l("div",{class:"info-item"},[l("span",{class:"label"},"密码："),l("span",{class:"value"},"******")],-1)),l("div",je,[e[22]||(e[22]=l("span",{class:"label"},"邮箱：",-1)),l("span",De,P(d.value.email),1)]),V(r).platformAdmin?O("",!0):(y(),A("div",Ee,[e[23]||(e[23]=l("span",{class:"label"},"加入知识库：",-1)),l("span",he,P(d.value.knowledgeBaseCount||0)+"个 ",1)])),l("div",Fe,[e[24]||(e[24]=l("span",{class:"label"},"加入时间：",-1)),l("span",Oe,P(d.value.createTime||"—"),1)])])])])]),_:1}),a(w,{class:"preferences-card"},{default:t(()=>[l("div",Je,[e[29]||(e[29]=l("h3",null,"偏好设置",-1)),l("div",Me,[a(j,{model:c,"label-width":"120px"},{default:t(()=>[a(v,{label:"默认进入页面："},{default:t(()=>[a(B,{modelValue:c.defaultPage,"onUpdate:modelValue":e[3]||(e[3]=s=>c.defaultPage=s),placeholder:"请选择默认页面"},{default:t(()=>[(y(!0),A(J,null,M($.value,s=>(y(),oe(b,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"系统语言："},{default:t(()=>[a(B,{modelValue:c.language,"onUpdate:modelValue":e[4]||(e[4]=s=>c.language=s),placeholder:"请选择语言"},{default:t(()=>[a(b,{label:"中文",value:"zh-CN"}),a(b,{label:"English",value:"en-US"})]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"接收通知："},{default:t(()=>[a(G,{modelValue:c.notifications,"onUpdate:modelValue":e[5]||(e[5]=s=>c.notifications=s)},{default:t(()=>[a(F,{value:!0},{default:t(()=>e[26]||(e[26]=[g("开启")])),_:1,__:[26]}),a(F,{value:!1},{default:t(()=>e[27]||(e[27]=[g("关闭")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:t(()=>[a(u,{type:"primary",onClick:Y},{default:t(()=>e[28]||(e[28]=[g("保存设置")])),_:1,__:[28]})]),_:1})]),_:1},8,["model"])])])]),_:1}),a(D,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=s=>C.value=s),title:"修改信息",width:"500px"},{footer:t(()=>[a(u,{onClick:e[8]||(e[8]=s=>C.value=!1)},{default:t(()=>e[30]||(e[30]=[g("取消")])),_:1,__:[30]}),a(u,{type:"primary",onClick:W},{default:t(()=>e[31]||(e[31]=[g("确定")])),_:1,__:[31]})]),default:t(()=>[a(j,{model:i,"label-width":"100px"},{default:t(()=>[a(v,{label:"用户名"},{default:t(()=>[a(U,{modelValue:i.username,"onUpdate:modelValue":e[6]||(e[6]=s=>i.username=s),disabled:""},null,8,["modelValue"])]),_:1}),a(v,{label:"邮箱"},{default:t(()=>[a(U,{modelValue:i.email,"onUpdate:modelValue":e[7]||(e[7]=s=>i.email=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(D,{modelValue:S.value,"onUpdate:modelValue":e[14]||(e[14]=s=>S.value=s),title:"修改密码",width:"500px"},{footer:t(()=>[a(u,{onClick:e[13]||(e[13]=s=>S.value=!1)},{default:t(()=>e[32]||(e[32]=[g("取消")])),_:1,__:[32]}),a(u,{type:"primary",onClick:X},{default:t(()=>e[33]||(e[33]=[g("确定")])),_:1,__:[33]})]),default:t(()=>[a(j,{model:m,"label-width":"100px",rules:T,ref_key:"passwordFormRef",ref:h},{default:t(()=>[a(v,{label:"原密码",prop:"oldPassword"},{default:t(()=>[a(U,{modelValue:m.oldPassword,"onUpdate:modelValue":e[10]||(e[10]=s=>m.oldPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(v,{label:"新密码",prop:"newPassword"},{default:t(()=>[a(U,{modelValue:m.newPassword,"onUpdate:modelValue":e[11]||(e[11]=s=>m.newPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(v,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[a(U,{modelValue:m.confirmPassword,"onUpdate:modelValue":e[12]||(e[12]=s=>m.confirmPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(D,{modelValue:I.value,"onUpdate:modelValue":e[15]||(e[15]=s=>I.value=s),title:"选择头像",width:"400px"},{default:t(()=>[l("div",Re,[(y(),A(J,null,M(N,s=>l("div",{key:s.id,class:re(["cover-item",{selected:d.value.avatarId===s.id}]),onClick:Ke=>L(s.id)},[l("img",{src:s.url,alt:s.name,class:"cover-image"},null,8,$e),l("div",Te,P(s.name),1)],10,ze)),64))])]),_:1},8,["modelValue"])])}}},Ye=pe(qe,[["__scopeId","data-v-33bdd0fa"]]);export{Ye as default};
