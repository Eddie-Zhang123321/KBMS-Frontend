import{Z as G,$ as Y,Y as Z,e as n,d as Q,r,p as P,o as I,w as t,a as e,f as K,i as y,E as T,B as F,K as z,G as D,ar as W,z as X,c as N,F as S,C as q}from"./index-CxOdaYXd.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee=b=>G("/role/items",b),le=b=>G("/role",b),te=b=>Z(`/role/${b}/permissions`),oe=(b,c)=>Y(`/role/${b}/permissions`,c),ae=b=>Z(`/role/${b}/assignees`),se=(b,c)=>Y(`/role/${b}/assignees`,c),ne={class:"dialog-footer"},ue={__name:"CreateRole",emits:["success"],setup(b,{expose:c,emit:g}){const o=n(!1),u=n(!1),i=Q({name:"",description:"",type:""}),w={name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:2,max:32,message:"长度在 2 到 32 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"},{min:2,max:200,message:"长度在 2 到 200 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择角色类型",trigger:"change"}]},d=n(null),_=()=>{o.value=!0},v=()=>{d.value?.resetFields(),o.value=!1},V=async()=>{try{u.value=!0,await d.value.validate(),await le({...i}),T.success("创建成功"),v(),A("success")}catch(C){C&&T.error(C.message||"创建失败")}finally{u.value=!1}},A=g;return c({open:_}),(C,f)=>{const M=r("el-input"),m=r("el-form-item"),a=r("el-option"),p=r("el-select"),x=r("el-form"),k=r("el-button"),s=r("el-dialog");return I(),P(s,{modelValue:o.value,"onUpdate:modelValue":f[3]||(f[3]=l=>o.value=l),title:"新建角色",width:"520px","before-close":v},{footer:t(()=>[K("span",ne,[e(k,{onClick:v},{default:t(()=>f[4]||(f[4]=[y("取消")])),_:1,__:[4]}),e(k,{type:"primary",onClick:V,loading:u.value},{default:t(()=>f[5]||(f[5]=[y("确定")])),_:1,__:[5]},8,["loading"])])]),default:t(()=>[e(x,{ref_key:"formRef",ref:d,model:i,rules:w,"label-width":"96px","label-position":"right"},{default:t(()=>[e(m,{label:"角色名",prop:"name"},{default:t(()=>[e(M,{modelValue:i.name,"onUpdate:modelValue":f[0]||(f[0]=l=>i.name=l),placeholder:"请输入角色名",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{label:"描述",prop:"description"},{default:t(()=>[e(M,{modelValue:i.description,"onUpdate:modelValue":f[1]||(f[1]=l=>i.description=l),placeholder:"请输入描述",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(m,{label:"角色类型",prop:"type"},{default:t(()=>[e(p,{modelValue:i.type,"onUpdate:modelValue":f[2]||(f[2]=l=>i.type=l),placeholder:"请选择角色类型",style:{width:"100%"}},{default:t(()=>[e(a,{label:"平台级",value:"platform"}),e(a,{label:"知识库级",value:"kb"}),e(a,{label:"普通级",value:"normal"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},re=B(ue,[["__scopeId","data-v-820b63de"]]),ie={class:"dialog-footer"},de={__name:"RoleInfo",setup(b,{expose:c}){const g=n(!1),o=n(null),u=w=>{o.value=w,g.value=!0},i=()=>{g.value=!1};return c({open:u}),(w,d)=>{const _=r("el-descriptions-item"),v=r("el-descriptions"),V=r("el-button"),A=r("el-dialog");return I(),P(A,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=C=>g.value=C),title:`角色信息 - ${o.value?.name||""}`,width:"560px","before-close":i},{footer:t(()=>[K("span",ie,[e(V,{onClick:i},{default:t(()=>d[1]||(d[1]=[y("关闭")])),_:1,__:[1]})])]),default:t(()=>[e(v,{column:1,border:""},{default:t(()=>[e(_,{label:"角色名"},{default:t(()=>[y(F(o.value?.name),1)]),_:1}),e(_,{label:"描述"},{default:t(()=>[y(F(o.value?.description),1)]),_:1}),e(_,{label:"角色类型"},{default:t(()=>[y(F(o.value?.typeLabel),1)]),_:1}),e(_,{label:"用户数"},{default:t(()=>[y(F(o.value?.userCount),1)]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}},ce=B(de,[["__scopeId","data-v-cbb97089"]]),pe={class:"dialog-footer"},me={__name:"RolePermissions",emits:["success"],setup(b,{expose:c,emit:g}){const o=n(!1),u=n(null),i=n(!1),w=n(!1),d=n([]),_=n([]),v=async m=>{u.value=m,o.value=!0,await A()},V=()=>{o.value=!1,u.value=null,d.value=[],_.value=[]},A=async()=>{try{i.value=!0;const m=await te(u.value.id||u.value.key);d.value=m.tree||[],_.value=m.checkedKeys||[]}catch{d.value=[{id:"sys",label:"系统管理",children:[{id:"sys.users",label:"用户管理"},{id:"sys.roles",label:"角色管理"},{id:"sys.logs",label:"系统日志"}]},{id:"kb",label:"知识库",children:[{id:"kb.view",label:"查看"},{id:"kb.edit",label:"编辑"}]}],_.value=[]}finally{i.value=!1}},C=(m,a)=>{},f=async()=>{try{w.value=!0;const m=u.value.id||u.value.key;await oe(m,{checkedKeys:_.value}),T.success("保存成功"),V(),M("success")}catch(m){T.error(m?.message||"保存失败")}finally{w.value=!1}},M=g;return c({open:v}),(m,a)=>{const p=r("el-tree"),x=r("el-button"),k=r("el-dialog"),s=z("loading");return I(),P(k,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=l=>o.value=l),title:`角色权限 - ${u.value?.name||""}`,width:"720px","before-close":V},{footer:t(()=>[K("span",pe,[e(x,{onClick:V},{default:t(()=>a[1]||(a[1]=[y("取消")])),_:1,__:[1]}),e(x,{type:"primary",onClick:f,loading:w.value},{default:t(()=>a[2]||(a[2]=[y("保存")])),_:1,__:[2]},8,["loading"])])]),default:t(()=>[D(e(p,{data:d.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":_.value,onCheckChange:C},null,8,["data","default-checked-keys"]),[[s,i.value]])]),_:1},8,["modelValue","title"])}}},_e=B(me,[["__scopeId","data-v-dc6b9441"]]),ve={class:"toolbar"},fe={__name:"RoleAssignees",emits:["success"],setup(b,{expose:c,emit:g}){const o=n(!1),u=n(null),i=n(!1),w=n(!1),d=n(""),_=n([]),v=n([]),V=async a=>{u.value=a,o.value=!0,await C()},A=()=>{o.value=!1,u.value=null,_.value=[],v.value=[],d.value=""},C=async()=>{try{i.value=!0;const a=await W({page:1,size:9999}),p=a.items||a.list||a.data?.items||[];_.value=p.map(k=>({id:k.id||k.userId,label:k.username||k.name}));const x=await ae(u.value.id||u.value.key);v.value=x.userIds||[]}catch{_.value=[{id:"u1",label:"Alice"},{id:"u2",label:"Bob"},{id:"u3",label:"Carol"}],v.value=["u2"]}finally{i.value=!1}},f=(a,p)=>a?p.label.toLowerCase().includes(a.toLowerCase()):!0,M=async()=>{try{w.value=!0,await se(u.value.id||u.value.key,{userIds:v.value}),T.success("保存成功"),m("success"),A()}catch(a){T.error(a?.message||"保存失败")}finally{w.value=!1}},m=g;return c({open:V}),(a,p)=>{const x=r("el-input"),k=r("el-button"),s=r("el-transfer"),l=r("el-dialog"),h=z("loading");return I(),P(l,{modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=$=>o.value=$),title:`授权人 - ${u.value?.name||""}`,width:"720px","before-close":A},{default:t(()=>[K("div",ve,[e(x,{modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=$=>d.value=$),placeholder:"搜索用户",clearable:"",style:{width:"260px"}},null,8,["modelValue"]),p[4]||(p[4]=K("div",{class:"spacer"},null,-1)),e(k,{type:"primary",onClick:M,loading:w.value},{default:t(()=>p[3]||(p[3]=[y("保存")])),_:1,__:[3]},8,["loading"])]),D(e(s,{modelValue:v.value,"onUpdate:modelValue":p[1]||(p[1]=$=>v.value=$),filterable:"","filter-method":f,titles:["待选用户","已授权"],data:_.value,props:{key:"id",label:"label"}},null,8,["modelValue","data"]),[[h,i.value]])]),_:1},8,["modelValue","title"])}}},be=B(fe,[["__scopeId","data-v-ac03e5fa"]]),ye={class:"role-management"},ge={class:"table-header"},ke={class:"actions"},Re={__name:"RoleManagement",setup(b){const c={PLATFORM:"platform",KB:"kb",NORMAL:"normal"},g={[c.PLATFORM]:"平台级",[c.KB]:"知识库级",[c.NORMAL]:"普通级"},o=n({roleKey:"",roleType:""}),u=n(!1),i=n([]),w=[{value:c.PLATFORM,label:g[c.PLATFORM]},{value:c.KB,label:g[c.KB]},{value:c.NORMAL,label:g[c.NORMAL]}],d=n([]),_=s=>{const l=s.id||s.key||s.roleId||s.name,h=s.type;return{id:l,key:s.key||s.id||l,name:s.name,description:s.description,type:h,typeLabel:s.typeLabel||g[h]||"",userCount:s.userCount??0}},v=async()=>{u.value=!0;const s={roleKey:o.value.roleKey||void 0,roleType:o.value.roleType||void 0,page:1,size:50};try{const l=await ee(s),h=l.items||l.list||[];d.value=h.map(_);const $=new Map;d.value.forEach(L=>{L.key&&L.name&&$.set(L.key,{value:L.key,label:L.name})}),i.value=Array.from($.values())}catch{T.error("获取角色列表失败，请稍后再试。"),d.value=[]}finally{u.value=!1}},V=()=>{o.value={roleKey:"",roleType:""},v()},A=()=>{m.value?.open()},C=s=>{a.value?.open(s)},f=s=>{p.value?.open(s)},M=s=>{x.value?.open(s)},m=n(null),a=n(null),p=n(null),x=n(null),k=()=>{v()};return X(()=>{v()}),(s,l)=>{const h=r("el-option"),$=r("el-select"),L=r("el-col"),U=r("el-button"),j=r("el-row"),O=r("el-table-column"),H=r("el-table"),J=z("loading");return I(),N("div",ye,[e(j,{gutter:16,class:"filter-row"},{default:t(()=>[e(L,{span:6,xs:24,sm:12,lg:6},{default:t(()=>[e($,{modelValue:o.value.roleKey,"onUpdate:modelValue":l[0]||(l[0]=R=>o.value.roleKey=R),placeholder:"选择角色",clearable:"",style:{width:"100%"}},{default:t(()=>[e(h,{label:"全部角色",value:""}),(I(!0),N(S,null,q(i.value,R=>(I(),P(h,{key:R.value,label:R.label,value:R.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(L,{span:6,xs:24,sm:12,lg:6},{default:t(()=>[e($,{modelValue:o.value.roleType,"onUpdate:modelValue":l[1]||(l[1]=R=>o.value.roleType=R),placeholder:"选择角色类型",clearable:"",style:{width:"100%"}},{default:t(()=>[e(h,{label:"全部类型",value:""}),(I(),N(S,null,q(w,R=>e(h,{key:R.value,label:R.label,value:R.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(L,{span:12,xs:24,sm:24,lg:12,class:"text-right"},{default:t(()=>[e(U,{type:"primary",onClick:v},{default:t(()=>l[2]||(l[2]=[y("查询")])),_:1,__:[2]}),e(U,{onClick:V},{default:t(()=>l[3]||(l[3]=[y("重置")])),_:1,__:[3]})]),_:1})]),_:1}),K("div",ge,[l[5]||(l[5]=K("div",{class:"title"},"角色列表",-1)),K("div",ke,[e(U,{type:"primary",onClick:A},{default:t(()=>l[4]||(l[4]=[y("新建角色")])),_:1,__:[4]})])]),D((I(),P(H,{data:d.value,style:{width:"100%"},stripe:""},{default:t(()=>[e(O,{prop:"name",label:"角色名",width:"180"}),e(O,{prop:"description",label:"描述","min-width":"240","show-overflow-tooltip":""}),e(O,{prop:"typeLabel",label:"角色类型",width:"140"}),e(O,{prop:"userCount",label:"用户数",width:"100"}),e(O,{label:"操作",width:"260",fixed:"right"},{default:t(({row:R})=>[e(U,{size:"small",onClick:E=>C(R)},{default:t(()=>l[6]||(l[6]=[y("角色信息")])),_:2,__:[6]},1032,["onClick"]),e(U,{size:"small",onClick:E=>f(R),type:"primary",plain:""},{default:t(()=>l[7]||(l[7]=[y("角色权限")])),_:2,__:[7]},1032,["onClick"]),e(U,{size:"small",onClick:E=>M(R),type:"success",plain:""},{default:t(()=>l[8]||(l[8]=[y("授权人")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,u.value]]),e(re,{ref_key:"createRoleRef",ref:m,onSuccess:k},null,512),e(ce,{ref_key:"roleInfoRef",ref:a},null,512),e(_e,{ref_key:"rolePermRef",ref:p,onSuccess:k},null,512),e(be,{ref_key:"roleAssigneesRef",ref:x,onSuccess:k},null,512)])}}},Ce=B(Re,[["__scopeId","data-v-3e8ba76e"]]);export{Ce as default};
