import{u as le,b as te,e as y,d as j,m as oe,z as re,r as i,c as J,o as A,a,w as l,f as t,g as B,h as ne,an as de,ao as ie,B as V,i as _,F as z,C as R,p as ue,G as me,ap as ce,aq as pe,L as fe,E as g,ar as ve,as as ge,at as _e,au as we,av as be}from"./index-D3azu4XD.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T="/assets/avatar1-qFp4KDU7.jpg",ye="/assets/avatar2-Bh4bEuay.jpg",Ve="/assets/avatar1-qFp4KDU7.jpg",Ue="/assets/avatar1-qFp4KDU7.jpg",Se="/assets/avatar1-qFp4KDU7.jpg",ke="/assets/avatar1-qFp4KDU7.jpg",Ce={class:"profile-page"},Ne={class:"user-info-section"},Ie={class:"avatar-section"},he={class:"avatar-container"},Ae={class:"info-section"},Be={class:"info-header"},xe={class:"title-section"},Oe={class:"role-badge"},De={class:"action-buttons"},Fe={class:"info-details"},je={class:"info-item"},Je={class:"value"},qe={class:"info-item"},Ee={class:"value"},Ke={class:"info-item"},ze={class:"value"},Re={class:"info-item"},Te={class:"value"},$e={class:"info-item"},Me={class:"value"},Le={class:"preferences-section"},Ge={class:"preferences-form"},He={class:"cover-selection"},Qe=["onClick"],We=["src","alt"],Xe={class:"cover-name"},Ye={__name:"Profile",setup(Ze){const $=le(),r=te(),N=[{id:1,name:"头像1",url:T},{id:2,name:"头像2",url:ye},{id:3,name:"头像3",url:Ve},{id:4,name:"头像4",url:Ue},{id:5,name:"头像5",url:Se},{id:6,name:"头像6",url:ke}],x=T,n=y({}),u=j({defaultPage:"dashboard",language:"zh-CN",notifications:!0}),S=y(!1),k=y(!1),O=y(!1),I=y(!1),m=j({username:"",email:""}),c=j({oldPassword:"",newPassword:"",confirmPassword:""}),q=y(),E=y([]),M=oe(()=>{const o=[{label:"工作台",value:"dashboard"},{label:"知识库列表",value:"knowledge"}];return(r.tenantSuperAdmin||r.platformAdmin)&&o.push({label:"系统管理中心",value:"system"}),r.platformAdmin&&o.push({label:"租户管理中心",value:"tenant"}),o}),L={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{validator:(o,e,d)=>{e!==c.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]},G=()=>{const o=[];return r.platformAdmin&&o.push("平台管理员"),r.tenantSuperAdmin&&o.push("超级管理员"),o.length===0?"普通用户":o.join("、")},H=async o=>{try{const e=N.find(d=>d.id===o);if(!e){g.error("头像选择失败");return}await be({avatar:o}),n.value.avatar=e.url,n.value.avatarId=o,r.updateUserAvatar(o),I.value=!1,g.success("头像更新成功"),console.log("头像已更新并保存到本地缓存:",{avatarId:o,url:e.url})}catch(e){console.error("更新头像失败:",e),g.error("更新头像失败")}},Q=async()=>{try{await fe.confirm("确定要退出登录吗？","提示",{type:"warning"}),localStorage.clear(),r.logout(),$.push("/login"),g.success("已退出登录")}catch{}},W=async()=>{try{const o=await _e({email:m.email});n.value.email=m.email;const e=JSON.parse(localStorage.getItem("user")||"{}");e.email=m.email,localStorage.setItem("user",JSON.stringify(e)),r.user&&(r.user.email=m.email),S.value=!1,g.success("信息更新成功"),console.log("用户信息已更新并保存到本地缓存")}catch(o){console.error("更新用户信息失败:",o),g.error("更新用户信息失败")}},X=async()=>{try{await q.value.validate(),await we({oldPassword:c.oldPassword,newPassword:c.newPassword}),c.oldPassword="",c.newPassword="",c.confirmPassword="",k.value=!1,g.success("密码修改成功")}catch(o){console.error("修改密码失败:",o),g.error("修改密码失败")}},Y=async()=>{try{const o=await ge(u);localStorage.setItem("preferences",JSON.stringify(u)),r.setPreferences(u),g.success("偏好设置保存成功")}catch(o){console.error("保存偏好设置失败:",o),g.error("保存偏好设置失败")}},Z=async()=>{try{const o=await ve();E.value=o||[],O.value=!0}catch(o){console.error("获取知识库列表失败:",o),g.error("获取知识库列表失败")}},ee=async()=>{try{const o=JSON.parse(localStorage.getItem("user")||"{}"),e=JSON.parse(localStorage.getItem("preferences")||"{}"),d=parseInt(localStorage.getItem("avatar"))||1,p=await ce();let f=x,w=d||p.avatar||1;const P=N.find(v=>v.id===w);f=P?P.url:x,n.value={id:p.id||r.user?.id,username:p.username||r.user?.username||"未知用户",email:o.email||p.email||r.user?.email||"",tenantName:p.tenantName||r.tenantName||"—",knowledgeBaseCount:p.knowledgeBaseCount||0,createTime:p.createTime||"—",roles:p.roles||r.roles||[],avatar:f,avatarId:w},localStorage.setItem("user",JSON.stringify({id:n.value.id,username:n.value.username,email:n.value.email,avatar:w})),localStorage.setItem("avatar",w.toString()),r.updateUserAvatar(w);try{const v=await pe();Object.assign(u,v),localStorage.setItem("preferences",JSON.stringify(v)),r.setPreferences(v)}catch(v){console.warn("Failed to fetch preferences, using cached or default:",v);const U={defaultPage:e.defaultPage||"dashboard",language:e.language||"zh-CN",notifications:e.notifications!==void 0?e.notifications:!0};Object.assign(u,U),localStorage.setItem("preferences",JSON.stringify(U)),r.setPreferences(U)}m.username=n.value.username,m.email=n.value.email}catch(o){console.error("获取用户信息失败，使用本地缓存数据:",o);const e=JSON.parse(localStorage.getItem("user")||"{}"),d=JSON.parse(localStorage.getItem("preferences")||"{}"),p=parseInt(localStorage.getItem("avatar"))||1,f=N.find(P=>P.id===p),w=f?f.url:x;n.value={id:e.id||r.user?.id,username:e.username||r.user?.username||"未知用户",email:e.email||r.user?.email||"",tenantName:r.tenantName||"—",knowledgeBaseCount:0,createTime:"—",roles:r.roles||[],avatar:w,avatarId:p},Object.assign(u,{defaultPage:d.defaultPage||"dashboard",language:d.language||"zh-CN",notifications:d.notifications!==void 0?d.notifications:!0}),m.username=n.value.username,m.email=n.value.email}};return re(()=>{ee()}),(o,e)=>{const d=i("el-icon"),p=i("el-avatar"),f=i("el-button"),w=i("el-link"),P=i("el-card"),v=i("el-option"),U=i("el-select"),b=i("el-form-item"),K=i("el-radio"),ae=i("el-radio-group"),D=i("el-form"),C=i("el-input"),h=i("el-dialog"),F=i("el-table-column"),se=i("el-table");return A(),J("div",Ce,[a(P,{class:"profile-card"},{default:l(()=>[t("div",Ne,[t("div",Ie,[t("div",he,[a(p,{size:80,src:B(r).userAvatar,class:"user-avatar",onClick:e[0]||(e[0]=s=>I.value=!0)},{default:l(()=>[a(d,null,{default:l(()=>[a(B(ne))]),_:1})]),_:1},8,["src"])]),t("div",{class:"logout-link",onClick:Q},[a(d,null,{default:l(()=>[a(B(de))]),_:1}),e[17]||(e[17]=t("span",null,"退出账号",-1))])]),t("div",Ae,[t("div",Be,[t("div",xe,[e[18]||(e[18]=t("h2",null,"用户信息",-1)),t("div",Oe,[a(d,null,{default:l(()=>[a(B(ie))]),_:1}),t("span",null,V(G()),1)])]),t("div",De,[a(f,{type:"primary",onClick:e[1]||(e[1]=s=>S.value=!0)},{default:l(()=>e[19]||(e[19]=[_(" 修改信息 ")])),_:1,__:[19]}),a(f,{type:"primary",onClick:e[2]||(e[2]=s=>k.value=!0)},{default:l(()=>e[20]||(e[20]=[_(" 修改密码 ")])),_:1,__:[20]})])]),t("div",Fe,[t("div",je,[e[21]||(e[21]=t("span",{class:"label"},"用户名：",-1)),t("span",Je,V(n.value.username),1)]),t("div",qe,[e[22]||(e[22]=t("span",{class:"label"},"所属租户：",-1)),t("span",Ee,V(n.value.tenantName||"—"),1)]),e[26]||(e[26]=t("div",{class:"info-item"},[t("span",{class:"label"},"密码："),t("span",{class:"value"},"******")],-1)),t("div",Ke,[e[23]||(e[23]=t("span",{class:"label"},"邮箱：",-1)),t("span",ze,V(n.value.email),1)]),t("div",Re,[e[24]||(e[24]=t("span",{class:"label"},"加入知识库：",-1)),t("span",Te,[a(w,{type:"primary",onClick:Z},{default:l(()=>[_(V(n.value.knowledgeBaseCount||0)+"个 ",1)]),_:1})])]),t("div",$e,[e[25]||(e[25]=t("span",{class:"label"},"加入时间：",-1)),t("span",Me,V(n.value.createTime||"—"),1)])])])])]),_:1}),a(P,{class:"preferences-card"},{default:l(()=>[t("div",Le,[e[30]||(e[30]=t("h3",null,"偏好设置",-1)),t("div",Ge,[a(D,{model:u,"label-width":"120px"},{default:l(()=>[a(b,{label:"默认进入页面："},{default:l(()=>[a(U,{modelValue:u.defaultPage,"onUpdate:modelValue":e[3]||(e[3]=s=>u.defaultPage=s),placeholder:"请选择默认页面"},{default:l(()=>[(A(!0),J(z,null,R(M.value,s=>(A(),ue(v,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"系统语言："},{default:l(()=>[a(U,{modelValue:u.language,"onUpdate:modelValue":e[4]||(e[4]=s=>u.language=s),placeholder:"请选择语言"},{default:l(()=>[a(v,{label:"中文",value:"zh-CN"}),a(v,{label:"English",value:"en-US"})]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"接收通知："},{default:l(()=>[a(ae,{modelValue:u.notifications,"onUpdate:modelValue":e[5]||(e[5]=s=>u.notifications=s)},{default:l(()=>[a(K,{value:!0},{default:l(()=>e[27]||(e[27]=[_("开启")])),_:1,__:[27]}),a(K,{value:!1},{default:l(()=>e[28]||(e[28]=[_("关闭")])),_:1,__:[28]})]),_:1},8,["modelValue"])]),_:1}),a(b,null,{default:l(()=>[a(f,{type:"primary",onClick:Y},{default:l(()=>e[29]||(e[29]=[_("保存设置")])),_:1,__:[29]})]),_:1})]),_:1},8,["model"])])])]),_:1}),a(h,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=s=>S.value=s),title:"修改信息",width:"500px"},{footer:l(()=>[a(f,{onClick:e[8]||(e[8]=s=>S.value=!1)},{default:l(()=>e[31]||(e[31]=[_("取消")])),_:1,__:[31]}),a(f,{type:"primary",onClick:W},{default:l(()=>e[32]||(e[32]=[_("确定")])),_:1,__:[32]})]),default:l(()=>[a(D,{model:m,"label-width":"100px"},{default:l(()=>[a(b,{label:"用户名"},{default:l(()=>[a(C,{modelValue:m.username,"onUpdate:modelValue":e[6]||(e[6]=s=>m.username=s),disabled:""},null,8,["modelValue"])]),_:1}),a(b,{label:"邮箱"},{default:l(()=>[a(C,{modelValue:m.email,"onUpdate:modelValue":e[7]||(e[7]=s=>m.email=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(h,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=s=>k.value=s),title:"修改密码",width:"500px"},{footer:l(()=>[a(f,{onClick:e[13]||(e[13]=s=>k.value=!1)},{default:l(()=>e[33]||(e[33]=[_("取消")])),_:1,__:[33]}),a(f,{type:"primary",onClick:X},{default:l(()=>e[34]||(e[34]=[_("确定")])),_:1,__:[34]})]),default:l(()=>[a(D,{model:c,"label-width":"100px",rules:L,ref_key:"passwordFormRef",ref:q},{default:l(()=>[a(b,{label:"原密码",prop:"oldPassword"},{default:l(()=>[a(C,{modelValue:c.oldPassword,"onUpdate:modelValue":e[10]||(e[10]=s=>c.oldPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(b,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(C,{modelValue:c.newPassword,"onUpdate:modelValue":e[11]||(e[11]=s=>c.newPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(b,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(C,{modelValue:c.confirmPassword,"onUpdate:modelValue":e[12]||(e[12]=s=>c.confirmPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(h,{modelValue:O.value,"onUpdate:modelValue":e[15]||(e[15]=s=>O.value=s),title:"加入的知识库",width:"600px"},{default:l(()=>[a(se,{data:E.value,style:{width:"100%"}},{default:l(()=>[a(F,{prop:"name",label:"知识库名称"}),a(F,{prop:"role",label:"角色"}),a(F,{prop:"createTime",label:"加入时间"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),a(h,{modelValue:I.value,"onUpdate:modelValue":e[16]||(e[16]=s=>I.value=s),title:"选择头像",width:"400px"},{default:l(()=>[t("div",He,[(A(),J(z,null,R(N,s=>t("div",{key:s.id,class:me(["cover-item",{selected:n.value.avatarId===s.id}]),onClick:ea=>H(s.id)},[t("img",{src:s.url,alt:s.name,class:"cover-image"},null,8,We),t("div",Xe,V(s.name),1)],10,Qe)),64))])]),_:1},8,["modelValue"])])}}},la=Pe(Ye,[["__scopeId","data-v-bb803b25"]]);export{la as default};
