import{X as H,Z as W,W as X,e as u,d as Q,r as n,p as P,o as I,w as t,a as e,f as L,i as k,E as M,B,H as Z,I as j,am as Y,m as S,z as ee,c as N,F as E,C as q}from"./index-D3azu4XD.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le=b=>H("/role/items",b),te=b=>H("/role",b),oe=b=>X(`/role/${b}/permissions`),ae=(b,i)=>W(`/role/${b}/permissions`,i),se=b=>X(`/role/${b}/assignees`),ne=(b,i)=>W(`/role/${b}/assignees`,i),ue={class:"dialog-footer"},re={__name:"CreateRole",emits:["success"],setup(b,{expose:i,emit:R}){const o=u(!1),r=u(!1),d=Q({name:"",description:"",type:""}),f={name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:2,max:32,message:"长度在 2 到 32 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"},{min:2,max:200,message:"长度在 2 到 200 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择角色类型",trigger:"change"}]},m=u(null),c=()=>{o.value=!0},g=()=>{m.value?.resetFields(),o.value=!1},C=async()=>{try{r.value=!0,await m.value.validate(),await te({...d}),M.success("创建成功"),g(),A("success")}catch(x){x&&M.error(x.message||"创建失败")}finally{r.value=!1}},A=R;return i({open:c}),(x,v)=>{const $=n("el-input"),_=n("el-form-item"),s=n("el-option"),p=n("el-select"),h=n("el-form"),V=n("el-button"),T=n("el-dialog");return I(),P(T,{modelValue:o.value,"onUpdate:modelValue":v[3]||(v[3]=l=>o.value=l),title:"新建角色",width:"520px","before-close":g},{footer:t(()=>[L("span",ue,[e(V,{onClick:g},{default:t(()=>v[4]||(v[4]=[k("取消")])),_:1,__:[4]}),e(V,{type:"primary",onClick:C,loading:r.value},{default:t(()=>v[5]||(v[5]=[k("确定")])),_:1,__:[5]},8,["loading"])])]),default:t(()=>[e(h,{ref_key:"formRef",ref:m,model:d,rules:f,"label-width":"96px","label-position":"right"},{default:t(()=>[e(_,{label:"角色名",prop:"name"},{default:t(()=>[e($,{modelValue:d.name,"onUpdate:modelValue":v[0]||(v[0]=l=>d.name=l),placeholder:"请输入角色名",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{label:"描述",prop:"description"},{default:t(()=>[e($,{modelValue:d.description,"onUpdate:modelValue":v[1]||(v[1]=l=>d.description=l),placeholder:"请输入描述",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(_,{label:"角色类型",prop:"type"},{default:t(()=>[e(p,{modelValue:d.type,"onUpdate:modelValue":v[2]||(v[2]=l=>d.type=l),placeholder:"请选择角色类型",style:{width:"100%"}},{default:t(()=>[e(s,{label:"平台级",value:"platform"}),e(s,{label:"知识库级",value:"kb"}),e(s,{label:"普通级",value:"normal"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},ie=O(re,[["__scopeId","data-v-820b63de"]]),de={class:"dialog-footer"},ce={__name:"RoleInfo",setup(b,{expose:i}){const R=u(!1),o=u(null),r=f=>{o.value=f,R.value=!0},d=()=>{R.value=!1};return i({open:r}),(f,m)=>{const c=n("el-descriptions-item"),g=n("el-descriptions"),C=n("el-button"),A=n("el-dialog");return I(),P(A,{modelValue:R.value,"onUpdate:modelValue":m[0]||(m[0]=x=>R.value=x),title:`角色信息 - ${o.value?.name||""}`,width:"560px","before-close":d},{footer:t(()=>[L("span",de,[e(C,{onClick:d},{default:t(()=>m[1]||(m[1]=[k("关闭")])),_:1,__:[1]})])]),default:t(()=>[e(g,{column:1,border:""},{default:t(()=>[e(c,{label:"角色名"},{default:t(()=>[k(B(o.value?.name),1)]),_:1}),e(c,{label:"描述"},{default:t(()=>[k(B(o.value?.description),1)]),_:1}),e(c,{label:"角色类型"},{default:t(()=>[k(B(o.value?.typeLabel),1)]),_:1}),e(c,{label:"用户数"},{default:t(()=>[k(B(o.value?.userCount),1)]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}},pe=O(ce,[["__scopeId","data-v-cbb97089"]]),me={class:"dialog-footer"},_e={__name:"RolePermissions",emits:["success"],setup(b,{expose:i,emit:R}){const o=u(!1),r=u(null),d=u(!1),f=u(!1),m=u([]),c=u([]),g=async _=>{r.value=_,o.value=!0,await A()},C=()=>{o.value=!1,r.value=null,m.value=[],c.value=[]},A=async()=>{try{d.value=!0;const _=await oe(r.value.id||r.value.key);m.value=_.tree||[],c.value=_.checkedKeys||[]}catch{m.value=[{id:"sys",label:"系统管理",children:[{id:"sys.users",label:"用户管理"},{id:"sys.roles",label:"角色管理"},{id:"sys.logs",label:"系统日志"}]},{id:"kb",label:"知识库",children:[{id:"kb.view",label:"查看"},{id:"kb.edit",label:"编辑"}]}],c.value=[]}finally{d.value=!1}},x=(_,s)=>{},v=async()=>{try{f.value=!0;const _=r.value.id||r.value.key;await ae(_,{checkedKeys:c.value}),M.success("保存成功"),C(),$("success")}catch(_){M.error(_?.message||"保存失败")}finally{f.value=!1}},$=R;return i({open:g}),(_,s)=>{const p=n("el-tree"),h=n("el-button"),V=n("el-dialog"),T=Z("loading");return I(),P(V,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=l=>o.value=l),title:`角色权限 - ${r.value?.name||""}`,width:"720px","before-close":C},{footer:t(()=>[L("span",me,[e(h,{onClick:C},{default:t(()=>s[1]||(s[1]=[k("取消")])),_:1,__:[1]}),e(h,{type:"primary",onClick:v,loading:f.value},{default:t(()=>s[2]||(s[2]=[k("保存")])),_:1,__:[2]},8,["loading"])])]),default:t(()=>[j(e(p,{data:m.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":c.value,onCheckChange:x},null,8,["data","default-checked-keys"]),[[T,d.value]])]),_:1},8,["modelValue","title"])}}},ve=O(_e,[["__scopeId","data-v-dc6b9441"]]),fe={class:"toolbar"},ye={__name:"RoleAssignees",emits:["success"],setup(b,{expose:i,emit:R}){const o=u(!1),r=u(null),d=u(!1),f=u(!1),m=u(""),c=u([]),g=u([]),C=async s=>{r.value=s,o.value=!0,await x()},A=()=>{o.value=!1,r.value=null,c.value=[],g.value=[],m.value=""},x=async()=>{try{d.value=!0;const s=await Y({page:1,size:9999}),p=s.items||s.list||s.data?.items||[];c.value=p.map(V=>({id:V.id||V.userId,label:V.username||V.name}));const h=await se(r.value.id||r.value.key);g.value=h.userIds||[]}catch{c.value=[{id:"u1",label:"Alice"},{id:"u2",label:"Bob"},{id:"u3",label:"Carol"}],g.value=["u2"]}finally{d.value=!1}},v=(s,p)=>s?p.label.toLowerCase().includes(s.toLowerCase()):!0,$=async()=>{try{f.value=!0,await ne(r.value.id||r.value.key,{userIds:g.value}),M.success("保存成功"),_("success"),A()}catch(s){M.error(s?.message||"保存失败")}finally{f.value=!1}},_=R;return i({open:C}),(s,p)=>{const h=n("el-input"),V=n("el-button"),T=n("el-transfer"),l=n("el-dialog"),a=Z("loading");return I(),P(l,{modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=y=>o.value=y),title:`授权人 - ${r.value?.name||""}`,width:"720px","before-close":A},{default:t(()=>[L("div",fe,[e(h,{modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=y=>m.value=y),placeholder:"搜索用户",clearable:"",style:{width:"260px"}},null,8,["modelValue"]),p[4]||(p[4]=L("div",{class:"spacer"},null,-1)),e(V,{type:"primary",onClick:$,loading:f.value},{default:t(()=>p[3]||(p[3]=[k("保存")])),_:1,__:[3]},8,["loading"])]),j(e(T,{modelValue:g.value,"onUpdate:modelValue":p[1]||(p[1]=y=>g.value=y),filterable:"","filter-method":v,titles:["待选用户","已授权"],data:c.value,props:{key:"id",label:"label"}},null,8,["modelValue","data"]),[[a,d.value]])]),_:1},8,["modelValue","title"])}}},be=O(ye,[["__scopeId","data-v-ac03e5fa"]]),ge={class:"role-management"},ke={class:"table-header"},Re={class:"actions"},we={__name:"RoleManagement",setup(b){const i={PLATFORM:"platform",KB:"kb",NORMAL:"normal"},R={[i.PLATFORM]:"平台级",[i.KB]:"知识库级",[i.NORMAL]:"普通级"},o=u({roleKey:"all",roleType:"all"}),r=S(()=>{const l=new Map;return f.value.forEach(a=>{a.key&&a.name&&l.set(a.key,{value:a.key,label:a.name})}),Array.from(l.values())}),d=[{value:i.PLATFORM,label:R[i.PLATFORM]},{value:i.KB,label:R[i.KB]},{value:i.NORMAL,label:R[i.NORMAL]}],f=u([]),m=l=>{const a=l.id||l.key||l.roleId||l.name,y=l.type;return{id:a,key:l.key||l.id||a,name:l.name,description:l.description,type:y,typeLabel:l.typeLabel||R[y]||"",userCount:l.userCount??0}},c=async()=>{const l={roleKey:o.value.roleKey==="all"?void 0:o.value.roleKey,roleType:o.value.roleType==="all"?void 0:o.value.roleType,page:1,size:50};try{const a=await le(l),y=a.items||a.list||[];f.value=y.map(m)}catch{f.value=[]}},g=S(()=>f.value.filter(l=>{const a=o.value.roleKey==="all"||l.key===o.value.roleKey,y=o.value.roleType==="all"||l.type===o.value.roleType;return a&&y})),C=()=>{o.value={roleKey:"all",roleType:"all"}},A=()=>{c()},x=()=>{s.value?.open()},v=l=>{p.value?.open(l)},$=l=>{h.value?.open(l)},_=l=>{V.value?.open(l)},s=u(null),p=u(null),h=u(null),V=u(null),T=()=>{c()};return ee(()=>{c()}),(l,a)=>{const y=n("el-option"),z=n("el-select"),F=n("el-col"),K=n("el-button"),G=n("el-row"),U=n("el-table-column"),J=n("el-table");return I(),N("div",ge,[e(G,{gutter:16},{default:t(()=>[e(F,{span:6},{default:t(()=>[e(z,{modelValue:o.value.roleKey,"onUpdate:modelValue":a[0]||(a[0]=w=>o.value.roleKey=w),placeholder:"选择角色",clearable:"",style:{width:"100%"}},{default:t(()=>[e(y,{label:"全部角色",value:"all"}),(I(!0),N(E,null,q(r.value,w=>(I(),P(y,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(F,{span:6},{default:t(()=>[e(z,{modelValue:o.value.roleType,"onUpdate:modelValue":a[1]||(a[1]=w=>o.value.roleType=w),placeholder:"选择角色类型",clearable:"",style:{width:"100%"}},{default:t(()=>[e(y,{label:"全部类型",value:"all"}),(I(),N(E,null,q(d,w=>e(y,{key:w.value,label:w.label,value:w.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(F,{span:12,class:"text-right"},{default:t(()=>[e(K,{type:"primary",onClick:A},{default:t(()=>a[2]||(a[2]=[k("查询")])),_:1,__:[2]}),e(K,{onClick:C},{default:t(()=>a[3]||(a[3]=[k("重置")])),_:1,__:[3]})]),_:1})]),_:1}),L("div",ke,[a[5]||(a[5]=L("div",{class:"title"},"角色列表",-1)),L("div",Re,[e(K,{type:"primary",onClick:x},{default:t(()=>a[4]||(a[4]=[k("新建角色")])),_:1,__:[4]})])]),e(J,{data:g.value,style:{width:"100%"},stripe:""},{default:t(()=>[e(U,{prop:"name",label:"角色名",width:"180"}),e(U,{prop:"description",label:"描述","min-width":"240","show-overflow-tooltip":""}),e(U,{prop:"typeLabel",label:"角色类型",width:"140"}),e(U,{prop:"userCount",label:"用户数",width:"100"}),e(U,{label:"操作",width:"260",fixed:"right"},{default:t(({row:w})=>[e(K,{size:"small",onClick:D=>v(w)},{default:t(()=>a[6]||(a[6]=[k("角色信息")])),_:2,__:[6]},1032,["onClick"]),e(K,{size:"small",onClick:D=>$(w),type:"primary",plain:""},{default:t(()=>a[7]||(a[7]=[k("角色权限")])),_:2,__:[7]},1032,["onClick"]),e(K,{size:"small",onClick:D=>_(w),type:"success",plain:""},{default:t(()=>a[8]||(a[8]=[k("授权人")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(ie,{ref_key:"createRoleRef",ref:s,onSuccess:T},null,512),e(pe,{ref_key:"roleInfoRef",ref:p},null,512),e(ve,{ref_key:"rolePermRef",ref:h,onSuccess:T},null,512),e(be,{ref_key:"roleAssigneesRef",ref:V,onSuccess:T},null,512)])}}},xe=O(we,[["__scopeId","data-v-a69e64f0"]]);export{xe as default};
