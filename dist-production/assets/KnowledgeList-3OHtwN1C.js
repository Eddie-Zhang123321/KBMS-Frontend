import{e as p,d as Z,r as i,p as N,o as c,w as r,f as l,a as t,c as g,F as L,C as R,G as ee,B as C,i as m,E as w,u as le,n as oe,z as te,H as se,I as ae,g as ne,J as re,K as j,L as ie}from"./index-D3azu4XD.js";import{c as de,u as ce,g as ue,a as pe,d as me}from"./kb-DK7epUyz.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as _e}from"./chat-DgemGYMB.js";const ge={class:"form-container"},ve={class:"cover-section"},fe={class:"cover-selection"},be=["onClick"],we=["src","alt"],ke={class:"cover-name"},he={class:"basic-info-section"},ye={class:"params-section"},Ve={class:"params-grid"},Ce={class:"param-item"},ze={class:"param-item"},xe={class:"param-item full-width"},$e={class:"param-item full-width"},Be={class:"dialog-footer"},Ue={__name:"CreateKB",emits:["success"],setup(H,{expose:v,emit:k}){const _=p(!1),f=p(!1),b=[{id:1,url:"/covers/technology.png",name:"科技"},{id:2,url:"/covers/education.png",name:"教育"},{id:3,url:"/covers/business.png",name:"商业"},{id:4,url:"/covers/design.png",name:"设计"},{id:5,url:"/covers/health.png",name:"健康"},{id:6,url:"/covers/default.png",name:"默认"}],n=Z({name:"",description:"",icon:null,chunk_size:1e3,chunk_overlap:200,separator:`

`,embedding_model:"text2vec-base",access_mode:0,vector_store:"faiss",tags:["金融"]}),M={name:[{required:!0,message:"请输入知识库名称",trigger:"blur"}],icon:[{required:!0,message:"请选择封面",trigger:"change"}],access_mode:[{required:!0,message:"请选择访问模式",trigger:"change"}]},B=p(null),z=$=>{n.icon=$},x=()=>{Object.assign(n,{name:"",description:"",icon:null,chunk_size:1e3,chunk_overlap:200,separator:`

`,embedding_model:"text2vec-base",access_mode:0,vector_store:"faiss",tags:[]})},S=()=>{_.value=!1,x()},h=()=>{B.value.validate(async $=>{if($){f.value=!0;try{const e=await de({...n});e.success?(w.success("知识库创建成功"),_.value=!1,x(),E("success")):w.error(e.message||"创建失败")}catch(e){console.error("创建失败:",e),w.error("创建知识库失败，请重试")}finally{f.value=!1}}})};v({open:()=>{_.value=!0}});const E=k;return($,e)=>{const y=i("el-form-item"),U=i("el-input"),I=i("el-radio"),q=i("el-radio-group"),K=i("el-option"),s=i("el-select"),o=i("el-input-number"),V=i("el-form"),u=i("el-button"),T=i("el-dialog");return c(),N(T,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),title:"新建知识库",width:"800px","before-close":S,style:{"--el-dialog-border-radius":"12px"}},{footer:r(()=>[l("div",Be,[t(u,{onClick:S,size:"large"},{default:r(()=>e[20]||(e[20]=[m("取消")])),_:1,__:[20]}),t(u,{type:"primary",onClick:h,size:"large",loading:f.value},{default:r(()=>[m(C(f.value?"创建中...":"创建知识库"),1)]),_:1},8,["loading"])])]),default:r(()=>[l("div",ge,[t(V,{ref_key:"formRef",ref:B,model:n,rules:M,"label-width":"100px"},{default:r(()=>[l("div",ve,[e[9]||(e[9]=l("div",{class:"section-title"},[l("span",{class:"title-icon"},"🖼️"),l("span",null,"选择知识库封面")],-1)),t(y,{prop:"icon"},{default:r(()=>[l("div",fe,[(c(),g(L,null,R(b,a=>l("div",{key:a.id,class:ee(["cover-item",{selected:n.icon===a.id}]),onClick:F=>z(a.id)},[l("img",{src:a.url,alt:a.name,class:"cover-image"},null,8,we),l("div",ke,C(a.name),1)],10,be)),64))])]),_:1})]),l("div",he,[e[12]||(e[12]=l("div",{class:"section-title"},[l("span",{class:"title-icon"},"📝"),l("span",null,"基本信息")],-1)),t(y,{label:"知识库名称",prop:"name"},{default:r(()=>[t(U,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),placeholder:"请输入知识库名称",size:"large"},null,8,["modelValue"])]),_:1}),t(y,{label:"描述信息"},{default:r(()=>[t(U,{modelValue:n.description,"onUpdate:modelValue":e[1]||(e[1]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(y,{label:"访问模式",prop:"access_mode"},{default:r(()=>[t(q,{modelValue:n.access_mode,"onUpdate:modelValue":e[2]||(e[2]=a=>n.access_mode=a)},{default:r(()=>[t(I,{label:0},{default:r(()=>e[10]||(e[10]=[m("私有")])),_:1,__:[10]}),t(I,{label:1},{default:r(()=>e[11]||(e[11]=[m("公开")])),_:1,__:[11]})]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"标签"},{default:r(()=>[t(s,{modelValue:n.tags,"onUpdate:modelValue":e[3]||(e[3]=a=>n.tags=a),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"输入或选择标签",style:{width:"100%"}},{default:r(()=>[(c(!0),g(L,null,R(n.tags,a=>(c(),N(K,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),l("div",ye,[e[19]||(e[19]=l("div",{class:"section-title"},[l("span",{class:"title-icon"},"⚙️"),l("span",null,"初始化参数设置")],-1)),l("div",Ve,[l("div",Ce,[e[13]||(e[13]=l("label",{class:"param-label"},"分块大小",-1)),t(o,{modelValue:n.chunk_size,"onUpdate:modelValue":e[4]||(e[4]=a=>n.chunk_size=a),min:100,max:5e3,step:100,size:"large"},null,8,["modelValue"]),e[14]||(e[14]=l("span",{class:"param-desc"},"字符数",-1))]),l("div",ze,[e[15]||(e[15]=l("label",{class:"param-label"},"重叠大小",-1)),t(o,{modelValue:n.chunk_overlap,"onUpdate:modelValue":e[5]||(e[5]=a=>n.chunk_overlap=a),min:0,max:1e3,step:50,size:"large"},null,8,["modelValue"]),e[16]||(e[16]=l("span",{class:"param-desc"},"字符数",-1))]),l("div",xe,[e[17]||(e[17]=l("label",{class:"param-label"},"分隔符",-1)),t(U,{modelValue:n.separator,"onUpdate:modelValue":e[6]||(e[6]=a=>n.separator=a),placeholder:"例如：\\n\\n",size:"large"},null,8,["modelValue"])]),l("div",$e,[e[18]||(e[18]=l("label",{class:"param-label"},"嵌入模型",-1)),t(s,{modelValue:n.embedding_model,"onUpdate:modelValue":e[7]||(e[7]=a=>n.embedding_model=a),placeholder:"选择模型",size:"large",class:"model-select"},{default:r(()=>[t(K,{label:"text2vec-base",value:"text2vec-base"}),t(K,{label:"text2vec-large",value:"text2vec-large"})]),_:1},8,["modelValue"])])])])]),_:1},8,["model"])])]),_:1},8,["modelValue"])}}},Ke=G(Ue,[["__scopeId","data-v-73d5f8d0"]]),De={class:"knowledge-base"},Le={class:"header"},Me={class:"knowledge-list-container"},Se={class:"knowledge-list"},Ie=["onClick"],Te={class:"knowledge-header"},Re={class:"knowledge-info"},Ee={class:"knowledge-title"},qe={class:"knowledge-description"},Fe={class:"knowledge-tags"},Ne={class:"knowledge-footer"},Pe={class:"update-time"},je={class:"el-dropdown-link"},Ge={class:"pagination"},He={key:1,class:"empty-state"},Je={__name:"KnowledgeList",setup(H){const v=p(""),k=p([]),_=p(!1),f=p(0),b=p(1),n=p(6),M=p(),B=le(),z=ce();let x=null;const S=s=>{if(!s)return"未知时间";try{const o=new Date(s),u=Math.floor((new Date-o)/(1e3*60*60*24));return u===0?"今天":u===1?"昨天":u<7?`${u}天前`:u<30?`${Math.floor(u/7)}周前`:o.toLocaleDateString()}catch{return s}},h=async()=>{_.value=!0;try{const s={page:b.value,page_size:n.value};v.value.trim()&&(s.search=v.value.trim());const o=await ue(s);k.value=o.items||[],f.value=o.total||0,z.setKBList(k.value)}catch{w.error("获取知识库列表失败"),k.value=[],f.value=0}finally{_.value=!1}};oe(v,s=>{x&&clearTimeout(x),x=setTimeout(()=>{b.value=1,h()},500)});const E=s=>{b.value=s,h()},$=s=>{n.value=s,b.value=1,h()},e=s=>{z.setCurrentKB(s),pe(s.id).then(o=>{z.setUserRole(o.role)}).catch(o=>{console.error("获取用户角色失败:",o),z.setUserRole(0)}),B.push(`/knowledgebase/${s.id}`)},y=async s=>{try{const o=await _e({title:`${s.name} 的对话`,kb_id:s.id}),V=String(o.chat_id);B.push({path:"/service",query:{chatId:V}})}catch(o){console.error("创建对话失败:",o),w.error("创建对话失败，请稍后重试")}},U=()=>{M.value.open()},I=s=>{console.log("编辑知识库:",s.id)},q=s=>{ie.confirm("确定要删除该知识库吗？此操作不可撤销！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await me(s.id),w.success("删除成功"),h()}catch(o){w.error("删除失败"),console.error("删除异常:",o)}}).catch(()=>{w.info("已取消删除")})},K=(s,o)=>{s==="edit"?I(o):s==="delete"&&q(o)};return te(()=>{h()}),(s,o)=>{const V=i("el-icon"),u=i("el-input"),T=i("el-button"),a=i("el-avatar"),F=i("el-tag"),J=i("More"),P=i("el-dropdown-item"),O=i("el-dropdown-menu"),Q=i("el-dropdown"),A=i("el-pagination"),W=i("el-empty"),X=se("loading");return c(),g("div",De,[l("div",Le,[t(u,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=d=>v.value=d),placeholder:"搜索知识库名称、描述或标签",class:"pill-input search-input",clearable:""},{prefix:r(()=>[t(V,null,{default:r(()=>[t(ne(re))]),_:1})]),_:1},8,["modelValue"]),t(T,{type:"primary",onClick:U,round:"",class:"create-btn"},{default:r(()=>o[4]||(o[4]=[m(" 创建知识库 ")])),_:1,__:[4]})]),t(Ke,{ref_key:"createDialog",ref:M},null,512),ae((c(),g("div",Me,[k.value.length>0?(c(),g(L,{key:0},[l("div",Se,[(c(!0),g(L,null,R(k.value,d=>(c(),g("div",{key:d.id,class:"knowledge-card",onClick:D=>e(d)},[l("div",Te,[t(a,{src:d.icon,size:60,class:"item-icon"},null,8,["src"]),l("div",Re,[l("h3",Ee,C(d.name),1),l("p",qe,C(d.description),1)])]),l("div",Fe,[(c(!0),g(L,null,R(d.tags,(D,Y)=>(c(),N(F,{key:Y,size:"small"},{default:r(()=>[m(C(D),1)]),_:2},1024))),128)),t(F,{size:"small",effect:"plain"},{default:r(()=>[m(C(d.status),1)]),_:2},1024)]),l("div",Ne,[l("span",Pe,"最后更新: "+C(S(d.updated_at)),1),t(T,{type:"primary",size:"small",onClick:j(D=>y(d),["stop"])},{default:r(()=>o[5]||(o[5]=[m(" 开始对话 ")])),_:2,__:[5]},1032,["onClick"])]),l("div",{class:"more-options",onClick:o[1]||(o[1]=j(()=>{},["stop"]))},[t(Q,{trigger:"click",onCommand:D=>K(D,d)},{dropdown:r(()=>[t(O,null,{default:r(()=>[t(P,{command:"edit"},{default:r(()=>o[6]||(o[6]=[m("编辑")])),_:1,__:[6]}),t(P,{command:"delete"},{default:r(()=>o[7]||(o[7]=[m("删除")])),_:1,__:[7]})]),_:1})]),default:r(()=>[l("span",je,[t(V,{class:"more-icon"},{default:r(()=>[t(J)]),_:1})])]),_:2},1032,["onCommand"])])],8,Ie))),128))]),l("div",Ge,[t(A,{"current-page":b.value,"onUpdate:currentPage":o[2]||(o[2]=d=>b.value=d),"page-size":n.value,"onUpdate:pageSize":o[3]||(o[3]=d=>n.value=d),total:f.value,"page-sizes":[6,12,18,24],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:E,onSizeChange:$},null,8,["current-page","page-size","total"])])],64)):(c(),g("div",He,[t(W,{description:v.value?"未找到匹配的知识库":"暂无知识库"},null,8,["description"])]))])),[[X,_.value]])])}}},Xe=G(Je,[["__scopeId","data-v-b9ade047"]]);export{Xe as default};
