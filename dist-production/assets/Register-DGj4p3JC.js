import{u as L,e as f,d as c,r as p,c as O,o as P,a as r,f as g,w as l,k as q,g as i,m as w,h as C,n as T,l as h,i as v,t as J,E as m,p as M}from"./index-BsXkJmm5.js";import{_ as $}from"./logo-RMEbkNKP.js";import{C as D}from"./CubeBackground-DVSVkm-0.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"back"},K={class:"register-container"},Q={class:"register-card"},W={class:"register-footer"},X={__name:"Register",setup(Y){const _=L(),y=f("tenant"),n=c({tenantName:"",superAdmin:"",email:"",password:""}),o=c({userName:"",email:"",code:"",department:"",password:""}),A=c({tenantName:[{required:!0,message:"请输入租户名称",trigger:"blur"}],superAdmin:[{required:!0,message:"请输入超级管理员姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在6到20个字符",trigger:"blur"}]}),F=c({userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],code:[{required:!0,message:"请输入租户编码",trigger:"blur"},{validator:(u,e,t)=>{e&&!/^\d+$/.test(e)?t(new Error("租户编码必须为数字")):t()},trigger:"blur"}],department:[{required:!0,message:"请输入所属部门",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在6到20个字符",trigger:"blur"}]}),b=f(!1),V=f(!1),R=f(null),x=f(null),S=async()=>{if(await R.value.validate())try{b.value=!0;const e=await J(n);if(e)e.code===200?(m.success(e.message||"企业注册成功"),_.push("/login")):m.error(e.message||"企业注册失败");else{const s=await(await fetch("/api/tenant/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();s.code===200?(m.success(s.message||"企业注册成功"),_.push("/login")):m.error(s.message||"企业注册失败")}}catch(e){console.error("企业注册异常:",e),m.error("企业注册失败，请稍后重试")}finally{b.value=!1}},j=async()=>{if(await x.value.validate())try{V.value=!0;const e=await M(o);if(e)k(e);else{const s=await(await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();k(s)}}catch(e){console.error("用户注册异常:",e)}finally{V.value=!1}},k=u=>{switch(u.code){case 200:m.success(u.message||"用户注册成功"),_.push("/login");break;case 1008:m.error(u.message||"租户编码不存在，请检查");break;case 1009:m.error(u.message||"部门不存在，请检查");break;default:m.error(u.message||"用户注册失败")}},B=()=>{_.push("/login")};return(u,e)=>{const t=p("el-icon"),s=p("el-input"),d=p("el-form-item"),N=p("el-button"),z=p("el-form"),U=p("el-tab-pane"),E=p("el-tabs"),I=p("el-link");return P(),O("div",H,[r(D),g("div",K,[g("div",Q,[e[15]||(e[15]=g("div",{class:"register-header"},[g("img",{src:$,alt:"Logo",class:"logo"}),g("h1",null,"InsightFlow"),g("p",null,"注册新账号")],-1)),r(E,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=a=>y.value=a),class:"register-tabs"},{default:l(()=>[r(U,{label:"企业注册",name:"tenant"},{default:l(()=>[r(z,{ref_key:"tenantFormRef",ref:R,model:n,rules:A,onSubmit:e[4]||(e[4]=q(()=>{},["prevent"]))},{default:l(()=>[r(d,{prop:"tenantName"},{default:l(()=>[r(s,{modelValue:n.tenantName,"onUpdate:modelValue":e[0]||(e[0]=a=>n.tenantName=a),placeholder:"请输入租户名称",size:"large"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(w))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"superAdmin"},{default:l(()=>[r(s,{modelValue:n.superAdmin,"onUpdate:modelValue":e[1]||(e[1]=a=>n.superAdmin=a),placeholder:"请输入超级管理员姓名",size:"large"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(C))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"email"},{default:l(()=>[r(s,{modelValue:n.email,"onUpdate:modelValue":e[2]||(e[2]=a=>n.email=a),placeholder:"请输入超级管理员邮箱",size:"large"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(T))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"password"},{default:l(()=>[r(s,{modelValue:n.password,"onUpdate:modelValue":e[3]||(e[3]=a=>n.password=a),type:"password",placeholder:"请输入登录密码",size:"large","show-password":""},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(h))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(N,{type:"primary",size:"large",class:"register-btn",loading:b.value,onClick:S},{default:l(()=>e[12]||(e[12]=[v(" 注 册 ")])),_:1,__:[12]},8,["loading"])]),_:1},8,["model","rules"])]),_:1}),r(U,{label:"用户注册",name:"user"},{default:l(()=>[r(z,{ref_key:"userFormRef",ref:x,model:o,rules:F,onSubmit:e[10]||(e[10]=q(()=>{},["prevent"]))},{default:l(()=>[r(d,{prop:"userName"},{default:l(()=>[r(s,{modelValue:o.userName,"onUpdate:modelValue":e[5]||(e[5]=a=>o.userName=a),placeholder:"请输入用户名",size:"large"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(C))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"email"},{default:l(()=>[r(s,{modelValue:o.email,"onUpdate:modelValue":e[6]||(e[6]=a=>o.email=a),placeholder:"请输入邮箱",size:"large"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(T))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"code"},{default:l(()=>[r(s,{modelValue:o.code,"onUpdate:modelValue":e[7]||(e[7]=a=>o.code=a),placeholder:"请输入租户编码",size:"large",type:"number"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(w))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"department"},{default:l(()=>[r(s,{modelValue:o.department,"onUpdate:modelValue":e[8]||(e[8]=a=>o.department=a),placeholder:"请输入所属部门",size:"large"},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(w))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"password"},{default:l(()=>[r(s,{modelValue:o.password,"onUpdate:modelValue":e[9]||(e[9]=a=>o.password=a),type:"password",placeholder:"请输入登录密码",size:"large","show-password":""},{prefix:l(()=>[r(t,null,{default:l(()=>[r(i(h))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(N,{type:"primary",size:"large",class:"register-btn",loading:V.value,onClick:j},{default:l(()=>e[13]||(e[13]=[v(" 注 册 ")])),_:1,__:[13]},8,["loading"])]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"]),g("div",W,[r(I,{type:"primary",onClick:B},{default:l(()=>e[14]||(e[14]=[v("返回登录")])),_:1,__:[14]})])])])])}}},ae=G(X,[["__scopeId","data-v-877898f9"]]);export{ae as default};
