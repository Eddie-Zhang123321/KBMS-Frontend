import{W as F,Z as H,Y as W,X,e as c,d as Y,r as h,p as j,o as S,w as n,a,f as A,i as f,E as x,m as Z,n as G,z as J,H as K,c as Q,I as ee,g as t,a5 as z,ac as R,ad as ae,ae as q,af as T,ab as P,ah as V,ai as te,B as L,a6 as le,aj as ne,ag as se,ak as oe,L as M}from"./index-D3azu4XD.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re=(g={})=>{const u={page:1,size:10,...g};return Object.keys(u).forEach(r=>{(u[r]===""||u[r]===null||u[r]===void 0)&&delete u[r]}),F("/tenant/items",u)},ue=g=>X("/tenant",g),de=(g,u)=>H(`/tenant/${g}/status`,u),ie=g=>W(`/tenant/${g}`),pe={class:"dialog-footer"},me={__name:"CreateTenant",emits:["success"],setup(g,{expose:u,emit:r}){const i=c(!1),o=Y({tenantName:"",superAdmin:"",email:"",password:""}),m={tenantName:[{required:!0,message:"请输入租户名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],superAdmin:[{required:!0,message:"请输入管理员姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入管理员邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},w=c(null),I=()=>{i.value=!0,o.tenantName="",o.superAdmin="",o.email="",o.password=""},C=()=>{w.value?.resetFields(),i.value=!1},D=r,v=async()=>{try{await w.value.validate();const _=await ue({...o}),d=_?.id||_?.data?.id||`t-${Date.now()}`;x.success("租户创建成功");const b={mode:"create",row:{id:d,code:_?.code||_?.data?.code||`T${Date.now()}`,tenantName:o.tenantName,status:1,superAdmin:o.superAdmin,email:o.email}};C(),D("success",b)}catch(_){console.error("提交失败:",_)}};return u({open:I}),(_,d)=>{const b=h("el-input"),N=h("el-form-item"),U=h("el-form"),$=h("el-button"),B=h("el-dialog");return S(),j(B,{modelValue:i.value,"onUpdate:modelValue":d[4]||(d[4]=l=>i.value=l),title:"新增租户",width:"500px","before-close":C},{footer:n(()=>[A("span",pe,[a($,{onClick:C},{default:n(()=>d[5]||(d[5]=[f("取消")])),_:1,__:[5]}),a($,{type:"primary",onClick:v},{default:n(()=>d[6]||(d[6]=[f("确定")])),_:1,__:[6]})])]),default:n(()=>[a(U,{ref_key:"formRef",ref:w,model:o,rules:m,"label-width":"100px","label-position":"right"},{default:n(()=>[a(N,{label:"租户名称",prop:"tenantName"},{default:n(()=>[a(b,{modelValue:o.tenantName,"onUpdate:modelValue":d[0]||(d[0]=l=>o.tenantName=l),placeholder:"请输入租户名称",clearable:""},null,8,["modelValue"])]),_:1}),a(N,{label:"租户管理员",prop:"superAdmin"},{default:n(()=>[a(b,{modelValue:o.superAdmin,"onUpdate:modelValue":d[1]||(d[1]=l=>o.superAdmin=l),placeholder:"请输入管理员姓名",clearable:""},null,8,["modelValue"])]),_:1}),a(N,{label:"管理员邮箱",prop:"email"},{default:n(()=>[a(b,{modelValue:o.email,"onUpdate:modelValue":d[2]||(d[2]=l=>o.email=l),placeholder:"请输入邮箱地址",clearable:""},null,8,["modelValue"])]),_:1}),a(N,{label:"设置密码",prop:"password"},{default:n(()=>[a(b,{modelValue:o.password,"onUpdate:modelValue":d[3]||(d[3]=l=>o.password=l),type:"password",placeholder:"请输入密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},ce=O(me,[["__scopeId","data-v-e74e76f8"]]),fe={class:"tenant-management"},ge={style:{padding:"40px 0","text-align":"center",color:"#999"}},ve={style:{"font-size":"12px","margin-top":"8px"}},_e={__name:"Tenant",setup(g){const u=c({tenantName:"",code:"",status:null}),r=c([]),i=c(1),o=c(10),m=c(0),w=c(!1),I=c(null),C=c(null),D=Z(()=>r.value||[]);G(i,()=>{v()},{immediate:!1}),J(()=>{v()});const v=async()=>{w.value=!0;try{const l={page:i.value,size:o.value,...u.value},e=await re(l);if(e&&e.items){const p=e.items.map(s=>{const{page:y,size:E,...k}=s;return k});r.value=p,m.value=e.total||0}else if(Array.isArray(e)){const p=e.map(s=>{const{page:y,size:E,...k}=s;return k});r.value=p,m.value=p.length}else r.value=[],m.value=0}catch(l){console.error("获取租户数据失败",l),x.error("获取租户数据失败: "+(l.message||"未知错误")),r.value=[],m.value=0}finally{w.value=!1}},_=()=>{i.value=1,v(),x.success("筛选完成")},d=()=>{u.value={tenantName:"",code:"",status:null},i.value=1,v()},b=l=>{const e=l.status===1?0:1,p=e===1?"开通":"关闭";M.confirm(`确认${p}租户「${l.tenantName}」吗？`,"提示",{type:"warning"}).then(async()=>{try{const s=await de(l.id,{status:e});x.success(`租户已${p}`);const y=s?.data||s;if(y){const E=r.value.findIndex(k=>k.id===l.id);E!==-1&&(r.value[E]={...r.value[E],...y})}}catch(s){console.error("状态切换失败:",s),x.error(`${p}失败: ${s.message||"未知错误"}`)}}).catch(()=>{})},N=l=>{M.confirm(`确认删除租户「${l.tenantName}」吗？`,"提示",{type:"warning"}).then(async()=>{try{await ie(l.id),x.success("已删除");const e=r.value.findIndex(p=>p.id===l.id);e!==-1&&(r.value.splice(e,1),m.value=Math.max(0,m.value-1),r.value.length===0&&i.value>1&&(i.value=i.value-1,v()))}catch(e){console.error("删除失败:",e),x.error("删除失败: "+(e.message||"未知错误"))}}).catch(()=>{})},U=()=>{C.value?.open()},$=({mode:l,row:e})=>{if(l==="create"&&e){const{page:p,size:s,...y}=e;r.value.unshift(y),m.value=m.value+1,r.value.length>o.value&&(i.value=1,v())}},B=l=>{i.value=l,v()};return(l,e)=>{const p=K("loading");return S(),Q("div",fe,[a(t(P),{gutter:16,class:"filter-row"},{default:n(()=>[a(t(z),{span:6},{default:n(()=>[a(t(R),{placeholder:"请输入租户名称",modelValue:u.value.tenantName,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.tenantName=s),clearable:""},null,8,["modelValue"])]),_:1}),a(t(z),{span:6},{default:n(()=>[a(t(R),{placeholder:"请输入租户编号",modelValue:u.value.code,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.code=s),clearable:""},null,8,["modelValue"])]),_:1}),a(t(z),{span:6},{default:n(()=>[a(t(ae),{modelValue:u.value.status,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.status=s),placeholder:"选择状态",style:{width:"100%"},clearable:""},{default:n(()=>[a(t(q),{label:"开通",value:1}),a(t(q),{label:"关闭",value:0})]),_:1},8,["modelValue"])]),_:1}),a(t(z),{span:6,class:"button-group"},{default:n(()=>[a(t(T),{type:"primary",onClick:_},{default:n(()=>e[4]||(e[4]=[f("查询")])),_:1,__:[4]}),a(t(T),{onClick:d},{default:n(()=>e[5]||(e[5]=[f("重置")])),_:1,__:[5]})]),_:1})]),_:1}),a(t(P),{class:"batch-actions"},{default:n(()=>[a(t(T),{type:"primary",onClick:U},{default:n(()=>e[6]||(e[6]=[f("新增租户")])),_:1,__:[6]})]),_:1}),ee((S(),j(t(se),{ref_key:"tableRef",ref:I,data:D.value,style:{width:"100%"},stripe:""},{empty:n(()=>[A("div",ge,[a(t(le),{style:{"font-size":"48px","margin-bottom":"16px"}},{default:n(()=>[a(t(ne))]),_:1}),e[10]||(e[10]=A("p",null,"暂无数据",-1)),A("p",ve,[e[9]||(e[9]=f(" 请尝试调整筛选条件或 ")),a(t(T),{link:"",onClick:d},{default:n(()=>e[8]||(e[8]=[f("清除所有筛选")])),_:1,__:[8]})])])]),default:n(()=>[a(t(V),{prop:"id",label:"序号",width:"60"}),a(t(V),{prop:"code",label:"租户编码"}),a(t(V),{prop:"tenantName",label:"租户名称"}),a(t(V),{prop:"status",label:"租户状态",width:"100"},{default:n(({row:s})=>[a(t(te),{type:s.status===1?"success":"danger"},{default:n(()=>[f(L(s.status===1?"开通":"关闭"),1)]),_:2},1032,["type"])]),_:1}),a(t(V),{prop:"superAdmin",label:"租户管理员"}),a(t(V),{prop:"email",label:"管理员邮箱"}),a(t(V),{label:"操作",width:"220"},{default:n(({row:s})=>[a(t(T),{size:"small",type:"warning",onClick:y=>b(s)},{default:n(()=>[f(L(s.status===1?"关闭":"开通"),1)]),_:2},1032,["onClick"]),a(t(T),{size:"small",type:"danger",onClick:y=>N(s)},{default:n(()=>e[7]||(e[7]=[f("删除")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[p,w.value]]),a(t(oe),{"current-page":i.value,"onUpdate:currentPage":e[3]||(e[3]=s=>i.value=s),total:m.value,"page-size":o.value,layout:"total, prev, pager, next, jumper",onCurrentChange:B},null,8,["current-page","total","page-size"]),a(ce,{ref_key:"createTenantDialog",ref:C,onSuccess:$},null,512)])}}},we=O(_e,[["__scopeId","data-v-6bc769ef"]]);export{we as default};
