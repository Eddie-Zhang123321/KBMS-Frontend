import{Y as F,$ as G,_ as K,Z as Y,e as c,d as Z,r as k,p as L,o as B,w as n,a,f as z,i as f,E as V,m as H,n as J,z as Q,K as W,c as X,G as ee,g as t,a8 as $,af as R,ag as ae,ah as q,ai as h,ae as P,ak as x,al as te,B as M,a9 as le,am as ne,aj as se,an as oe,N as j}from"./index-CxOdaYXd.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re=(g={})=>{const u={page:1,pageSize:10,...g};return Object.keys(u).forEach(o=>{(u[o]===""||u[o]===null||u[o]===void 0)&&delete u[o]}),F("/tenant/items",u)},ue=g=>Y("/tenant",g),de=(g,u)=>G(`/tenant/${g}/status`,u),ie=g=>K(`/tenant/${g}`),pe={class:"dialog-footer"},me={__name:"CreateTenant",emits:["success"],setup(g,{expose:u,emit:o}){const i=c(!1),r=Z({tenantName:"",superAdmin:"",email:"",password:""}),m={tenantName:[{required:!0,message:"请输入租户名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],superAdmin:[{required:!0,message:"请输入管理员姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入管理员邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},w=c(null),A=()=>{i.value=!0,r.tenantName="",r.superAdmin="",r.email="",r.password=""},C=()=>{w.value?.resetFields(),i.value=!1},I=o,v=async()=>{try{await w.value.validate();const _=await ue({...r}),d=_?.id||_?.data?.id||`t-${Date.now()}`;V.success("租户创建成功");const b={mode:"create",row:{id:d,code:_?.code||_?.data?.code||parseInt(Date.now().toString().slice(-6)),tenantName:r.tenantName,status:1,superAdmin:r.superAdmin,email:r.email}};C(),I("success",b)}catch(_){console.error("提交失败:",_)}};return u({open:A}),(_,d)=>{const b=k("el-input"),N=k("el-form-item"),D=k("el-form"),S=k("el-button"),U=k("el-dialog");return B(),L(U,{modelValue:i.value,"onUpdate:modelValue":d[4]||(d[4]=l=>i.value=l),title:"新增租户",width:"500px","before-close":C},{footer:n(()=>[z("span",pe,[a(S,{onClick:C},{default:n(()=>d[5]||(d[5]=[f("取消")])),_:1,__:[5]}),a(S,{type:"primary",onClick:v},{default:n(()=>d[6]||(d[6]=[f("确定")])),_:1,__:[6]})])]),default:n(()=>[a(D,{ref_key:"formRef",ref:w,model:r,rules:m,"label-width":"100px","label-position":"right"},{default:n(()=>[a(N,{label:"租户名称",prop:"tenantName"},{default:n(()=>[a(b,{modelValue:r.tenantName,"onUpdate:modelValue":d[0]||(d[0]=l=>r.tenantName=l),placeholder:"请输入租户名称",clearable:""},null,8,["modelValue"])]),_:1}),a(N,{label:"租户管理员",prop:"superAdmin"},{default:n(()=>[a(b,{modelValue:r.superAdmin,"onUpdate:modelValue":d[1]||(d[1]=l=>r.superAdmin=l),placeholder:"请输入管理员姓名",clearable:""},null,8,["modelValue"])]),_:1}),a(N,{label:"管理员邮箱",prop:"email"},{default:n(()=>[a(b,{modelValue:r.email,"onUpdate:modelValue":d[2]||(d[2]=l=>r.email=l),placeholder:"请输入邮箱地址",clearable:""},null,8,["modelValue"])]),_:1}),a(N,{label:"设置密码",prop:"password"},{default:n(()=>[a(b,{modelValue:r.password,"onUpdate:modelValue":d[3]||(d[3]=l=>r.password=l),type:"password",placeholder:"请输入密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},ce=O(me,[["__scopeId","data-v-63f09829"]]),fe={class:"tenant-management"},ge={style:{padding:"40px 0","text-align":"center",color:"#999"}},ve={style:{"font-size":"12px","margin-top":"8px"}},_e={__name:"Tenant",setup(g){const u=c({tenantName:"",code:"",status:null}),o=c([]),i=c(1),r=c(10),m=c(0),w=c(!1),A=c(null),C=c(null),I=H(()=>o.value||[]);J(i,()=>{v()},{immediate:!1}),Q(()=>{v()});const v=async()=>{w.value=!0;try{const l={page:i.value,pageSize:r.value,...u.value},e=await re(l);if(e&&e.items){const p=e.items.map(s=>{const{page:y,pageSize:E,...T}=s;return T});o.value=p,m.value=e.total||0}else if(Array.isArray(e)){const p=e.map(s=>{const{page:y,pageSize:E,...T}=s;return T});o.value=p,m.value=p.length}else o.value=[],m.value=0}catch(l){console.error("获取租户数据失败",l),V.error("获取租户数据失败: "+(l.message||"未知错误")),o.value=[],m.value=0}finally{w.value=!1}},_=()=>{i.value=1,v(),V.success("筛选完成")},d=()=>{u.value={tenantName:"",code:"",status:null},i.value=1,v()},b=l=>{const e=l.status===1?0:1,p=e===1?"开通":"关闭";j.confirm(`确认${p}租户「${l.tenantName}」吗？`,"提示",{type:"warning"}).then(async()=>{try{const s=await de(l.id,{status:e});V.success(`租户已${p}`);const y=s?.data||s;if(y){const E=o.value.findIndex(T=>T.id===l.id);E!==-1&&(o.value[E]={...o.value[E],...y})}}catch(s){console.error("状态切换失败:",s),V.error(`${p}失败: ${s.message||"未知错误"}`)}}).catch(()=>{})},N=l=>{j.confirm(`确认删除租户「${l.tenantName}」吗？`,"提示",{type:"warning"}).then(async()=>{try{await ie(l.id),V.success("已删除");const e=o.value.findIndex(p=>p.id===l.id);e!==-1&&(o.value.splice(e,1),m.value=Math.max(0,m.value-1),o.value.length===0&&i.value>1&&(i.value=i.value-1,v()))}catch(e){console.error("删除失败:",e),V.error("删除失败: "+(e.message||"未知错误"))}}).catch(()=>{})},D=()=>{C.value?.open()},S=({mode:l,row:e})=>{if(l==="create"&&e){const{page:p,pageSize:s,...y}=e;o.value.unshift(y),m.value=m.value+1,o.value.length>s.value&&(i.value=1,v())}},U=l=>{i.value=l,v()};return(l,e)=>{const p=W("loading");return B(),X("div",fe,[a(t(P),{gutter:16,class:"filter-row"},{default:n(()=>[a(t($),{span:6,xs:24,sm:12},{default:n(()=>[a(t(R),{placeholder:"请输入租户名称",modelValue:u.value.tenantName,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.tenantName=s),clearable:""},null,8,["modelValue"])]),_:1}),a(t($),{span:6,xs:24,sm:12},{default:n(()=>[a(t(R),{placeholder:"请输入租户编号",modelValue:u.value.code,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.code=s),clearable:""},null,8,["modelValue"])]),_:1}),a(t($),{span:6,xs:24,sm:12},{default:n(()=>[a(t(ae),{modelValue:u.value.status,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.status=s),placeholder:"选择状态",style:{width:"100%"},clearable:""},{default:n(()=>[a(t(q),{label:"开通",value:1}),a(t(q),{label:"关闭",value:0})]),_:1},8,["modelValue"])]),_:1}),a(t($),{span:6,xs:24,sm:12,class:"button-group"},{default:n(()=>[a(t(h),{type:"primary",onClick:_},{default:n(()=>e[4]||(e[4]=[f("查询")])),_:1,__:[4]}),a(t(h),{onClick:d},{default:n(()=>e[5]||(e[5]=[f("重置")])),_:1,__:[5]})]),_:1})]),_:1}),a(t(P),{class:"batch-actions"},{default:n(()=>[a(t(h),{type:"primary",onClick:D},{default:n(()=>e[6]||(e[6]=[f("新增租户")])),_:1,__:[6]})]),_:1}),ee((B(),L(t(se),{ref_key:"tableRef",ref:A,data:I.value,style:{width:"100%"},stripe:""},{empty:n(()=>[z("div",ge,[a(t(le),{style:{"font-size":"48px","margin-bottom":"16px"}},{default:n(()=>[a(t(ne))]),_:1}),e[10]||(e[10]=z("p",null,"暂无数据",-1)),z("p",ve,[e[9]||(e[9]=f(" 请尝试调整筛选条件或 ")),a(t(h),{link:"",onClick:d},{default:n(()=>e[8]||(e[8]=[f("清除所有筛选")])),_:1,__:[8]})])])]),default:n(()=>[a(t(x),{prop:"id",label:"序号",width:"60"}),a(t(x),{prop:"code",label:"租户编码"}),a(t(x),{prop:"tenantName",label:"租户名称"}),a(t(x),{prop:"status",label:"租户状态",width:"100"},{default:n(({row:s})=>[a(t(te),{type:s.status===1?"success":"danger"},{default:n(()=>[f(M(s.status===1?"开通":"关闭"),1)]),_:2},1032,["type"])]),_:1}),a(t(x),{prop:"superAdmin",label:"租户管理员","class-name":"hidden-sm-and-down"}),a(t(x),{prop:"email",label:"管理员邮箱","class-name":"hidden-sm-and-down"}),a(t(x),{label:"操作",width:"220"},{default:n(({row:s})=>[a(t(h),{size:"small",type:"warning",onClick:y=>b(s)},{default:n(()=>[f(M(s.status===1?"关闭":"开通"),1)]),_:2},1032,["onClick"]),a(t(h),{size:"small",type:"danger",onClick:y=>N(s)},{default:n(()=>e[7]||(e[7]=[f("删除")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[p,w.value]]),a(t(oe),{"current-page":i.value,"onUpdate:currentPage":e[3]||(e[3]=s=>i.value=s),total:m.value,"page-size":r.value,layout:"total, prev, pager, next, jumper",onCurrentChange:U},null,8,["current-page","total","page-size"]),a(ce,{ref_key:"createTenantDialog",ref:C,onSuccess:S},null,512)])}}},we=O(_e,[["__scopeId","data-v-ccd7210c"]]);export{we as default};
