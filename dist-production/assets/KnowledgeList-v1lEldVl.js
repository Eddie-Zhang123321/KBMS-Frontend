import{e as m,A as P,d as le,r as i,C as N,o as u,w as n,f as l,a as s,c as v,F as K,v as F,M as se,K as V,i as p,E as k,u as oe,B as ae,q as ne,U as re,V as ie,g as W,W as de,k as j,X as ue,Y as ce}from"./index-BsXkJmm5.js";import{c as me,u as pe,g as _e,a as ge,d as fe}from"./kb-DOyKjHVV.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ve}from"./chat-C_oSNSUp.js";const we={class:"form-container"},he={class:"cover-section"},be={class:"cover-selection"},ke=["onClick"],ye=["src","alt"],Ce={class:"cover-name"},Ve={class:"basic-info-section"},ze={class:"params-section"},Ue={class:"params-grid"},xe={class:"param-item"},$e={class:"param-item"},Le={class:"param-item full-width"},Re={class:"param-item full-width"},Be={class:"dialog-footer"},Ke={__name:"CreateKB",emits:["success"],setup(Z,{expose:w,emit:y}){const _=m(!1),h=m(!1),g=P(()=>window.innerWidth<=768),z=P(()=>g.value?"95%":"800px"),D=[{id:1,url:new URL("/assets/technology-63wFSkzS.png",import.meta.url).href,name:"科技"},{id:2,url:new URL("/assets/finance-Ck4acTzt.png",import.meta.url).href,name:"金融"},{id:3,url:new URL("/assets/business-CCn3F5Yw.png",import.meta.url).href,name:"商业"},{id:4,url:new URL("/assets/design-YZ1VK_EO.png",import.meta.url).href,name:"设计"},{id:5,url:new URL("/assets/law-DpbzAc8H.png",import.meta.url).href,name:"法规"},{id:6,url:new URL("@/assets/covers/default.png",import.meta.url).href,name:"默认"}],r=le({name:"",description:"",icon:null,chunk_size:100,chunk_overlap:20,separator:`

`,embedding_model:"text2vec-base",access_mode:0,vector_store:"faiss",tags:["金融"]}),U={name:[{required:!0,message:"请输入知识库名称",trigger:"blur"}],icon:[{required:!0,message:"请选择封面",trigger:"change"}],access_mode:[{required:!0,message:"请选择访问模式",trigger:"change"}]},x=m(null),I=$=>{r.icon=$},S=()=>{Object.assign(r,{name:"",description:"",icon:null,chunk_size:100,chunk_overlap:20,separator:`

`,embedding_model:"text2vec-base",access_mode:0,vector_store:"faiss",tags:[]})},T=()=>{_.value=!1,S()},b=()=>{x.value.validate(async $=>{if($){h.value=!0;try{const e=await me({...r});e?(k.success("知识库创建成功"),_.value=!1,S(),q("success")):k.error(e.message||"创建失败")}catch(e){console.error("创建失败:",e),k.error("创建知识库失败，请重试")}finally{h.value=!1}}})};w({open:()=>{_.value=!0}});const q=y;return($,e)=>{const C=i("el-form-item"),L=i("el-input"),M=i("el-radio"),Y=i("el-radio-group"),R=i("el-option"),o=i("el-select"),t=i("el-input-number"),f=i("el-form"),c=i("el-button"),E=i("el-dialog");return u(),N(E,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),title:"新建知识库",width:z.value,"before-close":T,fullscreen:g.value,style:{"--el-dialog-border-radius":"12px"}},{footer:n(()=>[l("div",Be,[s(c,{onClick:T,size:"large"},{default:n(()=>e[20]||(e[20]=[p("取消")])),_:1,__:[20]}),s(c,{type:"primary",onClick:b,size:"large",loading:h.value},{default:n(()=>[p(V(h.value?"创建中...":"创建知识库"),1)]),_:1},8,["loading"])])]),default:n(()=>[l("div",we,[s(f,{ref_key:"formRef",ref:x,model:r,rules:U,"label-width":"100px"},{default:n(()=>[l("div",he,[e[9]||(e[9]=l("div",{class:"section-title"},[l("span",{class:"title-icon"},"🖼️"),l("span",null,"选择知识库封面")],-1)),s(C,{prop:"icon"},{default:n(()=>[l("div",be,[(u(),v(K,null,F(D,a=>l("div",{key:a.id,class:se(["cover-item",{selected:r.icon===a.id}]),onClick:A=>I(a.id)},[l("img",{src:a.url,alt:a.name,class:"cover-image"},null,8,ye),l("div",Ce,V(a.name),1)],10,ke)),64))])]),_:1})]),l("div",Ve,[e[12]||(e[12]=l("div",{class:"section-title"},[l("span",{class:"title-icon"},"📝"),l("span",null,"基本信息")],-1)),s(C,{label:"知识库名称",prop:"name"},{default:n(()=>[s(L,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),placeholder:"请输入知识库名称",size:"large"},null,8,["modelValue"])]),_:1}),s(C,{label:"描述信息"},{default:n(()=>[s(L,{modelValue:r.description,"onUpdate:modelValue":e[1]||(e[1]=a=>r.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),s(C,{label:"访问模式",prop:"access_mode"},{default:n(()=>[s(Y,{modelValue:r.access_mode,"onUpdate:modelValue":e[2]||(e[2]=a=>r.access_mode=a)},{default:n(()=>[s(M,{label:0},{default:n(()=>e[10]||(e[10]=[p("私有")])),_:1,__:[10]}),s(M,{label:1},{default:n(()=>e[11]||(e[11]=[p("公开")])),_:1,__:[11]})]),_:1},8,["modelValue"])]),_:1}),s(C,{label:"标签"},{default:n(()=>[s(o,{modelValue:r.tags,"onUpdate:modelValue":e[3]||(e[3]=a=>r.tags=a),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"输入或选择标签",style:{width:"100%"}},{default:n(()=>[(u(!0),v(K,null,F(r.tags,a=>(u(),N(R,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),l("div",ze,[e[19]||(e[19]=l("div",{class:"section-title"},[l("span",{class:"title-icon"},"⚙️"),l("span",null,"初始化参数设置")],-1)),l("div",Ue,[l("div",xe,[e[13]||(e[13]=l("label",{class:"param-label"},"分块大小",-1)),s(t,{modelValue:r.chunk_size,"onUpdate:modelValue":e[4]||(e[4]=a=>r.chunk_size=a),min:100,max:5e3,step:100,size:"large"},null,8,["modelValue"]),e[14]||(e[14]=l("span",{class:"param-desc"},"字符数",-1))]),l("div",$e,[e[15]||(e[15]=l("label",{class:"param-label"},"重叠大小",-1)),s(t,{modelValue:r.chunk_overlap,"onUpdate:modelValue":e[5]||(e[5]=a=>r.chunk_overlap=a),min:0,max:1e3,step:50,size:"large"},null,8,["modelValue"]),e[16]||(e[16]=l("span",{class:"param-desc"},"字符数",-1))]),l("div",Le,[e[17]||(e[17]=l("label",{class:"param-label"},"分隔符",-1)),s(L,{modelValue:r.separator,"onUpdate:modelValue":e[6]||(e[6]=a=>r.separator=a),placeholder:"例如：\\n\\n",size:"large"},null,8,["modelValue"])]),l("div",Re,[e[18]||(e[18]=l("label",{class:"param-label"},"嵌入模型",-1)),s(o,{modelValue:r.embedding_model,"onUpdate:modelValue":e[7]||(e[7]=a=>r.embedding_model=a),placeholder:"选择模型",size:"large",class:"model-select"},{default:n(()=>[s(R,{label:"text2vec-base",value:"text2vec-base"}),s(R,{label:"text2vec-large",value:"text2vec-large"})]),_:1},8,["modelValue"])])])])]),_:1},8,["model"])])]),_:1},8,["modelValue","width","fullscreen"])}}},De=H(Ke,[["__scopeId","data-v-c2704fd4"]]),Se={class:"knowledge-base"},Te={class:"header"},Me={class:"knowledge-list-container"},Ee={class:"knowledge-list"},Fe=["onClick"],Ie={class:"knowledge-header"},qe={class:"knowledge-info"},Ye={class:"knowledge-title"},Ae={class:"knowledge-description"},Ne={class:"knowledge-tags"},Oe={class:"knowledge-footer"},Pe={class:"update-time"},We={class:"el-dropdown-link"},je={class:"pagination"},He={key:1,class:"empty-state"},Ze={__name:"KnowledgeList",setup(Z){const w=m(""),y=m([]),_=m(!1),h=m(0),g=m(1),z=m(6),D=m(),r=oe(),U=pe();let x=null;const I=[{id:1,url:new URL("/assets/technology-63wFSkzS.png",import.meta.url).href,name:"科技"},{id:2,url:new URL("/assets/finance-Ck4acTzt.png",import.meta.url).href,name:"金融"},{id:3,url:new URL("/assets/business-CCn3F5Yw.png",import.meta.url).href,name:"商业"},{id:4,url:new URL("/assets/design-YZ1VK_EO.png",import.meta.url).href,name:"设计"},{id:5,url:new URL("/assets/law-DpbzAc8H.png",import.meta.url).href,name:"法规"},{id:6,url:new URL("@/assets/covers/default.png",import.meta.url).href,name:"默认"}],S=o=>{const t=I.find(f=>f.id===o);return t?t.url:"/src/assets/default-placeholder.png"},T=o=>{if(!o)return"未知时间";try{const t=new Date(o),c=Math.floor((new Date-t)/(1e3*60*60*24));return c===0?"今天":c===1?"昨天":c<7?`${c}天前`:c<30?`${Math.floor(c/7)}周前`:t.toLocaleDateString()}catch{return o}},b=async()=>{_.value=!0;try{const o={page:g.value,page_size:z.value};w.value.trim()&&(o.search=w.value.trim());const t=await _e(o);y.value=t.items||[],h.value=t.total||0,U.setKBList(y.value)}catch{k.error("获取知识库列表失败"),y.value=[],h.value=0}finally{_.value=!1}};ae(w,o=>{x&&clearTimeout(x),x=setTimeout(()=>{g.value=1,b()},500)});const q=o=>{g.value=o,b()},$=o=>{z.value=o,g.value=1,b()},e=o=>{U.setCurrentKB(o),ge(o.id).then(t=>{U.setUserRole(t.role)}).catch(t=>{console.error("获取用户角色失败:",t),U.setUserRole(0)}),r.push(`/knowledgebase/${o.id}`)},C=async o=>{try{const t=await ve({title:`${o.name} 的对话`,kb_id:o.id}),f=String(t.chat_id);r.push({path:"/service",query:{chatId:f}})}catch(t){console.error("创建对话失败:",t),k.error("创建对话失败，请稍后重试")}},L=()=>{D.value.open(),b()},M=o=>{console.log("编辑知识库:",o.id)},Y=o=>{ce.confirm("确定要删除该知识库吗？此操作不可撤销！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await fe(o.id),k.success("删除成功"),b()}catch(t){k.error("删除失败"),console.error("删除异常:",t)}}).catch(()=>{k.info("已取消删除")})},R=(o,t)=>{o==="edit"?M(t):o==="delete"&&Y(t)};return ne(()=>{b()}),(o,t)=>{const f=i("el-icon"),c=i("el-input"),E=i("el-button"),a=i("el-avatar"),A=i("el-tag"),O=i("el-dropdown-item"),Q=i("el-dropdown-menu"),X=i("el-dropdown"),G=i("el-pagination"),J=i("el-empty"),ee=re("loading");return u(),v("div",Se,[l("div",Te,[s(c,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=d=>w.value=d),placeholder:"搜索知识库名称、描述或标签",class:"pill-input search-input",clearable:""},{prefix:n(()=>[s(f,null,{default:n(()=>[s(W(de))]),_:1})]),_:1},8,["modelValue"]),s(E,{type:"primary",onClick:L,round:"",class:"create-btn"},{default:n(()=>t[4]||(t[4]=[p(" 创建知识库 ")])),_:1,__:[4]})]),s(De,{ref_key:"createDialog",ref:D},null,512),ie((u(),v("div",Me,[y.value.length>0?(u(),v(K,{key:0},[l("div",Ee,[(u(!0),v(K,null,F(y.value,d=>(u(),v("div",{key:d.id,class:"knowledge-card",onClick:B=>e(d)},[l("div",Ie,[s(a,{src:S(d.icon),size:60,class:"item-icon"},null,8,["src"]),l("div",qe,[l("h3",Ye,V(d.name),1),l("p",Ae,V(d.description),1)])]),l("div",Ne,[(u(!0),v(K,null,F(d.tags,(B,te)=>(u(),N(A,{key:te,size:"small"},{default:n(()=>[p(V(B),1)]),_:2},1024))),128)),s(A,{size:"small",effect:"plain"},{default:n(()=>[p(V(d.status),1)]),_:2},1024)]),l("div",Oe,[l("span",Pe,"最后更新: "+V(T(d.updated_at)),1),s(E,{type:"primary",size:"small",onClick:j(B=>C(d),["stop"])},{default:n(()=>t[5]||(t[5]=[p(" 开始对话 ")])),_:2,__:[5]},1032,["onClick"])]),l("div",{class:"more-options",onClick:t[1]||(t[1]=j(()=>{},["stop"]))},[s(X,{trigger:"click",onCommand:B=>R(B,d)},{dropdown:n(()=>[s(Q,null,{default:n(()=>[s(O,{command:"edit"},{default:n(()=>t[6]||(t[6]=[p("编辑")])),_:1,__:[6]}),s(O,{command:"delete"},{default:n(()=>t[7]||(t[7]=[p("删除")])),_:1,__:[7]})]),_:1})]),default:n(()=>[l("span",We,[s(f,{class:"more-icon"},{default:n(()=>[s(W(ue))]),_:1})])]),_:2},1032,["onCommand"])])],8,Fe))),128))]),l("div",je,[s(G,{"current-page":g.value,"onUpdate:currentPage":t[2]||(t[2]=d=>g.value=d),"page-size":z.value,"onUpdate:pageSize":t[3]||(t[3]=d=>z.value=d),total:h.value,"page-sizes":[6,12,18,24],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:q,onSizeChange:$},null,8,["current-page","page-size","total"])])],64)):(u(),v("div",He,[s(J,{description:w.value?"未找到匹配的知识库":"暂无知识库"},null,8,["description"])]))])),[[ee,_.value]])])}}},et=H(Ze,[["__scopeId","data-v-665922dd"]]);export{et as default};
