import{r as e,a,b1 as l,U as t,J as s,V as u,a1 as n,K as r,Z as o,d,w as i,F as p,bh as m,I as c,W as v,u as g,$ as f,c2 as _}from"./vue-vendor-BUDnSszI.js";import{a as b,b as y,d as h,p as w}from"./index-8D9d6p3q.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{aL as x,aX as k,b0 as N,b1 as C,b2 as z,b3 as A,a$ as $,b5 as U,b6 as j,aY as S,b4 as I,b7 as q,aK as D}from"./vendor-zcc-V1Og.js";import"./network-vendor-ztdpVPaQ.js";const T={class:"dialog-footer"},F=V({__name:"CreateTenant",emits:["success"],setup(d,{expose:i,emit:p}){const m=e(!1),c=a({tenantName:"",superAdmin:"",email:"",password:""}),v={tenantName:[{required:!0,message:"请输入租户名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],superAdmin:[{required:!0,message:"请输入管理员姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入管理员邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},g=e(null),f=()=>{g.value?.resetFields(),m.value=!1},_=p,b=async()=>{try{await g.value.validate();const a=await(e={...c},w("/tenant",e)),l=a?.id||a?.data?.id||`t-${Date.now()}`;x.success("租户创建成功");const t={mode:"create",row:{id:l,code:a?.code||a?.data?.code||parseInt(Date.now().toString().slice(-6)),tenantName:c.tenantName,status:1,superAdmin:c.superAdmin,email:c.email}};f(),_("success",t)}catch(a){}var e};return i({open:()=>{m.value=!0,c.tenantName="",c.superAdmin="",c.email="",c.password=""}}),(e,a)=>{const d=l("el-input"),i=l("el-form-item"),p=l("el-form"),_=l("el-button"),y=l("el-dialog");return s(),t(y,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=e=>m.value=e),title:"新增租户",width:"500px","before-close":f},{footer:u(()=>[r("span",T,[n(_,{onClick:f},{default:u(()=>a[5]||(a[5]=[o("取消")])),_:1,__:[5]}),n(_,{type:"primary",onClick:b},{default:u(()=>a[6]||(a[6]=[o("确定")])),_:1,__:[6]})])]),default:u(()=>[n(p,{ref_key:"formRef",ref:g,model:c,rules:v,"label-width":"100px","label-position":"right"},{default:u(()=>[n(i,{label:"租户名称",prop:"tenantName"},{default:u(()=>[n(d,{modelValue:c.tenantName,"onUpdate:modelValue":a[0]||(a[0]=e=>c.tenantName=e),placeholder:"请输入租户名称",clearable:""},null,8,["modelValue"])]),_:1}),n(i,{label:"租户管理员",prop:"superAdmin"},{default:u(()=>[n(d,{modelValue:c.superAdmin,"onUpdate:modelValue":a[1]||(a[1]=e=>c.superAdmin=e),placeholder:"请输入管理员姓名",clearable:""},null,8,["modelValue"])]),_:1}),n(i,{label:"管理员邮箱",prop:"email"},{default:u(()=>[n(d,{modelValue:c.email,"onUpdate:modelValue":a[2]||(a[2]=e=>c.email=e),placeholder:"请输入邮箱地址",clearable:""},null,8,["modelValue"])]),_:1}),n(i,{label:"设置密码",prop:"password"},{default:u(()=>[n(d,{modelValue:c.password,"onUpdate:modelValue":a[3]||(a[3]=e=>c.password=e),type:"password",placeholder:"请输入密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-63f09829"]]),K={class:"tenant-management"},R={style:{padding:"40px 0","text-align":"center",color:"#999"}},E={style:{"font-size":"12px","margin-top":"8px"}},J=V({__name:"Tenant",setup(a){const l=e({tenantName:"",code:"",status:null}),w=e([]),V=e(1),T=e(10),J=e(0),L=e(!1),M=e(null),O=e(null),P=d(()=>w.value||[]);i(V,()=>{W()},{immediate:!1}),p(()=>{W()});const W=async()=>{L.value=!0;try{const e={page:V.value,pageSize:T.value,...l.value},a=await((e={})=>{const a={page:1,pageSize:10,...e};return Object.keys(a).forEach(e=>{""!==a[e]&&null!==a[e]&&void 0!==a[e]||delete a[e]}),b("/tenant/items",a)})(e);if(a&&a.items){const e=a.items.map(e=>{const{page:a,pageSize:l,...t}=e;return t});w.value=e,J.value=a.total||0}else if(Array.isArray(a)){const e=a.map(e=>{const{page:a,pageSize:l,...t}=e;return t});w.value=e,J.value=e.length}else w.value=[],J.value=0}catch(e){x.error("获取租户数据失败: "+(e.message||"未知错误")),w.value=[],J.value=0}finally{L.value=!1}},X=()=>{V.value=1,W(),x.success("筛选完成")},Y=()=>{l.value={tenantName:"",code:"",status:null},V.value=1,W()},Z=e=>{const a=1===e.status?0:1,l=1===a?"开通":"关闭";D.confirm(`确认${l}租户「${e.tenantName}」吗？`,"提示",{type:"warning"}).then(async()=>{try{const u=await(t=e.id,s={status:a},y(`/tenant/${t}/status`,s));x.success(`租户已${l}`);const n=u?.data||u;if(n){const a=w.value.findIndex(a=>a.id===e.id);-1!==a&&(w.value[a]={...w.value[a],...n})}}catch(u){x.error(`${l}失败: ${u.message||"未知错误"}`)}var t,s}).catch(()=>{})},B=e=>{D.confirm(`确认删除租户「${e.tenantName}」吗？`,"提示",{type:"warning"}).then(async()=>{try{await(a=e.id,h(`/tenant/${a}`)),x.success("已删除");const l=w.value.findIndex(a=>a.id===e.id);-1!==l&&(w.value.splice(l,1),J.value=Math.max(0,J.value-1),0===w.value.length&&V.value>1&&(V.value=V.value-1,W()))}catch(l){x.error("删除失败: "+(l.message||"未知错误"))}var a}).catch(()=>{})},G=()=>{O.value?.open()},H=({mode:e,row:a})=>{if("create"===e&&a){const{page:e,pageSize:l,...t}=a;w.value.unshift(t),J.value=J.value+1,w.value.length>l.value&&(V.value=1,W())}},Q=e=>{V.value=e,W()};return(e,a)=>{const d=m("loading");return s(),c("div",K,[n(g($),{gutter:16,class:"filter-row"},{default:u(()=>[n(g(k),{span:6},{default:u(()=>[n(g(N),{placeholder:"请输入租户名称",modelValue:l.value.tenantName,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.tenantName=e),clearable:""},null,8,["modelValue"])]),_:1}),n(g(k),{span:6},{default:u(()=>[n(g(N),{placeholder:"请输入租户编号",modelValue:l.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.code=e),clearable:""},null,8,["modelValue"])]),_:1}),n(g(k),{span:6},{default:u(()=>[n(g(C),{modelValue:l.value.status,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.status=e),placeholder:"选择状态",style:{width:"100%"},clearable:""},{default:u(()=>[n(g(z),{label:"开通",value:1}),n(g(z),{label:"关闭",value:0})]),_:1},8,["modelValue"])]),_:1}),n(g(k),{span:6,class:"button-group"},{default:u(()=>[n(g(A),{type:"primary",onClick:X},{default:u(()=>a[4]||(a[4]=[o("查询")])),_:1,__:[4]}),n(g(A),{onClick:Y},{default:u(()=>a[5]||(a[5]=[o("重置")])),_:1,__:[5]})]),_:1})]),_:1}),n(g($),{class:"batch-actions"},{default:u(()=>[n(g(A),{type:"primary",onClick:G},{default:u(()=>a[6]||(a[6]=[o("新增租户")])),_:1,__:[6]})]),_:1}),v((s(),t(g(I),{ref_key:"tableRef",ref:M,data:P.value,style:{width:"100%"},stripe:""},{empty:u(()=>[r("div",R,[n(g(S),{style:{"font-size":"48px","margin-bottom":"16px"}},{default:u(()=>[n(g(_))]),_:1}),a[10]||(a[10]=r("p",null,"暂无数据",-1)),r("p",E,[a[9]||(a[9]=o(" 请尝试调整筛选条件或 ")),n(g(A),{link:"",onClick:Y},{default:u(()=>a[8]||(a[8]=[o("清除所有筛选")])),_:1,__:[8]})])])]),default:u(()=>[n(g(U),{prop:"id",label:"序号",width:"60"}),n(g(U),{prop:"code",label:"租户编码"}),n(g(U),{prop:"tenantName",label:"租户名称"}),n(g(U),{prop:"status",label:"租户状态",width:"100"},{default:u(({row:e})=>[n(g(j),{type:1===e.status?"success":"danger"},{default:u(()=>[o(f(1===e.status?"开通":"关闭"),1)]),_:2},1032,["type"])]),_:1}),n(g(U),{prop:"superAdmin",label:"租户管理员"}),n(g(U),{prop:"email",label:"管理员邮箱"}),n(g(U),{label:"操作",width:"220"},{default:u(({row:e})=>[n(g(A),{size:"small",type:"warning",onClick:a=>Z(e)},{default:u(()=>[o(f(1===e.status?"关闭":"开通"),1)]),_:2},1032,["onClick"]),n(g(A),{size:"small",type:"danger",onClick:a=>B(e)},{default:u(()=>a[7]||(a[7]=[o("删除")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[d,L.value]]),n(g(q),{"current-page":V.value,"onUpdate:currentPage":a[3]||(a[3]=e=>V.value=e),total:J.value,"page-size":T.value,layout:"total, prev, pager, next, jumper",onCurrentChange:Q},null,8,["current-page","total","page-size"]),n(F,{ref_key:"createTenantDialog",ref:O,onSuccess:H},null,512)])}}},[["__scopeId","data-v-3d6de92f"]]);export{J as default};
