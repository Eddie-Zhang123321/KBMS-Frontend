const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/AuthLayout-C1GSA4K8.js","static/js/_plugin-vue_export-helper-BCo6x5W8.js","static/js/vue-vendor-BUDnSszI.js","static/js/vendor-zcc-V1Og.js","static/css/vendor-CtIGEsJ0.css","static/css/AuthLayout-BiF_MEtz.css","static/js/Login-C5DnP3f3.js","static/js/logo-B9TFvINw.js","static/js/CubeBackground-DDxgKxHE.js","static/css/CubeBackground-DpcVc6YM.css","static/js/network-vendor-ztdpVPaQ.js","static/css/Login-DYKcFjEY.css","static/js/Register-KL8kLTKc.js","static/css/Register-C1f22cmA.css","static/js/DefaultLayout-Blot1bEe.js","static/js/useWebSocket-CuTw-Xrt.js","static/js/ticket-DtMqVmfI.js","static/css/DefaultLayout-BUREKML-.css","static/js/Dashboard-Dj1RZi6u.js","static/css/Dashboard-D8Z9aBot.css","static/js/KnowledgeList-Bs4AXH3w.js","static/js/kb-DvJy3p-L.js","static/js/chat-CTPsmCEm.js","static/css/KnowledgeList-Dg3gfuTq.css","static/js/KnowledgeBase-p4WBa7za.js","static/css/KnowledgeBase-BKa32zzf.css","static/js/Service-D7X7S-Yf.js","static/css/Service-DXz7kmp4.css","static/js/UserList--zd41Ypz.js","static/css/UserList-CST_6g2_.css","static/js/RoleManagement-DJNW1RuO.js","static/css/RoleManagement-DGxGwNmq.css","static/js/SystemLogs-BDVXkfcG.js","static/css/SystemLogs-DhMtojn7.css","static/js/SystemSettings-YidTRQlH.js","static/css/SystemSettings-VopxUJDk.css","static/js/Tenant-BxavujEi.js","static/css/Tenant-DcMT9Cfy.css","static/js/Profile-Dq77rJWb.js","static/css/Profile-CMeEgR-r.css"])))=>i.map(i=>d[i]);
import{b1 as e,U as t,J as a,bP as r,bQ as s,bL as n,bR as o}from"./vue-vendor-BUDnSszI.js";import{aK as i,aL as m,aM as l,aN as c,aO as u,aP as p,aQ as d}from"./vendor-zcc-V1Og.js";import{a as g}from"./network-vendor-ztdpVPaQ.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const f={__name:"App",setup:r=>(r,s)=>{const n=e("router-view");return a(),t(n)}},h=(()=>{const e="http://127.0.0.1:8081/api";return e.endsWith("/")?e:`${e}/`})(),_=g.create({baseURL:h,timeout:3e4,headers:{"Content-Type":"application/json;charset=UTF-8"}});function S(e){if(e.preventDefault)return;const t=e.code,a=e.message||"请求失败";401===t?i.confirm("登录已过期，请重新登录","提示",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then(()=>{V.push("/login")}):403===t?m.error("没有操作权限"):m.error(a)}function v(e,t={},a={}){return _.get(e,{params:t,...a,paramsSerializer:{indexes:null}})}function I(e,t={},a={}){return t instanceof FormData&&(a.headers={...a.headers,"Content-Type":"multipart/form-data"}),_.post(e,t,a)}function A(e,t={},a={}){return _.put(e,t,a)}function y(e,t={},a){return _.delete(e,t)}_.interceptors.request.use(e=>{"string"==typeof e.url&&(e.url=e.url.replace(/^\/+/,""));const t=w();t.token&&(e.headers.Authorization=`Bearer ${t.token}`);const a=t.platformAdmin,r=t.tenant?.id||t.tenant?.tenantId;return!a&&r?e.headers["X-Tenant-Id"]=r:e.headers["X-Tenant-Id"]&&delete e.headers["X-Tenant-Id"],e.params&&e.paramsSerializer&&(e.paramsSerializer={indexes:null}),e},e=>Promise.reject(e)),_.interceptors.response.use(e=>{const t=e.data,a=e.config?.url||"";if(void 0!==t.code){return new Set([0,200,"0","200"]).has(t.code)?void 0!==t.data?t.data:t:(a.includes("batch-import")||S(t),Promise.reject(t))}return void 0!==t.success?t.success?void 0!==t.data?t.data:t:a.includes("batch-import")?Promise.reject({code:t.code,message:t.message}):(S({code:t.code,message:t.message}),Promise.reject(t)):t},e=>((e.config?.url||"").includes("batch-import")||function(e){let t="";if(e.response)switch(e.response.status){case 400:t="请求参数错误";break;case 401:t="未授权，请登录";break;case 403:t="拒绝访问";break;case 404:t=`请求地址不存在: ${e.config.url}`;break;case 408:t="请求超时";break;case 500:t="服务器内部错误";break;case 502:t="网关错误";break;case 503:t="服务不可用";break;case 504:t="网关超时";break;default:t=`网络错误 (${e.response.status})`}else t=e.request?"未收到服务器响应":`请求错误: ${e.message}`;m.error(t)}(e),Promise.reject(e)));const b=(e={})=>{const t={page:1,pageSize:10,...e};return Object.keys(t).forEach(e=>{""!==t[e]&&null!==t[e]&&void 0!==t[e]||delete t[e]}),v("/user/items",t)},j=e=>I("/users",e),P=(e,t)=>A(`/users/${e}/status`,t),k=e=>y(`/users/${e}`),E=e=>I("/users/batch-import",e,{headers:{"Content-Type":"multipart/form-data"}}),O=e=>y("/users/batch-delete",e),L=()=>v("/user/profile"),T=e=>A("/user/profile",e),N=e=>A("/user/password",e),R=e=>A("/user/avatar",e),w=l("user",{state:()=>({token:localStorage.getItem("token")||null,user:JSON.parse(localStorage.getItem("user"))||null,tenant:JSON.parse(localStorage.getItem("tenant"))||null,tenantName:localStorage.getItem("tenantName")||null,platformAdmin:JSON.parse(localStorage.getItem("platformAdmin"))||!1,tenantSuperAdmin:JSON.parse(localStorage.getItem("tenantSuperAdmin"))||!1,preferences:JSON.parse(localStorage.getItem("preferences"))||null,avatar:parseInt(localStorage.getItem("avatar"))||1}),getters:{displayTenantName:e=>e.tenantName||e.tenant?.name||"—",tenantId:e=>e.tenant?.id||null,isPlatformAdmin:e=>e.platformAdmin,isTenantSuperAdmin:e=>e.tenantSuperAdmin,isAdmin:e=>e.platformAdmin||e.tenantSuperAdmin,userAvatar:e=>({1:"/src/assets/avatar/avatar1.jpg",2:"/src/assets/avatar/avatar2.jpg",3:"/src/assets/avatar/avatar3.jpg",4:"/src/assets/avatar/avatar4.jpg",5:"/src/assets/avatar/avatar5.jpg",6:"/src/assets/avatar/avatar6.jpg"}[e.avatar||e.user?.avatar||1]||"/src/assets/avatar/avatar1.jpg"),defaultPage:e=>{const t=e.preferences?.defaultPage;if(t){return{dashboard:"/dashboard",knowledge:"/knowledgelist",service:"/knowledgelist",system:"/system/users",tenant:"/tenant"}[t]||"/dashboard"}return"/dashboard"}},actions:{setToken(e){this.token=e,localStorage.setItem("token",e)},setPreferences(e=null){this.preferences=e||{defaultPage:"dashboard",language:"zh-CN",notifications:!0};try{localStorage.setItem("preferences",JSON.stringify(this.preferences))}catch(t){}},updateUserAvatar(e){this.avatar=e,this.user?this.user.avatar=e:this.user={avatar:e};try{localStorage.setItem("avatar",e.toString()),localStorage.setItem("user",JSON.stringify(this.user))}catch(t){}},setUserFromResponse(e){const t=e.userName||null,a=e.tenantName||null,r=e.tenantId||null,s=e.platformAdmin||!1,n=e.tenantSuperAdmin||!1,o=e.avatar,i=parseInt(localStorage.getItem("avatar"))||1,m=void 0!==o?o:i;if(!t)throw new Error("用户信息不完整，请重新登录");this.user={username:t,avatar:m},this.tenant={id:r?parseInt(r):null,name:a},this.tenantName=a,this.platformAdmin=s,this.tenantSuperAdmin=n,this.avatar=m;try{localStorage.setItem("user",JSON.stringify(this.user)),localStorage.setItem("tenant",JSON.stringify(this.tenant)),localStorage.setItem("tenantName",a||""),localStorage.setItem("platformAdmin",JSON.stringify(s)),localStorage.setItem("tenantSuperAdmin",JSON.stringify(n)),localStorage.setItem("avatar",m.toString())}catch(l){}},async login(e){const t=await(e=>I("/auth/login",e))(e),a=t?.data||t,r=a?.token||`mock-${a?.userName||"user"}-${Date.now()}`;this.setToken(r),this.setUserFromResponse(a)},logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("tenant"),localStorage.removeItem("tenantName"),localStorage.removeItem("platformAdmin"),localStorage.removeItem("tenantSuperAdmin"),localStorage.removeItem("preferences"),localStorage.removeItem("avatar"),this.$reset()}}}),D=[{path:"/",component:()=>c(()=>import("./AuthLayout-C1GSA4K8.js"),__vite__mapDeps([0,1,2,3,4,5])),children:[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:()=>c(()=>import("./Login-C5DnP3f3.js"),__vite__mapDeps([6,2,3,4,7,8,1,9,10,11]))},{path:"/register",name:"Register",component:()=>c(()=>import("./Register-KL8kLTKc.js"),__vite__mapDeps([12,2,3,4,7,8,1,9,13]))}]},{path:"/",component:()=>c(()=>import("./DefaultLayout-Blot1bEe.js"),__vite__mapDeps([14,7,2,3,4,1,15,16,10,17])),meta:{requiresAuth:!0},children:[{path:"/dashboard",name:"Dashboard",component:()=>c(()=>import("./Dashboard-Dj1RZi6u.js"),__vite__mapDeps([18,3,2,4,15,16,1,10,19])),meta:{title:"工作台"}},{path:"/knowledgelist",name:"KnowledgeList",component:()=>c(()=>import("./KnowledgeList-Bs4AXH3w.js"),__vite__mapDeps([20,2,3,4,21,1,22,10,23])),meta:{title:"所有知识库"}},{path:"/knowledgebase/:id",name:"KnowledgeBase",component:()=>c(()=>import("./KnowledgeBase-p4WBa7za.js"),__vite__mapDeps([24,2,3,4,21,1,10,25])),meta:{title:"知识库详情"}},{path:"/service",name:"Service",component:()=>c(()=>import("./Service-D7X7S-Yf.js"),__vite__mapDeps([26,2,3,4,7,22,16,1,10,27])),meta:{title:"服务管理"}},{path:"/system/users",name:"UsersList",component:()=>c(()=>import("./UserList--zd41Ypz.js"),__vite__mapDeps([28,2,3,4,1,10,29])),meta:{title:"用户管理"}},{path:"/system/roles",name:"RoleManagement",component:()=>c(()=>import("./RoleManagement-DJNW1RuO.js"),__vite__mapDeps([30,1,3,2,4,31])),meta:{title:"角色权限管理"}},{path:"/system/logs",name:"SystemLogs",component:()=>c(()=>import("./SystemLogs-BDVXkfcG.js"),__vite__mapDeps([32,1,2,3,4,33])),meta:{title:"系统日志"}},{path:"/system/settings",name:"SystemSettings",component:()=>c(()=>import("./SystemSettings-YidTRQlH.js"),__vite__mapDeps([34,1,3,2,4,10,35])),meta:{title:"系统参数"}},{path:"/tenant",name:"Tenant",component:()=>c(()=>import("./Tenant-BxavujEi.js"),__vite__mapDeps([36,2,3,4,1,10,37])),meta:{title:"租户管理"}},{path:"/profile",name:"Profile",component:()=>c(()=>import("./Profile-Dq77rJWb.js"),__vite__mapDeps([38,2,3,4,1,10,39])),meta:{title:"个人中心"}}]}],V=r({history:s(),routes:D});V.beforeEach(async(e,t,a)=>{const r=w();if("/login"===e.path&&r.token){if(!r.preferences)try{await r.fetchPreferences()}catch(s){}return a(r.defaultPage)}if(e.meta.requiresAuth&&!r.token)return a("/login");if(r.token&&!r.user){const e=localStorage.getItem("user");if(!e)return a("/login");try{const t=JSON.parse(e);r.user=t,r.fetchPreferences().catch(e=>{})}catch(n){return a("/login")}}if("/tenant"===e.path){if(!r.platformAdmin)return a("/dashboard")}else if(e.path.startsWith("/system/")){if(!r.platformAdmin&&!r.tenantSuperAdmin)return a("/dashboard");if("/system/users"===e.path&&r.platformAdmin)return a("/dashboard")}a()});const J=n(f),$=u();J.use($),J.use(V),J.use(p,{locale:d});for(const[U,z]of Object.entries(o))J.component(U,z);J.mount("#app");export{v as a,A as b,j as c,y as d,E as e,O as f,b as g,P as h,k as i,L as j,T as k,N as l,R as m,I as p,w as u};
