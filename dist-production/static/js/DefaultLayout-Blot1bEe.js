import{_ as e}from"./logo-B9TFvINw.js";import{bY as a,r as l,d as t,w as s,b1 as n,U as d,J as u,V as i,a1 as o,X as r,K as c,u as m,bZ as p,bG as _,b_ as v,Z as f,b$ as y,bV as w,bT as k,bS as b,F as g,a7 as x,I as h,$ as A,a0 as N,av as S,c0 as D,aO as T,N as j}from"./vue-vendor-BUDnSszI.js";import{u as I}from"./index-8D9d6p3q.js";import{_ as z}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{u as B}from"./useWebSocket-CuTw-Xrt.js";import{g as C}from"./ticket-DtMqVmfI.js";import"./vendor-zcc-V1Og.js";import"./network-vendor-ztdpVPaQ.js";const E=z({__name:"SideBar",setup(e){const b=a(),g=l(b.path),x=I(),h=t(()=>x.platformAdmin||x.tenantSuperAdmin),A=t(()=>x.platformAdmin);s(()=>b.path,e=>{g.value=e});const N=e=>{};return(e,a)=>{const l=n("el-icon"),t=n("el-menu-item"),s=n("el-sub-menu"),b=n("el-menu");return u(),d(b,{"default-active":g.value,class:"el-menu-vertical",router:"",collapse:!1,onSelect:N},{default:i(()=>[o(t,{index:"/dashboard"},{default:i(()=>[o(l,null,{default:i(()=>[o(m(p))]),_:1}),a[0]||(a[0]=c("span",null,"工作台",-1))]),_:1,__:[0]}),m(x).platformAdmin?r("",!0):(u(),d(t,{key:0,index:"/knowledgelist"},{default:i(()=>[o(l,null,{default:i(()=>[o(m(_))]),_:1}),a[1]||(a[1]=c("span",null,"知识库管理中心",-1))]),_:1,__:[1]})),m(x).platformAdmin?r("",!0):(u(),d(t,{key:1,index:"/service"},{default:i(()=>[o(l,null,{default:i(()=>[o(m(v))]),_:1}),a[2]||(a[2]=c("span",null,"知识服务中心",-1))]),_:1,__:[2]})),h.value?(u(),d(s,{key:2,index:"system"},{title:i(()=>[o(l,null,{default:i(()=>[o(m(y))]),_:1}),a[3]||(a[3]=c("span",null,"系统管理中心",-1))]),default:i(()=>[m(x).platformAdmin?r("",!0):(u(),d(t,{key:0,index:"/system/users"},{default:i(()=>a[4]||(a[4]=[f("用户管理")])),_:1,__:[4]})),o(t,{index:"/system/roles"},{default:i(()=>a[5]||(a[5]=[f("角色权限管理")])),_:1,__:[5]}),o(t,{index:"/system/settings"},{default:i(()=>a[6]||(a[6]=[f("系统参数")])),_:1,__:[6]}),o(t,{index:"/system/logs"},{default:i(()=>a[7]||(a[7]=[f("系统日志")])),_:1,__:[7]})]),_:1})):r("",!0),A.value?(u(),d(t,{key:3,index:"/tenant"},{default:i(()=>[o(l,null,{default:i(()=>[o(m(w))]),_:1}),a[8]||(a[8]=c("span",null,"租户管理中心",-1))]),_:1,__:[8]})):r("",!0),o(t,{index:"/profile"},{default:i(()=>[o(l,null,{default:i(()=>[o(m(k))]),_:1}),a[9]||(a[9]=c("span",null,"个人中心",-1))]),_:1,__:[9]})]),_:1},8,["default-active"])}}},[["__scopeId","data-v-40e66356"]]),L={class:"header-content"},W={class:"desktop-info"},O={key:0,class:"tenant"},$={key:1,class:"roles"},F={class:"user-info"},V={class:"el-dropdown-link"},Z={class:"username"},G=z({__name:"DefaultLayout",setup(a){const s=b(),p=I(),{notifications:_}=B(),v=l([]),y=l(!1),w=l(!1),k=t(()=>p.displayTenantName),z=t(()=>{const e=[];return p.platformAdmin&&e.push("平台管理员"),p.tenantSuperAdmin&&e.push("超级管理员"),e}),G=t(()=>p.user?.username||"用户"),J=t(()=>p.userAvatar),K=t(()=>[...v.value||[],..._.list||[]].filter((e,a,l)=>a===l.findIndex(a=>a.id===e.id)).sort((e,a)=>(a.timestamp||0)-(e.timestamp||0))),U=t(()=>K.value.length),X=()=>{s.push("/dashboard")},Y=t(()=>w.value?y.value?"0px":"220px":y.value?"64px":"220px"),q=()=>{const e=w.value;w.value=window.innerWidth<=768,e&&!w.value?y.value=!1:!e&&w.value&&(y.value=!0)},H=()=>{y.value=!y.value},M=()=>{q()};let P=null;const Q=async()=>{};g(()=>{q(),window.addEventListener("resize",M),P=setInterval(Q,9e5),setTimeout(()=>{Q()},1e3),(async()=>{try{const e=await C();e&&(Array.isArray(e)?v.value=e.map(e=>({id:e.id||Date.now(),knowledgeBaseName:e.knowledgeBaseName||"未知知识库",userName:e.userName||"未知用户",feedbackType:e.feedbackType||"工单通知",createdAt:e.createdAt||(new Date).toISOString(),type:e.type||"NEW",timestamp:new Date(e.createdAt||Date.now()).getTime()})):e.data&&Array.isArray(e.data)&&(v.value=e.data.map(e=>({id:e.id||Date.now(),knowledgeBaseName:e.knowledgeBaseName||"未知知识库",userName:e.userName||"未知用户",feedbackType:e.feedbackType||"工单通知",createdAt:e.createdAt||(new Date).toISOString(),type:e.type||"NEW",timestamp:new Date(e.createdAt||Date.now()).getTime()}))))}catch(e){}})()}),x(()=>{P&&clearInterval(P),window.removeEventListener("resize",M)});const R=async()=>{p.logout(),await s.push("/login")};return(a,l)=>{const t=n("el-button"),s=n("el-tag"),_=n("el-icon"),v=n("el-badge"),b=n("el-avatar"),g=n("el-dropdown-item"),x=n("el-dropdown-menu"),I=n("el-dropdown"),B=n("el-header"),C=n("el-aside"),K=n("router-view"),q=n("el-main"),M=n("el-container");return u(),d(M,{class:"main-container"},{default:i(()=>[o(B,{class:"top-header",height:"60px"},{default:i(()=>[c("div",L,[l[3]||(l[3]=c("div",{class:"logo-container"},[c("img",{src:e,alt:"Logo",class:"logo"}),c("span",{class:"system-name"},"知识管理系统")],-1)),o(t,{class:"mobile-menu-btn",onClick:H,icon:y.value?"Expand":"Fold",circle:"",size:"small"},null,8,["icon"]),c("div",W,[m(p).platformAdmin?r("",!0):(u(),h("div",O,"租户："+A(k.value),1)),z.value.length?(u(),h("div",$,[(u(!0),h(N,null,S(z.value,(e,a)=>(u(),d(s,{key:a,size:"small",type:"info",class:"role-tag"},{default:i(()=>[f(A(e),1)]),_:2},1024))),128))])):r("",!0)]),c("div",{class:"notification-bell",onClick:X},[o(v,{value:U.value,max:99,class:"notification-badge"},{default:i(()=>[o(_,{class:"bell-icon"},{default:i(()=>[o(m(D))]),_:1})]),_:1},8,["value"])]),c("div",F,[o(I,null,{dropdown:i(()=>[o(x,null,{default:i(()=>[o(g,{onClick:l[0]||(l[0]=e=>a.$router.push("/profile"))},{default:i(()=>l[1]||(l[1]=[f("个人中心")])),_:1,__:[1]}),o(g,{onClick:R},{default:i(()=>l[2]||(l[2]=[f("退出登录")])),_:1,__:[2]})]),_:1})]),default:i(()=>[c("span",V,[o(b,{size:30,src:J.value},null,8,["src"]),c("span",Z,A(G.value),1),o(_,null,{default:i(()=>[o(m(T))]),_:1})])]),_:1})])])]),_:1}),o(M,null,{default:i(()=>[o(C,{width:Y.value,class:j(["aside-container",{"sidebar-collapsed":y.value}])},{default:i(()=>[o(E)]),_:1},8,["width","class"]),o(q,{class:j(["main-content",{"content-expanded":y.value}])},{default:i(()=>[o(K)]),_:1},8,["class"])]),_:1}),!y.value&&w.value?(u(),h("div",{key:0,class:"sidebar-overlay",onClick:H})):r("",!0)]),_:1})}}},[["__scopeId","data-v-4506b431"]]);export{G as default};
