import{bY as e,r as a,w as l,a as t,b1 as u,U as i,J as s,V as n,a1 as r,X as o,I as d,a0 as c,av as p,Z as v,K as m,u as g,bb as _,br as f,$ as b,n as y,F as h,bh as w,W as k,bE as C,as as V,d as S,au as x,bT as z,bU as U,b_ as N,aa as O,c8 as I,c9 as B,ca as j,bX as A,ae as T,bS as q,aG as E,Y as R}from"./vue-vendor-BUDnSszI.js";import{b as D,u as F,e as L,f as $,h as P,i as K,j as M,k as Y,l as J,m as G,n as X,o as W,p as Z,q as H,r as Q,s as ee,t as ae,v as le,w as te,x as ue,y as ie,z as se}from"./kb-DvJy3p-L.js";import{_ as ne}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{aL as re,aK as oe,aS as de,aT as ce}from"./vendor-zcc-V1Og.js";import{u as pe,g as ve}from"./index-8D9d6p3q.js";import"./network-vendor-ztdpVPaQ.js";const me={key:3,class:"custom-init-params"},ge={class:"params-section"},_e={class:"params-grid"},fe={class:"param-item"},be={class:"param-item"},ye={class:"param-item full-width"},he={class:"description-content"},we=["src"],ke={class:"dialog-footer"},Ce=ne({__name:"CreateData",props:{visible:{type:Boolean,required:!0}},emits:["update:visible","add"],setup(h,{emit:w}){const k=e(),C=h,V=w,S=a(!1);l(()=>C.visible,e=>{S.value=e}),l(S,e=>{V("update:visible",e)});const x=()=>{R.value?oe.confirm("æ­£åœ¨æäº¤ä¸­ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ","æç¤º",{type:"warning"}).then(()=>{V("update:visible",!1),H()}).catch(()=>{}):(V("update:visible",!1),H())},z=a(null),U=a(null),N=a(null),O=a(null),I=a([]),B=a([]),j=a([]),A=a(!1),T=a(""),q=t({type:"document",initStrategy:"smart",customConfig:{chunkSize:1e3,chunkOverlap:200,separator:"\n\n"}}),E=a(k.params.id||k.path.split("/").pop()),R=a(!1),F=[{label:"æ–‡æ¡£",value:"document"},{label:"å›¾ç‰‡",value:"image"},{label:"éŸ³è§†é¢‘",value:"media"}],L={type:[{required:!0,message:"è¯·é€‰æ‹©æ•°æ®æºç±»å‹",trigger:"change"}],files:[{validator:(e,a,l)=>{"document"===q.type&&0===I.value.length?l(new Error("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶")):l()},trigger:["change","blur"]}],images:[{validator:(e,a,l)=>{"image"===q.type&&0===B.value.length?l(new Error("è¯·è‡³å°‘é€‰æ‹©ä¸€å¼ å›¾ç‰‡")):l()},trigger:["change","blur"]}],media:[{validator:(e,a,l)=>{"media"===q.type&&0===j.value.length?l(new Error("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªéŸ³è§†é¢‘æ–‡ä»¶")):l()},trigger:["change","blur"]}],initStrategy:[{required:!0,message:"è¯·é€‰æ‹©åˆå§‹åŒ–ç­–ç•¥",trigger:"change"}]},$=e=>{"document"===e?(B.value=[],j.value=[],N.value&&N.value.clearFiles(),O.value&&O.value.clearFiles()):"image"===e?(I.value=[],j.value=[],U.value&&U.value.clearFiles(),O.value&&O.value.clearFiles()):"media"===e&&(I.value=[],B.value=[],U.value&&U.value.clearFiles(),N.value&&N.value.clearFiles())},P=e=>{},K=()=>{const e="document"===q.type?5:"image"===q.type?10:5;re.warning(`æœ€å¤šä¸Šä¼  ${e} ä¸ªæ–‡ä»¶`)},M=e=>{const a=e.name.split(".").pop().toLowerCase(),l=e.size/1024/1024<2;return["pdf","doc","docx","txt"].includes(a)?!!l||(re.error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 2MB"),!1):(re.error(`ä¸æ”¯æŒ ${a} æ ¼å¼çš„æ–‡ä»¶`),!1)},Y=e=>{const a=e.name.split(".").pop().toLowerCase(),l=e.size/1024/1024<5;return["jpg","jpeg","png","gif","bmp","webp"].includes(a)?!!l||(re.error("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB"),!1):(re.error(`ä¸æ”¯æŒ ${a} æ ¼å¼çš„å›¾ç‰‡`),!1)},J=e=>{const a=e.name.split(".").pop().toLowerCase(),l=e.size/1024/1024<50;return["mp3","wav","ogg","mp4","avi","mov","wmv","flv","mkv"].includes(a)?!!l||(re.error("éŸ³è§†é¢‘æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 50MB"),!1):(re.error(`ä¸æ”¯æŒ ${a} æ ¼å¼çš„éŸ³è§†é¢‘æ–‡ä»¶`),!1)},G=(e,a)=>{I.value=a},X=(e,a)=>{B.value=a},W=(e,a)=>{j.value=a},Z=e=>{T.value=e.url,A.value=!0},H=()=>{q.type="document",q.initStrategy="smart",q.customConfig={chunkSize:1e3,chunkOverlap:200,separator:"\n\n"},I.value=[],B.value=[],j.value=[],U.value&&U.value.clearFiles(),N.value&&N.value.clearFiles(),O.value&&O.value.clearFiles()},Q=async()=>{if(!R.value)try{await z.value.validate(),R.value=!0;const e=new FormData;e.append("knowledge_base_id",E.value),e.append("type",q.type);const a={smart:0,default:1,custom:2}[q.initStrategy];if(void 0===a)return void re.error("æ— æ•ˆçš„åˆå§‹åŒ–ç­–ç•¥");if(e.append("init_strategy_type",a),"custom"===q.initStrategy){const a={chunk_size:q.customConfig.chunkSize,chunk_overlap:q.customConfig.chunkOverlap,separator:q.customConfig.separator};e.append("custom_config",JSON.stringify(a))}if("document"===q.type){if(0===I.value.length)return void re.error("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶");I.value.forEach(a=>{e.append("files",a.raw)})}else if("image"===q.type){if(0===B.value.length)return void re.error("è¯·è‡³å°‘é€‰æ‹©ä¸€å¼ å›¾ç‰‡");B.value.forEach(a=>{e.append("images",a.raw)})}else if("media"===q.type){if(0===j.value.length)return void re.error("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªéŸ³è§†é¢‘æ–‡ä»¶");j.value.forEach(a=>{e.append("media_files",a.raw)})}const l=await D(E.value,e);l?(V("add",{type:q.type,initStrategy:q.initStrategy,customConfig:"custom"===q.initStrategy?q.customConfig:null,data:l.data||l}),S.value=!1,H()):re.error(`åˆ›å»ºæ•°æ®æºå¤±è´¥: ${l.message||"æœªçŸ¥é”™è¯¯"}`)}catch(e){re.error(e.message||"æäº¤å¤±è´¥")}finally{R.value=!1}};return l(S,e=>{e&&y(()=>{U.value,N.value,O.value})}),(e,a)=>{const l=u("el-option"),t=u("el-select"),y=u("el-form-item"),h=u("el-button"),w=u("el-upload"),k=u("el-icon"),C=u("el-radio"),V=u("el-radio-group"),E=u("el-input-number"),D=u("el-input"),H=u("el-form"),ee=u("el-dialog");return s(),i(ee,{title:"æ·»åŠ æ•°æ®æº",modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=e=>S.value=e),width:"600px",onClose:x},{footer:n(()=>[m("div",ke,[r(h,{onClick:x,disabled:R.value},{default:n(()=>a[24]||(a[24]=[v("å–æ¶ˆ")])),_:1,__:[24]},8,["disabled"]),r(h,{type:"primary",onClick:Q,loading:R.value},{default:n(()=>[v(b(R.value?"æäº¤ä¸­...":"ç¡®å®š"),1)]),_:1},8,["loading"])])]),default:n(()=>[r(H,{ref_key:"formRef",ref:z,model:q,rules:L,"label-width":"100px"},{default:n(()=>[r(y,{label:"æ•°æ®æºç±»å‹",prop:"type"},{default:n(()=>[r(t,{modelValue:q.type,"onUpdate:modelValue":a[0]||(a[0]=e=>q.type=e),placeholder:"è¯·é€‰æ‹©ç±»å‹",style:{width:"100%"},onChange:$},{default:n(()=>[(s(),d(c,null,p(F,e=>r(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),"document"===q.type?(s(),i(y,{key:0,label:"ä¸Šä¼ æ–‡ä»¶",prop:"files"},{default:n(()=>[r(w,{ref_key:"uploadRef",ref:U,"file-list":I.value,limit:5,"on-exceed":K,"on-change":G,"before-upload":M,multiple:"","auto-upload":!1},{tip:n(()=>a[9]||(a[9]=[m("div",{class:"el-upload__tip"}," æ”¯æŒæ‰©å±•åï¼š.pdf .doc .docx .txt ç­‰ï¼Œå•ä¸ªæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 2MB ",-1)])),default:n(()=>[r(h,{size:"small",type:"primary"},{default:n(()=>a[8]||(a[8]=[v("é€‰æ‹©æ–‡ä»¶")])),_:1,__:[8]})]),_:1},8,["file-list"])]),_:1})):o("",!0),"image"===q.type?(s(),i(y,{key:1,label:"ä¸Šä¼ å›¾ç‰‡",prop:"images"},{default:n(()=>[r(w,{ref_key:"imageUploadRef",ref:N,"file-list":B.value,limit:10,"on-exceed":K,"on-change":X,"before-upload":Y,multiple:"","auto-upload":!1,"list-type":"picture-card","on-preview":Z},{tip:n(()=>a[10]||(a[10]=[m("div",{class:"el-upload__tip"}," æ”¯æŒæ‰©å±•åï¼š.jpg .jpeg .png .gif .bmp ç­‰ï¼Œå•ä¸ªå›¾ç‰‡å¤§å°ä¸è¶…è¿‡ 5MB ",-1)])),default:n(()=>[r(k,null,{default:n(()=>[r(g(_))]),_:1})]),_:1},8,["file-list"])]),_:1})):o("",!0),"media"===q.type?(s(),i(y,{key:2,label:"ä¸Šä¼ éŸ³è§†é¢‘",prop:"media",rules:L.media},{default:n(()=>[r(w,{ref_key:"mediaUploadRef",ref:O,"file-list":j.value,"onUpdate:fileList":a[1]||(a[1]=e=>j.value=e),action:"",multiple:!0,limit:5,"on-exceed":K,"before-upload":J,"on-change":W,"auto-upload":!1,"list-type":"text",accept:".mp3,.wav,.ogg,.mp4,.avi,.mov,.wmv,.flv,.mkv"},{tip:n(()=>a[12]||(a[12]=[m("div",{class:"el-upload__tip"}," æ”¯æŒ mp3, wav, ogg, mp4, avi, mov, wmv, flv, mkv æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 50MB ",-1)])),default:n(()=>[r(h,{type:"primary",icon:g(_)},{default:n(()=>a[11]||(a[11]=[v("é€‰æ‹©éŸ³è§†é¢‘æ–‡ä»¶")])),_:1,__:[11]},8,["icon"])]),_:1},8,["file-list"])]),_:1},8,["rules"])):o("",!0),r(y,{label:"åˆå§‹åŒ–ç­–ç•¥",prop:"initStrategy"},{default:n(()=>[r(V,{modelValue:q.initStrategy,"onUpdate:modelValue":a[2]||(a[2]=e=>q.initStrategy=e),onChange:P},{default:n(()=>[r(C,{value:"smart"},{default:n(()=>a[13]||(a[13]=[v("æ™ºèƒ½åˆå§‹åŒ–")])),_:1,__:[13]}),r(C,{value:"default"},{default:n(()=>a[14]||(a[14]=[v("é»˜è®¤åˆå§‹åŒ–")])),_:1,__:[14]}),r(C,{value:"custom"},{default:n(()=>a[15]||(a[15]=[v("è‡ªå®šä¹‰åˆå§‹åŒ–")])),_:1,__:[15]})]),_:1},8,["modelValue"])]),_:1}),"custom"===q.initStrategy?(s(),d("div",me,[m("div",ge,[a[21]||(a[21]=m("h4",{class:"params-title"},"è‡ªå®šä¹‰åˆå§‹åŒ–å‚æ•°",-1)),m("div",_e,[m("div",fe,[a[16]||(a[16]=m("label",{class:"param-label"},"åˆ†å—å¤§å°",-1)),r(E,{modelValue:q.customConfig.chunkSize,"onUpdate:modelValue":a[3]||(a[3]=e=>q.customConfig.chunkSize=e),min:100,max:5e3,step:100,size:"small"},null,8,["modelValue"]),a[17]||(a[17]=m("span",{class:"param-desc"},"å­—ç¬¦æ•°",-1))]),m("div",be,[a[18]||(a[18]=m("label",{class:"param-label"},"é‡å å¤§å°",-1)),r(E,{modelValue:q.customConfig.chunkOverlap,"onUpdate:modelValue":a[4]||(a[4]=e=>q.customConfig.chunkOverlap=e),min:0,max:1e3,step:50,size:"small"},null,8,["modelValue"]),a[19]||(a[19]=m("span",{class:"param-desc"},"å­—ç¬¦æ•°",-1))]),m("div",ye,[a[20]||(a[20]=m("label",{class:"param-label"},"åˆ†éš”ç¬¦",-1)),r(D,{modelValue:q.customConfig.separator,"onUpdate:modelValue":a[5]||(a[5]=e=>q.customConfig.separator=e),placeholder:"ä¾‹å¦‚ï¼š\\n\\n",size:"small"},null,8,["modelValue"])])])])])):o("",!0),"custom"!==q.initStrategy?(s(),i(y,{key:4,class:"strategy-description"},{default:n(()=>[m("div",he,["smart"===q.initStrategy?(s(),d(c,{key:0},[r(k,null,{default:n(()=>[r(g(f))]),_:1}),a[22]||(a[22]=m("span",null,"æ™ºèƒ½åˆå§‹åŒ–å°†è‡ªåŠ¨åˆ†æå†…å®¹ï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä½³çš„åˆ†å—ç­–ç•¥å’Œå‚æ•°",-1))],64)):"default"===q.initStrategy?(s(),d(c,{key:1},[r(k,null,{default:n(()=>[r(g(f))]),_:1}),a[23]||(a[23]=m("span",null,"ä½¿ç”¨æœ¬çŸ¥è¯†åº“é»˜è®¤å‚æ•°è¿›è¡Œåˆå§‹åŒ–",-1))],64)):o("",!0)])]),_:1})):o("",!0)]),_:1},8,["model"]),r(ee,{modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=e=>A.value=e),title:"å›¾ç‰‡é¢„è§ˆ",width:"60%"},{default:n(()=>[m("img",{"w-full":"",src:T.value,alt:"Preview Image",style:{"max-width":"100%"}},null,8,we)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-0273ace4"]]),Ve={class:"data-source-tab"},Se={class:"header"},xe={class:"action-bar"},ze={key:0,class:"pagination"},Ue={key:1,class:"empty-state"},Ne=ne({__name:"DataSourceTab",setup(t){const c=e().params.id,p=a([]),_=a(!1),f=a(!1),y=a(""),S=a(1),x=a(10),z=a(0);let U=null;const N=F(),O=()=>{const e=N.userRole;return 1===e||2===e||3===e},I=async()=>{try{_.value=!0;const e={page:S.value,page_size:x.value};y.value.trim()&&(e.search=y.value.trim());const a=await L(c,e);p.value=(a.items||a||[]).map(e=>({...e,deleting:!1,syncing:!1})),z.value=a.total||(a.items?a.items.length:a.length)||0}catch(e){re.error("è·å–æ•°æ®æºåˆ—è¡¨å¤±è´¥: "+(e.message||"æœªçŸ¥é”™è¯¯")),p.value=[],z.value=0}finally{_.value=!1}};l(y,e=>{U&&clearTimeout(U),U=setTimeout(()=>{S.value=1,I()},500)});const B=()=>{S.value=1,I()},j=()=>{S.value=1,I()},A=e=>{S.value=e,I()},T=e=>{x.value=e,S.value=1,I()},q=()=>{I()},E=()=>{f.value=!0},R=async()=>{try{re.success("æ•°æ®æºæ·»åŠ æˆåŠŸ"),S.value=1,await I()}catch(e){re.error("æ·»åŠ æ•°æ®æºå¤±è´¥: "+(e.message||"æœªçŸ¥é”™è¯¯"))}},D=e=>({DONE:"å®Œæˆ",TODO:"å¾…å¤„ç†",PROCESSING:"å¤„ç†ä¸­",FAILED:"å¤±è´¥"}[e]||e);return h(I),(e,a)=>{const l=u("el-icon"),t=u("el-input"),h=u("el-button"),U=u("el-table-column"),N=u("el-tag"),F=u("el-table"),L=u("el-pagination"),K=u("el-empty"),M=w("loading");return s(),d("div",Ve,[m("div",Se,[r(t,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),placeholder:"æœç´¢æ•°æ®æºåç§°ã€ç±»å‹æˆ–ä¸Šä¼ äºº",class:"pill-input search-input",clearable:"",onClear:j,onKeyup:V(B,["enter"])},{prefix:n(()=>[r(l,null,{default:n(()=>[r(g(C))]),_:1})]),_:1},8,["modelValue"]),m("div",xe,[O()?(s(),i(h,{key:0,type:"primary",onClick:E},{default:n(()=>a[4]||(a[4]=[v(" + æ·»åŠ æ•°æ®æº ")])),_:1,__:[4]})):o("",!0),r(h,{onClick:q,loading:_.value},{default:n(()=>a[5]||(a[5]=[v("åˆ·æ–°")])),_:1,__:[5]},8,["loading"])])]),k((s(),i(F,{data:p.value,stripe:"",style:{width:"100%"}},{default:n(()=>[r(U,{prop:"name",label:"åç§°"}),r(U,{prop:"file_type",label:"ç±»å‹"},{default:n(({row:e})=>{return[r(N,{type:(a=e.file_type,{pdf:"primary",csv:"success",docx:"info",txt:"warning",xlsx:"success",doc:"info",ppt:"warning",pptx:"warning"}[a]||"info")},{default:n(()=>[v(b(e.file_type.toUpperCase()),1)]),_:2},1032,["type"])];var a}),_:1}),r(U,{prop:"uploader_name",label:"ä¸Šä¼ äºº"}),r(U,{prop:"updated_time",label:"æ›´æ–°æ—¶é—´"},{default:n(({row:e})=>{return[v(b((a=e.updated_time,new Date(a).toLocaleString())),1)];var a}),_:1}),r(U,{prop:"status",label:"çŠ¶æ€"},{default:n(({row:e})=>{return[r(N,{type:(a=e.status,{DONE:"success",TODO:"info",PROCESSING:"warning",FAILED:"danger"}[a]||"info")},{default:n(()=>[v(b(D(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),r(U,{label:"æ“ä½œ",width:"260"},{default:n(({row:e})=>[r(h,{size:"small",text:"",onClick:a=>(async e=>{try{const a=(await $(c,e.id)).url;a?(window.open(a,"_blank"),re.success("æ–‡ä»¶é“¾æ¥è·å–æˆåŠŸ")):re.warning("æœªæ‰¾åˆ°æœ‰æ•ˆçš„ä¸‹è½½é“¾æ¥")}catch(a){re.error("è·å–æ–‡ä»¶é“¾æ¥å¤±è´¥: "+(a.message||"æœªçŸ¥é”™è¯¯"))}})(e)},{default:n(()=>[r(l,null,{default:n(()=>[r(g(C))]),_:1}),a[6]||(a[6]=v(" æŸ¥çœ‹å†…å®¹ "))]),_:2,__:[6]},1032,["onClick"]),O()?(s(),i(h,{key:0,size:"small",text:"",onClick:e=>{}},{default:n(()=>a[7]||(a[7]=[v(" ç¼–è¾‘ ")])),_:2,__:[7]},1032,["onClick"])):o("",!0),O()?(s(),i(h,{key:1,size:"small",text:"",type:"danger",onClick:a=>(e=>{oe.confirm("ç¡®å®šåˆ é™¤è¯¥æ•°æ®æºå—ï¼Ÿ","è­¦å‘Š",{type:"warning",confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ"}).then(async()=>{try{e.deleting=!0,await P(c,e.id),re.success("åˆ é™¤æˆåŠŸ"),await I()}catch(a){re.error("åˆ é™¤å¤±è´¥: "+a.message)}finally{e.deleting=!1}}).catch(()=>{})})(e),loading:e.deleting},{default:n(()=>a[8]||(a[8]=[v(" åˆ é™¤ ")])),_:2,__:[8]},1032,["onClick","loading"])):o("",!0)]),_:1})]),_:1},8,["data"])),[[M,_.value]]),z.value>0?(s(),d("div",ze,[r(L,{"current-page":S.value,"onUpdate:currentPage":a[1]||(a[1]=e=>S.value=e),"page-size":x.value,"onUpdate:pageSize":a[2]||(a[2]=e=>x.value=e),total:z.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:A,onSizeChange:T},null,8,["current-page","page-size","total"])])):o("",!0),0!==p.value.length||_.value?o("",!0):(s(),d("div",Ue,[r(K,{description:y.value?"æœªæ‰¾åˆ°åŒ¹é…çš„æ•°æ®æº":"æš‚æ— æ•°æ®æº"},null,8,["description"])])),r(Ce,{visible:f.value,"onUpdate:visible":a[3]||(a[3]=e=>f.value=e),onAdd:R,"knowledge-base-id":g(c)},null,8,["visible","knowledge-base-id"])])}}},[["__scopeId","data-v-a967f322"]]),Oe={class:"user-selector"},Ie={class:"search-results"},Be={class:"user-info"},je={class:"user-details"},Ae={class:"user-name"},Te={class:"user-meta"},qe={class:"user-email"},Ee={key:0,class:"loading-state"},Re={key:0,class:"selected-count"},De={class:"action-footer"},Fe=ne({__name:"UserSelector",props:{excludeUsers:{type:Array,default:()=>[]},initialSelectedUsers:{type:Array,default:()=>[]}},emits:["select","cancel"],setup(e,{emit:t}){const _=e,f=t,y=pe(),w=a(""),k=a([]),V=a([]),z=a(!1);l(()=>_.initialSelectedUsers,e=>{Array.isArray(e)&&e.length>0?V.value=e.map(e=>String(e.id)):V.value=[]},{immediate:!0});const U=S(()=>{const e=new Set(_.excludeUsers.map(String)),a=(w.value||"").toLowerCase();return k.value.filter(l=>{const t=String(l.id);if(V.value.includes(t))return!0;if(e.has(t))return!1;const u=(l.userName||"").toLowerCase(),i=(l.email||"").toLowerCase();return!a||u.includes(a)||i.includes(a)})}),N=()=>{},O=()=>{const e=new Set(V.value.map(String)),a=k.value.filter(a=>e.has(String(a.id)));f("select",a)},I=()=>f("cancel");return h(()=>{(async()=>{try{z.value=!0;const e=y?.tenantId;if(!e)return void re.error("æ— æ³•è·å–ç§Ÿæˆ·ä¿¡æ¯");const a=await ve(e),l=a?.items??[];k.value=l.filter(e=>1===Number(e.status)).map(e=>({id:Number(e.id),userName:e.userName||"",email:e.email||"",status:Number(e.status),avatar:e.avatar||""}))}catch(e){re.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥: "+(e.message||"æœªçŸ¥é”™è¯¯")),k.value=[]}finally{z.value=!1}})()}),(e,a)=>{const l=u("el-icon"),t=u("el-input"),f=u("el-avatar"),y=u("el-tag"),h=u("el-checkbox"),k=u("el-checkbox-group"),S=u("el-empty"),B=u("el-button");return s(),d("div",Oe,[r(t,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),placeholder:"æœç´¢ç”¨æˆ·",clearable:"",onInput:N},{prefix:n(()=>[r(l,null,{default:n(()=>[r(g(C))]),_:1})]),_:1},8,["modelValue"]),m("div",Ie,[r(k,{modelValue:V.value,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value=e)},{default:n(()=>[(s(!0),d(c,null,p(U.value,e=>{return s(),d("div",{key:e.id,class:"user-item"},[r(h,{label:String(e.id),disabled:(a=e.id,_.excludeUsers.map(String).includes(String(a)))},{default:n(()=>[m("div",Be,[r(f,{size:32,src:e.avatar||""},null,8,["src"]),m("div",je,[m("div",Ae,b(e.userName),1),m("div",Te,[m("span",qe,b(e.email),1),r(y,{type:1===e.status?"success":"danger",size:"small"},{default:n(()=>[v(b(1===e.status?"å¯ç”¨":"ç¦ç”¨"),1)]),_:2},1032,["type"])])])])]),_:2},1032,["label","disabled"])]);var a}),128))]),_:1},8,["modelValue"]),z.value?(s(),d("div",Ee,[r(l,{class:"loading-icon"},{default:n(()=>[r(g(x))]),_:1}),a[2]||(a[2]=m("span",null,"åŠ è½½ä¸­...",-1))])):0===U.value.length&&w.value?(s(),i(S,{key:1,description:"æœªæ‰¾åˆ°ç›¸å…³ç”¨æˆ·"})):0===U.value.length?(s(),i(S,{key:2,description:"æš‚æ— ç”¨æˆ·æ•°æ®"})):o("",!0)]),V.value.length>0?(s(),d("div",Re," å·²é€‰æ‹© "+b(V.value.length)+" ä¸ªç”¨æˆ· ",1)):o("",!0),m("div",De,[r(B,{onClick:I},{default:n(()=>a[3]||(a[3]=[v("å–æ¶ˆ")])),_:1,__:[3]}),r(B,{type:"primary",onClick:O,disabled:0===V.value.length},{default:n(()=>a[4]||(a[4]=[v("ç¡®è®¤")])),_:1,__:[4]},8,["disabled"])])])}}},[["__scopeId","data-v-59a560f2"]]),Le={class:"permission-tab"},$e={class:"access-control-section"},Pe={class:"section-header"},Ke={key:0,class:"access-hint"},Me={key:1,class:"access-hint"},Ye={class:"permission-management"},Je={class:"permission-section"},Ge={class:"section-title"},Xe={class:"user-list"},We={key:2,class:"no-permission-hint"},Ze={class:"permission-section"},He={class:"section-title"},Qe={class:"user-list"},ea={key:0,class:"permission-section"},aa={class:"section-title"},la={class:"user-list"},ta={class:"action-footer"},ua=ne({__name:"PermissionTab",setup(l){const t=e(),_=F(),f=a(1),y=a(null),w=a([]),k=a([]),C=a(null),V=a(!1),x=a(!1),I=a(!1),B=a(""),j=a([]),A=a(0),T={owner:"æ‰€æœ‰è€…",admin:"ç®¡ç†å‘˜",member:"æˆå‘˜"},q=S(()=>_.userRole),E=S(()=>3===q.value),R=S(()=>2===q.value),D=S(()=>1===q.value),L=S(()=>E.value||R.value),$=S(()=>E.value||R.value),P=S(()=>E.value||R.value||D.value),Y=S(()=>E.value||R.value||D.value),J=S(()=>E.value||R.value||D.value),G=S(()=>[...y.value?.id?[y.value.id]:[],...w.value.map(e=>e.id),...k.value.map(e=>e.id)].map(e=>String(e))),X=S(()=>{if(!C.value)return!1;return JSON.stringify(W())!==C.value});function W(){const e=e=>[...e].sort((e,a)=>Number(e.id)-Number(a.id));return{access_mode:f.value,owner:y.value?{id:y.value.id,name:y.value.name}:null,admins:e(w.value),members:0===f.value?e(k.value):[]}}const Z=async()=>{if(y.value?.id)try{x.value=!0;const e=0===f.value?k.value:[];await M(t.params.id,{access_mode:f.value,user_roles:{owner:Number(y.value.id),admins:w.value.map(e=>Number(e.id)),members:e.map(e=>Number("object"==typeof e?e.id:e))}}),k.value=e,C.value=JSON.stringify(W()),re.success("æƒé™æ›´æ–°æˆåŠŸ")}catch(e){re.error("ä¿å­˜æƒé™å¤±è´¥: "+(e.response?.data?.message||e.message))}finally{x.value=!1}else re.warning("å¿…é¡»æŒ‡å®šæ‰€æœ‰è€…")},H=async e=>{if(1===e){if(!y.value)return re.warning("å…¬å¼€çŸ¥è¯†åº“å¿…é¡»æŒ‡å®šä¸€åæ‰€æœ‰è€…"),void(f.value=0);if(k.value.length){if(!(await oe.confirm("åˆ‡æ¢ä¸ºå…¬å¼€å°†æ¸…ç©ºè®¿é—®æˆå‘˜åˆ—è¡¨ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ","ç¡®è®¤",{type:"warning"}).catch(()=>!1)))return void(f.value=0)}k.value=[]}},Q=e=>{"owner"!==e||$.value?"admin"!==e||P.value?"member"!==e||Y.value?(B.value=e,j.value="admin"===e?[...w.value]:"member"===e?[...k.value]:[],A.value++,I.value=!0):re.warning("æ‚¨æ²¡æœ‰æƒé™ç®¡ç†æˆå‘˜"):re.warning("æ‚¨æ²¡æœ‰æƒé™ç®¡ç†ç®¡ç†å‘˜"):re.warning("æ‚¨æ²¡æœ‰æƒé™æ›´æ”¹æ‰€æœ‰è€…")},ee=e=>{const a=new Set(e.map(e=>Number(e.id))),l=e.map(e=>({id:Number(e.id),name:e.userName,avatar:e.avatar}));if("owner"===B.value){const e=l[0];e&&(y.value=e,w.value=w.value.filter(e=>e.id!==y.value.id),k.value=k.value.filter(e=>e.id!==y.value.id))}else"admin"===B.value?(w.value=l,k.value=k.value.filter(e=>!a.has(e.id))):"member"===B.value&&(k.value=l,w.value=w.value.filter(e=>!a.has(e.id)));I.value=!1},ae=async(e,a)=>{if("owner"!==e)if("admin"!==e||P.value)if("member"!==e||Y.value)try{await oe.confirm(`ç¡®å®šè¦ç§»é™¤è¯¥${T[e]}å—?`,"æç¤º",{type:"warning"}),"admin"===e?w.value=w.value.filter(e=>e.id!==a):"member"===e&&(k.value=k.value.filter(e=>e.id!==a))}catch{}else re.warning("æ‚¨æ²¡æœ‰æƒé™ç§»é™¤æˆå‘˜");else re.warning("æ‚¨æ²¡æœ‰æƒé™ç§»é™¤ç®¡ç†å‘˜");else re.warning("è¯·ä½¿ç”¨â€œæ›´æ¢æ‰€æœ‰è€…â€æ¥ä¿®æ”¹æ‰€æœ‰è€…")},le=()=>{j.value=[]};return h(()=>{(async()=>{try{V.value=!0;const e=await K(t.params.id),a=e.data||e;f.value=a.access_mode??0,y.value=a.owner?{id:Number(a.owner.id),name:a.owner.name,avatar:a.owner.avatar??0}:null,w.value=(a.admins??[]).map(e=>({id:Number(e.id),name:e.name,avatar:e.avatar??0})),k.value=(a.members??[]).map(e=>({id:Number(e.id),name:e.name,avatar:e.avatar??0})),C.value=JSON.stringify(W())}catch(e){re.error("è·å–æƒé™å¤±è´¥: "+(e.response?.data?.message||e.message)),y.value=null,w.value=[],k.value=[]}finally{V.value=!1}})()}),(e,a)=>{const l=u("el-radio"),t=u("el-radio-group"),_=u("el-alert"),h=u("el-icon"),C=u("el-tag"),V=u("el-button"),S=u("el-dialog");return s(),d("div",Le,[m("div",$e,[m("div",Pe,[a[8]||(a[8]=m("h3",null,"çŸ¥è¯†åº“è®¿é—®æƒé™",-1)),r(t,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onChange:H,disabled:!L.value},{default:n(()=>[r(l,{label:1},{default:n(()=>a[6]||(a[6]=[v("å…¬å¼€")])),_:1,__:[6]}),r(l,{label:0},{default:n(()=>a[7]||(a[7]=[v("ç§æœ‰")])),_:1,__:[7]})]),_:1},8,["modelValue","disabled"])]),0===f.value?(s(),d("div",Ke,[r(_,{type:"info",closable:!1},{default:n(()=>a[9]||(a[9]=[v(" ç§æœ‰çŸ¥è¯†åº“ä»…é™ä»¥ä¸‹æŒ‡å®šäººå‘˜è®¿é—® ")])),_:1,__:[9]})])):(s(),d("div",Me,[r(_,{type:"success",closable:!1},{default:n(()=>a[10]||(a[10]=[v(" å…¬å¼€çŸ¥è¯†åº“å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§ï¼Œä½†ç¼–è¾‘ä»éœ€æƒé™ ")])),_:1,__:[10]})]))]),m("div",Ye,[m("div",Je,[m("div",Ge,[r(h,null,{default:n(()=>[r(g(z))]),_:1}),a[11]||(a[11]=m("span",null,"æ‰€æœ‰è€…",-1))]),m("div",Xe,[y.value&&y.value.id?(s(),i(C,{key:y.value.id,type:"danger",closable:!1},{default:n(()=>[v(b(y.value.name),1)]),_:1})):o("",!0),$.value?(s(),i(V,{key:1,type:"primary",size:"small",onClick:a[1]||(a[1]=e=>Q("owner"))},{default:n(()=>[v(b(y.value&&y.value.id?"æ›´æ¢æ‰€æœ‰è€…":"+ æ·»åŠ æ‰€æœ‰è€…"),1)]),_:1})):(s(),d("div",We,[r(h,null,{default:n(()=>[r(g(U))]),_:1}),a[12]||(a[12]=m("span",null,"åªæœ‰æ‰€æœ‰è€…æˆ–è¶…çº§ç®¡ç†å‘˜å¯ä»¥æ›´æ”¹æ‰€æœ‰è€…",-1))]))]),a[13]||(a[13]=m("p",{class:"hint-text"},"æ‰€æœ‰è€…æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯ä¿®æ”¹çŸ¥è¯†åº“è®¾ç½®",-1))]),m("div",Ze,[m("div",He,[r(h,null,{default:n(()=>[r(g(N))]),_:1}),a[14]||(a[14]=m("span",null,"ç®¡ç†å‘˜",-1))]),m("div",Qe,[(s(!0),d(c,null,p(w.value,e=>(s(),i(C,{key:e.id,type:"warning",closable:P.value,onClose:a=>ae("admin",e.id)},{default:n(()=>[v(b(e.name),1)]),_:2},1032,["closable","onClose"]))),128)),P.value?(s(),i(V,{key:0,type:"primary",size:"small",onClick:a[2]||(a[2]=e=>Q("admin"))},{default:n(()=>a[15]||(a[15]=[v(" + æ·»åŠ ç®¡ç†å‘˜ ")])),_:1,__:[15]})):o("",!0)]),a[16]||(a[16]=m("p",{class:"hint-text"},"ç®¡ç†å‘˜å¯ç¼–è¾‘çŸ¥è¯†åº“å†…å®¹",-1))]),0===f.value?(s(),d("div",ea,[m("div",aa,[r(h,null,{default:n(()=>[r(g(O))]),_:1}),a[17]||(a[17]=m("span",null,"è®¿é—®æˆå‘˜",-1))]),m("div",la,[(s(!0),d(c,null,p(k.value,e=>(s(),i(C,{key:e.id,closable:Y.value,onClose:a=>ae("member",e.id)},{default:n(()=>[v(b(e.name),1)]),_:2},1032,["closable","onClose"]))),128)),Y.value?(s(),i(V,{key:0,type:"primary",size:"small",onClick:a[3]||(a[3]=e=>Q("member"))},{default:n(()=>a[18]||(a[18]=[v(" + æ·»åŠ æˆå‘˜ ")])),_:1,__:[18]})):o("",!0)]),a[19]||(a[19]=m("p",{class:"hint-text"},"ç§æœ‰çŸ¥è¯†åº“çš„æŒ‡å®šè®¿é—®äººå‘˜",-1))])):o("",!0)]),m("div",ta,[r(V,{type:"primary",loading:x.value,onClick:Z,disabled:!X.value||!J.value||!y.value?.id},{default:n(()=>a[20]||(a[20]=[v(" ä¿å­˜æ›´æ”¹ ")])),_:1,__:[20]},8,["loading","disabled"])]),r(S,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=e=>I.value=e),title:`æ·»åŠ ${T[B.value]}`,width:"600px",onClosed:le},{default:n(()=>[(s(),i(Fe,{key:A.value,"exclude-users":G.value,"initial-selected-users":j.value,onSelect:ee,onCancel:a[4]||(a[4]=e=>I.value=!1)},null,8,["exclude-users","initial-selected-users"]))]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-d5a32d8b"]]),ia={class:"log-tab"},sa={class:"filter-section"},na={class:"section"},ra={class:"pagination"},oa=ne({__name:"LogTab",setup(l){const t=e(),o=a([]),_=a(!1),f=a(0),y=a({operator:"",action:"",timeRange:[],page:1,pageSize:20}),V={create:"åˆ›å»º",update:"æ›´æ–°",delete:"åˆ é™¤",permission:"æƒé™å˜æ›´",upload:"ä¸Šä¼ "},S=e=>V[e]||"æœªçŸ¥æ“ä½œ",x=(e=!0)=>{const a={operator:y.value.operator,action:y.value.action,start_time:y.value.timeRange?.[0],end_time:y.value.timeRange?.[1]};return e&&(a.page=y.value.page,a.pageSize=y.value.pageSize),a},z=async()=>{try{_.value=!0;const e=x(!0),a=await Y(t.params.id,e);let l=[],u=0;Array.isArray(a)?(l=a,u=a.length):a?.data?.items?(l=a.data.items,u=a.data.total||a.data.items.length):a?.data?.data?(l=a.data.data,u=a.data.total||a.data.data.length):Array.isArray(a?.data)?(l=a.data,u=a.total||a.data.length):re.warning("è·å–æ—¥å¿—æ•°æ®æ ¼å¼å¼‚å¸¸"),o.value=l.map(e=>({timestamp:e.create_time||e.createTime||e.timestamp||"N/A",operator:e.operator_name||e.operator||e.operator_id||"æœªçŸ¥ç”¨æˆ·",action:e.action_type||e.action||"unknown",description:e.action_detail||e.description||"æ— æè¿°"})),f.value=u}catch(e){re.error("è·å–æ—¥å¿—å¤±è´¥: "+(e.message||"æœªçŸ¥é”™è¯¯"))}finally{_.value=!1}},U=()=>{y.value.page=1,z()},N=()=>{y.value={operator:"",action:"",timeRange:[],page:1,pageSize:20},z()},O=async(e=!1)=>{try{_.value=!0;let a=[];if(e){const e=x(!1),l=await Y(e);let t=[];Array.isArray(l)?t=l:l?.data?.items?t=l.data.items:l?.data?.data?t=l.data.data:Array.isArray(l?.data)&&(t=l.data),a=t.map(e=>({timestamp:e.create_time||e.createTime||e.timestamp||"N/A",operator:e.operator_name||e.operator||e.operator_id||"æœªçŸ¥ç”¨æˆ·",action:e.action_type||e.action||"unknown",description:e.action_detail||e.description||"æ— æè¿°"}))}else a=o.value;if(0===a.length)return void re.warning("å½“å‰æ— æ•°æ®å¯å¯¼å‡º");const l=a.map(e=>({"æ—¶é—´":e.timestamp,"æ“ä½œäºº":e.operator,"æ“ä½œç±»å‹":S(e.action),"æè¿°":e.description})),t=de.book_new(),u=de.json_to_sheet(l);u["!cols"]=[{wch:20},{wch:15},{wch:15},{wch:50}],de.book_append_sheet(t,u,"çŸ¥è¯†åº“æ“ä½œæ—¥å¿—");const i=`çŸ¥è¯†åº“æ“ä½œæ—¥å¿—_${e?"å…¨éƒ¨":"å½“å‰é¡µ"}_${(new Date).toISOString().split("T")[0]}.xlsx`;ce(t,i),re.success(`å¯¼å‡º${e?"å…¨éƒ¨":"å½“å‰é¡µ"}æˆåŠŸ`)}catch(a){re.error("å¯¼å‡ºå¤±è´¥: "+a.message)}finally{_.value=!1}};return h(()=>{z()}),(e,a)=>{const l=u("el-input"),t=u("el-form-item"),h=u("el-option"),x=u("el-select"),j=u("el-date-picker"),A=u("el-icon"),T=u("el-button"),q=u("el-form"),E=u("el-table-column"),R=u("el-tag"),D=u("el-table"),F=u("el-pagination"),L=w("loading");return s(),d("div",ia,[m("div",sa,[r(q,{model:y.value,inline:""},{default:n(()=>[r(t,{label:"æ“ä½œäºº"},{default:n(()=>[r(l,{modelValue:y.value.operator,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value.operator=e),placeholder:"è¯·è¾“å…¥æ“ä½œäºº",clearable:""},null,8,["modelValue"])]),_:1}),r(t,{label:"æ“ä½œç±»å‹"},{default:n(()=>[r(x,{modelValue:y.value.action,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value.action=e),placeholder:"è¯·é€‰æ‹©æ“ä½œç±»å‹",clearable:""},{default:n(()=>[(s(),d(c,null,p(V,(e,a)=>r(h,{key:a,label:e,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"æ—¶é—´èŒƒå›´"},{default:n(()=>[r(j,{modelValue:y.value.timeRange,"onUpdate:modelValue":a[2]||(a[2]=e=>y.value.timeRange=e),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),r(t,null,{default:n(()=>[r(T,{type:"primary",onClick:U,loading:_.value},{default:n(()=>[r(A,null,{default:n(()=>[r(g(C))]),_:1}),a[7]||(a[7]=v("æŸ¥è¯¢ "))]),_:1,__:[7]},8,["loading"]),r(T,{onClick:N},{default:n(()=>[r(A,null,{default:n(()=>[r(g(I))]),_:1}),a[8]||(a[8]=v("é‡ç½® "))]),_:1,__:[8]}),r(T,{type:"success",onClick:a[3]||(a[3]=e=>O(!1)),disabled:0===o.value.length},{default:n(()=>[r(A,null,{default:n(()=>[r(g(B))]),_:1}),a[9]||(a[9]=v("å¯¼å‡ºå½“å‰é¡µ "))]),_:1,__:[9]},8,["disabled"]),r(T,{type:"warning",onClick:a[4]||(a[4]=e=>O(!0))},{default:n(()=>[r(A,null,{default:n(()=>[r(g(B))]),_:1}),a[10]||(a[10]=v("å¯¼å‡ºå…¨éƒ¨ "))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),m("div",na,[a[11]||(a[11]=m("div",{class:"section-title"},"çŸ¥è¯†åº“ä¿®æ”¹è®°å½•",-1)),k((s(),i(D,{data:o.value,stripe:"",style:{width:"100%"}},{default:n(()=>[r(E,{prop:"timestamp",label:"æ—¶é—´",width:"180",sortable:""}),r(E,{prop:"operator",label:"æ“ä½œäºº",width:"120"}),r(E,{prop:"action",label:"æ“ä½œç±»å‹",width:"120"},{default:n(({row:e})=>{return[r(R,{type:(a=e.action,{create:"success",update:"primary",delete:"danger",permission:"warning",upload:"info"}[a]||"")},{default:n(()=>[v(b(S(e.action)),1)]),_:2},1032,["type"])];var a}),_:1}),r(E,{prop:"description",label:"æè¿°"})]),_:1},8,["data"])),[[L,_.value]]),m("div",ra,[r(F,{"current-page":y.value.page,"onUpdate:currentPage":a[5]||(a[5]=e=>y.value.page=e),"page-size":y.value.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>y.value.pageSize=e),total:f.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:z},null,8,["current-page","page-size","total"])])])])}}},[["__scopeId","data-v-74f6c29b"]]),da={class:"params-tab"},ca={class:"section"},pa={class:"section-title"},va={class:"init-params"},ma={class:"param-description-card"},ga={class:"card-header"},_a={class:"footer"},fa=ne({__name:"ParamsTab",props:{knowledgeBaseId:{type:String,required:!0}},setup(e){const l=e,t=a(!1),i=a({chunkSize:1e3,chunkOverlap:200,separator:"\n\n",embedding_model:"text2vec-base"}),o=async()=>{try{const e=await J(l.knowledgeBaseId);e&&(i.value={chunkSize:e.chunkSize??1e3,chunkOverlap:e.chunkOverlap??200,separator:e.separator??"\n\n",embedding_model:e.embedding_model??"text2vec-base"},re.success("å‚æ•°å·²é‡ç½®"))}catch(e){re.error("åŠ è½½å‚æ•°é…ç½®å¤±è´¥")}},c=async()=>{if(i.value.chunkOverlap>=i.value.chunkSize)re.warning("åˆ†å—é‡å å¤§å°ä¸èƒ½å¤§äºæˆ–ç­‰äºåˆ†å—å¤§å°");else{t.value=!0;try{await G(l.knowledgeBaseId,i.value),re.success("å‚æ•°é…ç½®ä¿å­˜æˆåŠŸ")}catch(e){re.error("ä¿å­˜å‚æ•°é…ç½®å¤±è´¥ï¼š"+(e.response?.data?.message||e.message))}finally{t.value=!1}}};return h(()=>{o()}),(e,a)=>{const l=u("el-icon"),p=u("el-input-number"),_=u("el-tooltip"),b=u("el-form-item"),y=u("el-input"),h=u("el-option"),w=u("el-select"),k=u("el-form"),C=u("el-button");return s(),d("div",da,[m("div",ca,[m("h3",pa,[r(l,null,{default:n(()=>[r(g(j))]),_:1}),a[4]||(a[4]=v(" åˆå§‹åŒ–ç­–ç•¥é»˜è®¤å€¼ "))]),m("div",va,[r(k,{"label-width":"120px"},{default:n(()=>[r(b,{label:"åˆ†å—å¤§å°:"},{default:n(()=>[r(p,{modelValue:i.value.chunkSize,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.chunkSize=e),min:100,max:5e3,placeholder:"è¯·è¾“å…¥åˆ†å—å¤§å°"},null,8,["modelValue"]),r(_,{placement:"top",effect:"light"},{content:n(()=>a[5]||(a[5]=[m("div",{class:"tooltip-content"},[m("strong",null,"åˆ†å—å¤§å°"),m("br"),v(" æ–‡æœ¬åˆ†å‰²æ—¶æ¯ä¸ªå—çš„æœ€å¤§å­—ç¬¦æ•°ã€‚"),m("br"),v(" â€¢ å€¼å¤ªå°ï¼šå¯èƒ½ä¸¢å¤±ä¸Šä¸‹æ–‡ä¿¡æ¯"),m("br"),v(" â€¢ å€¼å¤ªå¤§ï¼šå½±å“å¤„ç†æ•ˆç‡å’Œå‡†ç¡®æ€§"),m("br"),m("em",null,"æ¨èå€¼ï¼š500-1500")],-1)])),default:n(()=>[r(l,{class:"help-icon"},{default:n(()=>[r(g(f))]),_:1})]),_:1})]),_:1}),r(b,{label:"åˆ†å—é‡å :"},{default:n(()=>[r(p,{modelValue:i.value.chunkOverlap,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value.chunkOverlap=e),min:0,max:1e3,placeholder:"è¯·è¾“å…¥åˆ†å—é‡å å¤§å°"},null,8,["modelValue"]),r(_,{placement:"top",effect:"light"},{content:n(()=>a[6]||(a[6]=[m("div",{class:"tooltip-content"},[m("strong",null,"åˆ†å—é‡å "),m("br"),v(" ç›¸é‚»æ–‡æœ¬å—ä¹‹é—´çš„é‡å å­—ç¬¦æ•°ã€‚"),m("br"),v(" â€¢ ä½œç”¨ï¼šä¿æŒä¸Šä¸‹æ–‡çš„è¿è´¯æ€§"),m("br"),v(" â€¢ é€šå¸¸è®¾ç½®ä¸ºåˆ†å—å¤§å°çš„10%-20%"),m("br"),m("em",null,"æ¨èå€¼ï¼š50-300")],-1)])),default:n(()=>[r(l,{class:"help-icon"},{default:n(()=>[r(g(f))]),_:1})]),_:1})]),_:1}),r(b,{label:"åˆ†éš”ç¬¦:"},{default:n(()=>[r(y,{modelValue:i.value.separator,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value.separator=e),placeholder:"ä¾‹å¦‚ï¼š\\n\\n"},null,8,["modelValue"]),r(_,{placement:"top",effect:"light"},{content:n(()=>a[7]||(a[7]=[m("div",{class:"tooltip-content"},[m("strong",null,"åˆ†éš”ç¬¦"),m("br"),v(" ç”¨äºåˆ†å‰²æ–‡æœ¬çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚"),m("br"),v(" â€¢ \\n\\nï¼šåŒæ¢è¡Œï¼ˆæ®µè½åˆ†å‰²ï¼‰"),m("br"),v(" â€¢ \\nï¼šå•æ¢è¡Œ"),m("br"),v(" â€¢ ã€‚ï¼šå¥å·"),m("br"),v(" â€¢ è‡ªå®šä¹‰ï¼šæ ¹æ®æ–‡æ¡£ç»“æ„è®¾ç½®"),m("br"),m("em",null,"é»˜è®¤ï¼š\\n\\nï¼ˆæ®µè½åˆ†å‰²ï¼‰")],-1)])),default:n(()=>[r(l,{class:"help-icon"},{default:n(()=>[r(g(f))]),_:1})]),_:1})]),_:1}),r(b,{label:"åµŒå…¥æ¨¡å‹:"},{default:n(()=>[r(w,{modelValue:i.value.embedding_model,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value.embedding_model=e),placeholder:"é€‰æ‹©æ¨¡å‹",style:{width:"100%"}},{default:n(()=>[r(h,{label:"text2vec-base",value:"text2vec-base"}),r(h,{label:"text2vec-large",value:"text2vec-large"})]),_:1},8,["modelValue"]),r(_,{placement:"top",effect:"light"},{content:n(()=>a[8]||(a[8]=[m("div",{class:"tooltip-content"},[m("strong",null,"åµŒå…¥æ¨¡å‹"),m("br"),v(" å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºçš„æ¨¡å‹ã€‚"),m("br"),v(" â€¢ "),m("strong",null,"text2vec-base"),v("ï¼šåŸºç¡€ç‰ˆæœ¬ï¼Œé€Ÿåº¦å¿«"),m("br"),v(" â€¢ "),m("strong",null,"text2vec-large"),v("ï¼šå¢å¼ºç‰ˆæœ¬ï¼Œå‡†ç¡®åº¦é«˜"),m("br"),m("em",null,"æ ¹æ®éœ€æ±‚å¹³è¡¡é€Ÿåº¦ä¸ç²¾åº¦")],-1)])),default:n(()=>[r(l,{class:"help-icon"},{default:n(()=>[r(g(f))]),_:1})]),_:1})]),_:1})]),_:1}),m("div",ma,[m("div",ga,[r(l,null,{default:n(()=>[r(g(f))]),_:1}),a[9]||(a[9]=m("span",null,"å‚æ•°é…ç½®è¯´æ˜",-1))]),a[10]||(a[10]=A('<div class="card-content" data-v-67493b9e><div class="param-item-desc" data-v-67493b9e><span class="param-name" data-v-67493b9e>åˆ†å—ç­–ç•¥ï¼š</span><span class="param-desc" data-v-67493b9e>åˆç†çš„åˆ†å—è®¾ç½®èƒ½æ˜¾è‘—æå‡æ£€ç´¢å‡†ç¡®æ€§å’Œæ•ˆç‡</span></div><div class="param-item-desc" data-v-67493b9e><span class="param-name" data-v-67493b9e>æ¨¡å‹é€‰æ‹©ï¼š</span><span class="param-desc" data-v-67493b9e>æ ¹æ®æ•°æ®é‡å’Œç²¾åº¦è¦æ±‚é€‰æ‹©åˆé€‚çš„åµŒå…¥æ¨¡å‹</span></div></div>',1))])])]),m("div",_a,[r(C,{type:"primary",onClick:c,loading:t.value},{loading:n(()=>[r(l,{class:"is-loading"},{default:n(()=>[r(g(x))]),_:1}),a[11]||(a[11]=v(" ä¿å­˜ä¸­... "))]),default:n(()=>[a[12]||(a[12]=v(" ä¿å­˜é…ç½® "))]),_:1,__:[12]},8,["loading"]),r(C,{onClick:o},{default:n(()=>a[13]||(a[13]=[v("é‡ç½®")])),_:1,__:[13]})])])}}},[["__scopeId","data-v-67493b9e"]]),ba={class:"evaluate-tab"},ya={class:"left-panel"},ha={class:"header"},wa={class:"right-panel"},ka={class:"detail-header"},Ca={key:0},Va={key:0,class:"warning"},Sa={key:1,class:"empty"},xa={class:"footer"},za=ne({__name:"EvaluateTab",setup(l){const t=e(),p=a(""),_=a(null),f=a([]),y=a(!1),V=a(!1),x=a({name:"",description:"",file:null}),z=a(!1),U=a([]),N=a(!1),O=S(()=>f.value.filter(e=>e.name.includes(p.value.trim()))),I=async()=>{try{const e=await X({knowledge_base_id:parseInt(t.params.id),page:1,size:10});f.value=(e.datasets||[]).map(e=>({id:e.id,name:e.name,description:e.description,date:e.created_at,questionCount:e.total_questions,status:e.status}))}catch(e){re.error("åŠ è½½è¯„æµ‹é›†å¤±è´¥")}},B=async e=>{try{const a=await Q(e.id);_.value={...e,metrics:a.metrics||{}}}catch(a){re.error("è·å–è¯„æµ‹é›†è¯¦æƒ…å¤±è´¥")}},j=e=>{x.value.file=e.raw},A=async()=>{if(!x.value.name||!x.value.file)return re.warning("è¯·å¡«å†™åç§°å¹¶ä¸Šä¼ æ–‡ä»¶");try{const e=new FormData;e.append("name",x.value.name),e.append("knowledge_base_id",parseInt(t.params.id)),x.value.description&&e.append("description",x.value.description),e.append("file",x.value.file),await H(e),re.success("è¯„æµ‹é›†åˆ›å»ºæˆåŠŸ"),V.value=!1,x.value={name:"",description:"",file:null},await I()}catch(e){re.error("åˆ›å»ºå¤±è´¥")}},q=async()=>{if(_.value){y.value=!0;try{const e=await ee(_.value.id);_.value.metrics=e||{},re.success("è¯„æµ‹å®Œæˆ")}catch(e){re.error("è¯„æµ‹å¤±è´¥")}finally{y.value=!1}}},E=async()=>{if(_.value){z.value=!0,N.value=!0;try{const e=await ae(_.value.id);U.value=e.questions||[]}catch(e){re.error("åŠ è½½é—®ç­”å¤±è´¥")}finally{N.value=!1}}};return h(()=>I()),(e,a)=>{const l=u("el-icon"),t=u("el-input"),f=u("el-button"),h=u("el-table-column"),S=u("el-table"),R=u("el-descriptions-item"),D=u("el-descriptions"),F=u("el-form-item"),L=u("el-upload"),$=u("el-form"),P=u("el-dialog"),K=w("loading");return s(),d("div",ba,[m("div",ya,[m("div",ha,[r(t,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),placeholder:"æœç´¢è¯„æµ‹é›†",clearable:"",size:"small"},{prefix:n(()=>[r(l,null,{default:n(()=>[r(g(C))]),_:1})]),_:1},8,["modelValue"]),r(f,{type:"primary",size:"small",icon:"Plus",onClick:a[1]||(a[1]=e=>V.value=!0)},{default:n(()=>a[7]||(a[7]=[v(" æ·»åŠ è¯„æµ‹é›† ")])),_:1,__:[7]})]),r(S,{data:O.value,border:"","highlight-current-row":"",onRowClick:B,class:"eval-table"},{default:n(()=>[r(h,{prop:"name",label:"è¯„æµ‹é›†åç§°"}),r(h,{prop:"date",label:"æ—¥æœŸ",width:"120"}),r(h,{prop:"questionCount",label:"é—®é¢˜æ•°",width:"100",align:"center"}),r(h,{label:"æ“ä½œ",width:"100",align:"center"},{default:n(e=>[r(f,{type:"danger",size:"small",text:"",onClick:T(a=>(async e=>{try{await oe.confirm(`ç¡®å®šè¦åˆ é™¤è¯„æµ‹é›†ã€Œ${e.name}ã€å—ï¼Ÿ`,"æç¤º",{type:"warning"}),await W(e.id),re.success("åˆ é™¤æˆåŠŸ"),_.value?.id===e.id&&(_.value=null),await I()}catch(a){"cancel"!==a&&re.error("åˆ é™¤å¤±è´¥")}})(e.row),["stop"])},{default:n(()=>a[8]||(a[8]=[v(" åˆ é™¤ ")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),m("div",wa,[z.value&&_.value?(s(),d(c,{key:0},[m("div",ka,[r(f,{link:"",onClick:a[2]||(a[2]=e=>z.value=!1)},{default:n(()=>a[9]||(a[9]=[v("â¬… è¿”å›")])),_:1,__:[9]}),m("h3",null,b(_.value.name)+" - è¯¦æƒ…",1)]),r(D,{column:2,border:"",class:"mb-4"},{default:n(()=>[r(R,{label:"åç§°"},{default:n(()=>[v(b(_.value.name),1)]),_:1}),r(R,{label:"åˆ›å»ºæ—¶é—´"},{default:n(()=>[v(b(_.value.date),1)]),_:1}),r(R,{label:"é—®é¢˜æ•°"},{default:n(()=>[v(b(_.value.questionCount),1)]),_:1}),r(R,{label:"çŠ¶æ€"},{default:n(()=>[v(b(_.value.status),1)]),_:1})]),_:1}),a[11]||(a[11]=m("h4",{class:"section-title"},"æœŸæœ›é—®ç­”",-1)),k((s(),i(S,{data:U.value,border:"",style:{width:"100%"}},{default:n(()=>[r(h,{prop:"question",label:"é—®é¢˜","min-width":"180"}),r(h,{prop:"expected_answer",label:"æœŸæœ›å›ç­”","min-width":"180"}),r(h,{label:"æ“ä½œ",width:"100",align:"center"},{default:n(e=>[r(f,{type:"danger",size:"small",text:"",onClick:a=>(async e=>{try{await oe.confirm("ç¡®å®šè¦åˆ é™¤è¯¥é—®ç­”å—ï¼Ÿ","æç¤º",{type:"warning"}),await Z(_.value.id,e.id),re.success("åˆ é™¤æˆåŠŸ"),U.value=U.value.filter(a=>a.id!==e.id)}catch(a){"cancel"!==a&&re.error("åˆ é™¤å¤±è´¥")}})(e.row)},{default:n(()=>a[10]||(a[10]=[v(" åˆ é™¤ ")])),_:2,__:[10]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,N.value]])],64)):(s(),d(c,{key:1},[a[14]||(a[14]=m("h3",{class:"section-title"},"è¯„ä¼°ç»“æœ",-1)),_.value?(s(),d("div",Ca,[m("p",null,"å½“å‰è¯„æµ‹é›†ï¼š"+b(_.value.name),1),r(D,{column:1,border:""},{default:n(()=>[r(R,{label:"è¯„æµ‹æ—¥æœŸ"},{default:n(()=>[v(b(_.value.metrics?.evaluation_date||"æš‚æ— "),1)]),_:1}),r(R,{label:"é—®é¢˜æ•°"},{default:n(()=>[v(b(_.value.metrics?.total_questions??_.value.questionCount??0),1)]),_:1}),r(R,{label:"å‡†ç¡®ç‡"},{default:n(()=>[v(b(_.value.metrics?.accuracy??0)+"% ",1)]),_:1}),r(R,{label:"å¬å›ç‡"},{default:n(()=>[v(b(_.value.metrics?.recall??0)+"% ",1)]),_:1}),r(R,{label:"å“åº”æ—¶é—´"},{default:n(()=>[v(b(_.value.metrics?.response_time??0)+" ms ",1)]),_:1}),r(R,{label:"åˆç†æ€§å¾—åˆ†"},{default:n(()=>[v(b(_.value.metrics?.reasonableness??0)+"% ",1)]),_:1}),r(R,{label:"è¦†ç›–ç‡"},{default:n(()=>[v(b(_.value.metrics?.coverage??0)+"% ",1)]),_:1}),r(R,{label:"æˆåŠŸç‡"},{default:n(()=>[v(b(_.value.metrics?.success_rate??0)+"% ",1)]),_:1}),r(R,{label:"æ€»ä½“å¾—åˆ†"},{default:n(()=>[v(b(_.value.metrics?.overall_score??0),1)]),_:1})]),_:1}),(_.value.metrics?.coverage??0)<90?(s(),d("div",Va," âš ï¸ è¦†ç›–ç‡ä½äº 90%ï¼Œè¯·æ£€æŸ¥æœªè¦†ç›–çš„é—®é¢˜ ")):o("",!0)])):(s(),d("div",Sa," è¯·é€‰æ‹©å·¦ä¾§çš„è¯„æµ‹é›†ä»¥æŸ¥çœ‹è¯„ä¼°ç»“æœ ")),m("div",xa,[r(f,{type:"primary",loading:y.value,onClick:q},{default:n(()=>a[12]||(a[12]=[v(" è¿è¡Œè¯„ä¼° ")])),_:1,__:[12]},8,["loading"]),_.value?(s(),i(f,{key:0,type:"success",onClick:E},{default:n(()=>a[13]||(a[13]=[v(" æŸ¥çœ‹è¯¦æƒ… ")])),_:1,__:[13]})):o("",!0)])],64))]),r(P,{title:"æ·»åŠ è¯„æµ‹é›†",modelValue:V.value,"onUpdate:modelValue":a[6]||(a[6]=e=>V.value=e),width:"500px"},{footer:n(()=>[r(f,{onClick:a[5]||(a[5]=e=>V.value=!1)},{default:n(()=>a[16]||(a[16]=[v("å–æ¶ˆ")])),_:1,__:[16]}),r(f,{type:"primary",onClick:A},{default:n(()=>a[17]||(a[17]=[v("ç¡®å®š")])),_:1,__:[17]})]),default:n(()=>[r($,{model:x.value,"label-width":"100px"},{default:n(()=>[r(F,{label:"åç§°",required:""},{default:n(()=>[r(t,{modelValue:x.value.name,"onUpdate:modelValue":a[3]||(a[3]=e=>x.value.name=e),placeholder:"è¯·è¾“å…¥åç§°"},null,8,["modelValue"])]),_:1}),r(F,{label:"æè¿°"},{default:n(()=>[r(t,{modelValue:x.value.description,"onUpdate:modelValue":a[4]||(a[4]=e=>x.value.description=e),placeholder:"è¯·è¾“å…¥æè¿°"},null,8,["modelValue"])]),_:1}),r(F,{label:"ä¸Šä¼ æ–‡ä»¶",required:""},{default:n(()=>[r(L,{drag:"","auto-upload":!1,limit:1,accept:".json","on-change":j},{default:n(()=>a[15]||(a[15]=[m("i",{class:"el-icon-upload"},null,-1),m("div",{class:"el-upload__text"},[v(" å°†æ–‡ä»¶æ‹–åˆ°æ­¤å¤„ï¼Œæˆ– "),m("em",null,"ç‚¹å‡»ä¸Šä¼ ")],-1)])),_:1,__:[15]})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-b211a0db"]]),Ua={class:"optimize-tab"},Na={class:"filter-bar"},Oa={class:"action-bar",style:{margin:"15px 0"}},Ia={style:{"margin-top":"20px","text-align":"right"}},Ba=ne({__name:"OptimizeTab",setup(l){const t=a(!1),o=a([]),c=a([]),p=e().params.id,g=a({target:"all",status:"all",keyword:""}),_=a({page:1,pageSize:10,total:0}),f=async()=>{t.value=!0;try{const e={target:"all"===g.value.target?void 0:g.value.target,status:"all"===g.value.status?void 0:g.value.status,keyword:g.value.keyword||void 0,page:_.value.page,pageSize:_.value.pageSize},a=await le(p,e);o.value=a.list||[],_.value.total=a.total||0}catch(e){re.error("è·å–è°ƒä¼˜å»ºè®®å¤±è´¥")}finally{t.value=!1}},b=()=>{g.value={target:"all",status:"all",keyword:""},_.value.page=1,f()},y=e=>{c.value=e},h=async()=>{const e=c.value.map(e=>e.id);if(!e.length)return re.warning("è¯·é€‰æ‹©æ•°æ®");try{await ie(p,e),c.value.forEach(e=>e.status="applied"),re.success("æ‰¹é‡åº”ç”¨æˆåŠŸ")}catch{re.error("æ“ä½œå¤±è´¥")}},C=async()=>{const e=c.value.map(e=>e.id);if(!e.length)return re.warning("è¯·é€‰æ‹©æ•°æ®");try{await se(p,e),c.value.forEach(e=>e.status="ignored"),re.success("æ‰¹é‡å¿½ç•¥æˆåŠŸ")}catch{re.error("æ“ä½œå¤±è´¥")}};return f(),(e,a)=>{const l=u("el-option"),c=u("el-select"),V=u("el-input"),S=u("el-button"),x=u("el-table-column"),z=u("el-tag"),U=u("el-table"),N=u("el-pagination"),O=w("loading");return s(),d("div",Ua,[m("div",Na,[r(c,{modelValue:g.value.target,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value.target=e),placeholder:"è°ƒä¼˜å¯¹è±¡",clearable:"",style:{width:"160px","margin-right":"10px"}},{default:n(()=>[r(l,{label:"å…¨éƒ¨",value:"all"}),r(l,{label:"åˆå§‹åŒ–ç­–ç•¥",value:"init"}),r(l,{label:"æ£€ç´¢ç­–ç•¥",value:"retrieval"})]),_:1},8,["modelValue"]),r(c,{modelValue:g.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value.status=e),placeholder:"çŠ¶æ€",clearable:"",style:{width:"140px","margin-right":"10px"}},{default:n(()=>[r(l,{label:"å…¨éƒ¨",value:"all"}),r(l,{label:"æœªå¤„ç†",value:"pending"}),r(l,{label:"å·²åº”ç”¨",value:"applied"}),r(l,{label:"å·²å¿½ç•¥",value:"ignored"})]),_:1},8,["modelValue"]),r(V,{modelValue:g.value.keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value.keyword=e),placeholder:"è¯·è¾“å…¥å…³é”®è¯æˆ–é—®é¢˜å†…å®¹",clearable:"",style:{width:"260px","margin-right":"10px"}},null,8,["modelValue"]),r(S,{type:"primary",onClick:f},{default:n(()=>a[5]||(a[5]=[v("æŸ¥è¯¢")])),_:1,__:[5]}),r(S,{onClick:b},{default:n(()=>a[6]||(a[6]=[v("é‡ç½®")])),_:1,__:[6]})]),m("div",Oa,[r(S,{type:"success",onClick:f},{default:n(()=>a[7]||(a[7]=[v("åˆ·æ–°å»ºè®®")])),_:1,__:[7]}),r(S,{type:"primary",onClick:h},{default:n(()=>a[8]||(a[8]=[v("æ‰¹é‡åº”ç”¨")])),_:1,__:[8]}),r(S,{type:"danger",onClick:C},{default:n(()=>a[9]||(a[9]=[v("æ‰¹é‡å¿½ç•¥")])),_:1,__:[9]})]),k((s(),i(U,{data:o.value,border:"",style:{width:"100%"},onSelectionChange:y},{default:n(()=>[r(x,{type:"selection",width:"55"}),r(x,{prop:"target",label:"è°ƒä¼˜å¯¹è±¡",width:"120"}),r(x,{prop:"type",label:"ç­–ç•¥ç±»å‹",width:"160"}),r(x,{prop:"analysis",label:"åˆ†æä¾æ®"}),r(x,{prop:"suggestion",label:"ç³»ç»Ÿå»ºè®®"}),r(x,{prop:"time",label:"å»ºè®®æ—¶é—´",width:"160"}),r(x,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:n(({row:e})=>["pending"===e.status?(s(),i(z,{key:0,type:"warning"},{default:n(()=>a[10]||(a[10]=[v("æœªå¤„ç†")])),_:1,__:[10]})):"applied"===e.status?(s(),i(z,{key:1,type:"success"},{default:n(()=>a[11]||(a[11]=[v("å·²åº”ç”¨")])),_:1,__:[11]})):(s(),i(z,{key:2,type:"info"},{default:n(()=>a[12]||(a[12]=[v("å·²å¿½ç•¥")])),_:1,__:[12]}))]),_:1}),r(x,{label:"æ“ä½œ",width:"180"},{default:n(({row:e})=>[r(S,{size:"small",type:"primary",onClick:a=>(async e=>{try{await te(p,e.id),e.status="applied",re.success("å·²åº”ç”¨")}catch{re.error("æ“ä½œå¤±è´¥")}})(e)},{default:n(()=>a[13]||(a[13]=[v("åº”ç”¨")])),_:2,__:[13]},1032,["onClick"]),r(S,{size:"small",type:"danger",onClick:a=>(async e=>{try{await ue(p,e.id),e.status="ignored",re.success("å·²å¿½ç•¥")}catch{re.error("æ“ä½œå¤±è´¥")}})(e)},{default:n(()=>a[14]||(a[14]=[v("å¿½ç•¥")])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,t.value]]),m("div",Ia,[r(N,{"current-page":_.value.page,"onUpdate:currentPage":a[3]||(a[3]=e=>_.value.page=e),"page-size":_.value.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>_.value.pageSize=e),total:_.value.total,background:"",layout:"prev, pager, next, jumper",onCurrentChange:f},null,8,["current-page","page-size","total"])])])}}},[["__scopeId","data-v-243bb5ce"]]),ja={class:"knowledge-base-page"},Aa={class:"header-bar"},Ta={class:"kb_name"},qa=ne({__name:"KnowledgeBase",setup(t){const o=a("data-source"),v=q(),_=e(),f=F(),y=S(()=>f.currentKB?.name||"æœªçŸ¥çŸ¥è¯†åº“");function w(){v.push("/knowledgelist")}const k=S(()=>{const e=f.userRole;return 1===e||2===e||3===e}),C=S(()=>{const e=[{label:"æ•°æ®æº",name:"data-source"}];return k.value&&e.push({label:"æƒé™",name:"permission"},{label:"å‚æ•°",name:"param"},{label:"è¯„æµ‹",name:"evaluate"},{label:"è°ƒä¼˜",name:"optimize"},{label:"æ—¥å¿—",name:"log"}),e}),V={"data-source":Ne,permission:ua,param:fa,evaluate:za,optimize:Ba,log:oa};return l(o,e=>{C.value.some(a=>a.name===e)||(o.value="data-source",re.warning("æ‚¨æ²¡æœ‰æƒé™è®¿é—®è¯¥é¡µé¢"))},{immediate:!0}),h(()=>{const e=_.params.id;if(e&&!f.currentKB){const a=f.getKBById(e);a?f.setCurrentKB(a):re.warning("æœªæ‰¾åˆ°å¯¹åº”çš„çŸ¥è¯†åº“ä¿¡æ¯")}const a=_.query.tab;a&&C.value.some(e=>e.name===a)&&(o.value=a)}),(e,a)=>{const l=u("el-icon"),t=u("el-tab-pane"),v=u("el-tabs");return s(),d("div",ja,[m("div",Aa,[m("div",{class:"back",onClick:w},[r(l,null,{default:n(()=>[r(g(E))]),_:1}),a[1]||(a[1]=m("span",{class:"back-text"},"çŸ¥è¯†åº“æ€»é¡µ",-1))]),r(v,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),class:"custom-tabs",stretch:"","tab-position":"top"},{default:n(()=>[(s(!0),d(c,null,p(C.value,e=>(s(),i(t,{key:e.name,label:e.label,name:e.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),m("div",Ta," ğŸŸ¢ å½“å‰çŸ¥è¯†åº“ï¼š"+b(y.value),1),(s(),i(R(V[o.value]),{"knowledge-base-id":g(_).params.id},null,8,["knowledge-base-id"]))])}}},[["__scopeId","data-v-ee3b7145"]]);export{qa as default};
