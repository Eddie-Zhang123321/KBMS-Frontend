import{_ as e}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{aL as l}from"./vendor-zcc-V1Og.js";import{r as a,a as t,b1 as s,U as o,J as n,V as i,a1 as d,K as r,Z as u,$ as m,I as b,a0 as p,av as k,bh as c,W as y,bS as _,d as v,X as f,F as g}from"./vue-vendor-BUDnSszI.js";const w={class:"dialog-footer"},h=e({__name:"CreateRole",emits:["success"],setup(e,{expose:m,emit:b}){const p=a(!1),k=a(!1),c=t({name:"",description:"",type:""}),y={name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:2,max:32,message:"长度在 2 到 32 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"},{min:2,max:200,message:"长度在 2 到 200 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择角色类型",trigger:"change"}]},_=a(null),v=()=>{_.value?.resetFields(),p.value=!1},f=async()=>{try{k.value=!0,await _.value.validate();const e={id:`r-${Date.now()}`,key:c.name.toLowerCase().replace(/\s+/g,"_"),name:c.name,description:c.description,type:c.type,typeLabel:{platform:"平台级",kb:"知识库级",normal:"普通级"}[c.type],userCount:0,createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0],permissions:[]},a=localStorage.getItem("roleManagementStore");if(a){const l=JSON.parse(a);l.allRoles.push(e),localStorage.setItem("roleManagementStore",JSON.stringify(l))}l.success("新建角色成功"),v(),g("success")}catch(e){e&&l.error(e.message||"创建失败")}finally{k.value=!1}},g=b;return m({open:()=>{p.value=!0}}),(e,l)=>{const a=s("el-input"),t=s("el-form-item"),m=s("el-option"),b=s("el-select"),g=s("el-form"),h=s("el-button"),I=s("el-dialog");return n(),o(I,{modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=e=>p.value=e),title:"新建角色",width:"520px","before-close":v},{footer:i(()=>[r("span",w,[d(h,{onClick:v},{default:i(()=>l[4]||(l[4]=[u("取消")])),_:1,__:[4]}),d(h,{type:"primary",onClick:f,loading:k.value},{default:i(()=>l[5]||(l[5]=[u("确定")])),_:1,__:[5]},8,["loading"])])]),default:i(()=>[d(g,{ref_key:"formRef",ref:_,model:c,rules:y,"label-width":"96px","label-position":"right"},{default:i(()=>[d(t,{label:"角色名",prop:"name"},{default:i(()=>[d(a,{modelValue:c.name,"onUpdate:modelValue":l[0]||(l[0]=e=>c.name=e),placeholder:"请输入角色名",clearable:""},null,8,["modelValue"])]),_:1}),d(t,{label:"描述",prop:"description"},{default:i(()=>[d(a,{modelValue:c.description,"onUpdate:modelValue":l[1]||(l[1]=e=>c.description=e),placeholder:"请输入描述",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),d(t,{label:"角色类型",prop:"type"},{default:i(()=>[d(b,{modelValue:c.type,"onUpdate:modelValue":l[2]||(l[2]=e=>c.type=e),placeholder:"请选择角色类型",style:{width:"100%"}},{default:i(()=>[d(m,{label:"平台级",value:"platform"}),d(m,{label:"知识库级",value:"kb"}),d(m,{label:"普通级",value:"normal"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-32b2d81d"]]),I={class:"dialog-footer"},N=e({__name:"RoleInfo",setup(e,{expose:l}){const t=a(!1),c=a(null),y=()=>{t.value=!1};return l({open:e=>{c.value=e,t.value=!0}}),(e,l)=>{const a=s("el-descriptions-item"),_=s("el-tag"),v=s("el-descriptions"),f=s("el-button"),g=s("el-dialog");return n(),o(g,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),title:`角色信息 - ${c.value?.name||""}`,width:"660px","before-close":y},{footer:i(()=>[r("span",I,[d(f,{onClick:y},{default:i(()=>l[1]||(l[1]=[u("关闭")])),_:1,__:[1]})])]),default:i(()=>[d(v,{column:1,border:""},{default:i(()=>[d(a,{label:"角色名"},{default:i(()=>[u(m(c.value?.name),1)]),_:1}),d(a,{label:"描述"},{default:i(()=>[u(m(c.value?.description),1)]),_:1}),d(a,{label:"角色类型"},{default:i(()=>[u(m(c.value?.typeLabel),1)]),_:1}),d(a,{label:"用户数"},{default:i(()=>[u(m(c.value?.userCount),1)]),_:1}),d(a,{label:"创建时间"},{default:i(()=>[u(m(c.value?.createdAt),1)]),_:1}),d(a,{label:"最后更新时间"},{default:i(()=>[u(m(c.value?.updatedAt),1)]),_:1}),d(a,{label:"权限列表"},{default:i(()=>[(n(!0),b(p,null,k(c.value?.permissions,(e,l)=>(n(),o(_,{key:l,type:"info",style:{"margin-right":"8px","margin-bottom":"8px"}},{default:i(()=>[u(m(e),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-6b6f6166"]]),V={class:"dialog-footer"},S=e({__name:"RolePermissions",emits:["success"],setup(e,{expose:t,emit:m}){const b=a(!1),p=a(null),k=a(!1),_=a(!1),v={"超级管理员":{type:"tenant",checkedKeys:["sys.users","sys.roles","sys.logs","sys.settings","kbsys.users","kbsys.roles","kbsys.logs","kbsys.settings","kb.view","kb.edit","kb.create","kb.delete","user.view","user.create","user.edit","user.delete"]},"知识库所有人":{type:"kb",checkedKeys:["kb.view","kb.create","kb.edit","kb.delete","kbsys.users","kbsys.roles","kbsys.logs","kbsys.settings"]},"知识库管理员":{type:"kb",checkedKeys:["kb.view","kb.edit","kbsys.users","kbsys.logs","kbsys.settings"]}},f={platform:[{id:"sys",label:"平台级系统管理",children:[{id:"sys.users",label:"租户管理"},{id:"sys.roles",label:"角色管理"},{id:"sys.logs",label:"系统日志"},{id:"sys.settings",label:"系统设置"}]}],tenant:[{id:"sys",label:"租户级系统管理",children:[{id:"sys.users",label:"用户管理"},{id:"sys.roles",label:"角色管理"},{id:"sys.logs",label:"系统日志"},{id:"sys.settings",label:"系统设置"}]},{id:"kbsys",label:"知识库级系统管理",children:[{id:"kbsys.users",label:"知识库级人员管理"},{id:"kbsys.roles",label:"知识库级角色管理"},{id:"kbsys.logs",label:"系统日志"},{id:"kbsys.settings",label:"系统设置"}]},{id:"kb",label:"知识库管理",children:[{id:"kb.view",label:"查看知识库"},{id:"kb.edit",label:"编辑知识库"},{id:"kb.create",label:"创建知识库"},{id:"kb.delete",label:"删除知识库"}]},{id:"user_management",label:"用户管理",children:[{id:"user.view",label:"查看用户"},{id:"user.create",label:"创建用户"},{id:"user.edit",label:"编辑用户"},{id:"user.delete",label:"删除用户"}]}],kb:[{id:"kbsys",label:"知识库级系统管理",children:[{id:"kbsys.users",label:"知识库级人员管理"},{id:"kbsys.roles",label:"知识库级角色管理"},{id:"kbsys.logs",label:"系统日志"},{id:"kbsys.settings",label:"系统设置"}]},{id:"kb",label:"知识库管理",children:[{id:"kb.view",label:"查看知识库"},{id:"kb.edit",label:"编辑知识库"},{id:"kb.create",label:"创建知识库"},{id:"kb.delete",label:"删除知识库"}]}],normal:[{id:"kb",label:"知识库",children:[{id:"kb.view",label:"查看"}]}]},g=a([]),w=a([]),h=()=>{b.value=!1,p.value=null,g.value=[],w.value=[]},I=(e,l)=>{},N=()=>{try{_.value=!0,l.success("保存成功"),h(),S("success")}catch(e){l.error("保存失败")}finally{_.value=!1}},S=m;return t({open:e=>{p.value=e,b.value=!0;const l=v[e.name];if(l)return g.value=f[l.type],void(w.value=l.checkedKeys);switch(e.type){case"platform":g.value=f.platform,w.value=["sys.users","sys.roles","sys.logs","sys.settings"];break;case"tenant":g.value=f.tenant,w.value=["sys.users","sys.roles","sys.logs","sys.settings","kbsys.users","kbsys.roles","kbsys.logs","kbsys.settings","kb.view","kb.edit","kb.create","kb.delete","user.view","user.create","user.edit","user.delete"];break;case"kb":g.value=f.kb,w.value=["kb.view","kb.edit","kbsys.users","kbsys.logs","kbsys.settings"];break;default:g.value=f.normal,w.value=["kb.view"]}}}),(e,l)=>{const a=s("el-tree"),t=s("el-button"),m=s("el-dialog"),v=c("loading");return n(),o(m,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=e=>b.value=e),title:`角色权限 - ${p.value?.name||""}`,width:"720px","before-close":h},{footer:i(()=>[r("span",V,[d(t,{onClick:h},{default:i(()=>l[1]||(l[1]=[u("取消")])),_:1,__:[1]}),d(t,{type:"primary",onClick:N,loading:_.value},{default:i(()=>l[2]||(l[2]=[u("保存")])),_:1,__:[2]},8,["loading"])])]),default:i(()=>[y(d(a,{data:g.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":w.value,onCheckChange:I},null,8,["data","default-checked-keys"]),[[v,k.value]])]),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-50aa5c91"]]),C={class:"toolbar"},x=e({__name:"RoleAssignees",setup(e,{expose:l}){_();const t=a(!1),u=a(null),m=a(""),b=a(""),p={platform_admin:[{id:"u1",label:"曾国藩",email:"admin1@company.com",type:["platform_admin"]},{id:"u2",label:"松木有",email:"admin2@company.com",type:["platform_admin"]}],super_admin:[{id:"u3",label:"奥斯你",email:"super_admin1@company.com",type:["super_admin"],tenantName:"科技创新租户"},{id:"u4",label:"现金券",email:"super_admin2@company.com",type:["super_admin"],tenantName:"教育发展租户"},{id:"u5",label:"三九七",email:"super_admin3@company.com",type:["super_admin"],tenantName:"医疗服务租户"},{id:"u6",label:"十块钱",email:"super_admin4@company.com",type:["super_admin"],tenantName:"金融科技租户"},{id:"u7",label:"适配器",email:"super_admin5@company.com",type:["super_admin"],tenantName:"智能制造租户"}],kb_owner:[{id:"u5",label:"周年庆",email:"kb_owner1@company.com",type:["kb_owner"],kbId:"kb1",kbName:"企业管理知识库"},{id:"u6",label:"准确吗",email:"kb_owner2@company.com",type:["kb_owner"],kbId:"kb2",kbName:"技术研发知识库"},{id:"u7",label:"打折吧",email:"kb_owner3@company.com",type:["kb_owner"],kbId:"kb3",kbName:"技术研发知识库"},{id:"u8",label:"跨学科",email:"kb_owner4@company.com",type:["kb_owner"],kbId:"kb4",kbName:"技术研发知识库"},{id:"u9",label:"辛苦钱",email:"kb_owner5@company.com",type:["kb_owner"],kbId:"kb5",kbName:"技术研发知识库"},{id:"u10",label:"数据源",email:"kb_owner6@company.com",type:["kb_owner"],kbId:"kb6",kbName:"技术研发知识库"},{id:"u11",label:"空间转换",email:"kb_owner7@company.com",type:["kb_owner"],kbId:"kb7",kbName:"技术研发知识库"},{id:"u12",label:"展开是",email:"kb_owner8@company.com",type:["kb_owner"],kbId:"kb8",kbName:"技术研发知识库"}],kb_admin:[{id:"u7",label:"李桂芬",email:"kb_admin1@company.com",type:["kb_admin"],kbId:"kb1",kbName:"企业管理知识库"},{id:"u8",label:"王博雅",email:"kb_admin2@company.com",type:["kb_admin"],kbId:"kb2",kbName:"技术研发知识库"},{id:"u9",label:"赵思远",email:"kb_admin3@company.com",type:["kb_admin"],kbId:"kb3",kbName:"技术研发知识库"},{id:"u10",label:"自己去",email:"kb_admin1@company.com",type:["kb_admin"],kbId:"kb1",kbName:"企业管理知识库"},{id:"u11",label:"发现新",email:"kb_admin2@company.com",type:["kb_admin"],kbId:"kb2",kbName:"技术研发知识库"},{id:"u12",label:"小时内",email:"kb_admin3@company.com",type:["kb_admin"],kbId:"kb3",kbName:"技术研发知识库"},{id:"u13",label:"顺便说",email:"kb_admin1@company.com",type:["kb_admin"],kbId:"kb1",kbName:"企业管理知识库"},{id:"u14",label:"王是雅",email:"kb_admin2@company.com",type:["kb_admin"],kbId:"kb2",kbName:"技术研发知识库"},{id:"u15",label:"赵辛苦",email:"kb_admin3@company.com",type:["kb_admin"],kbId:"kb3",kbName:"技术研发知识库"},{id:"u16",label:"李社区",email:"kb_admin1@company.com",type:["kb_admin"],kbId:"kb1",kbName:"企业管理知识库"},{id:"u17",label:"王是我",email:"kb_admin2@company.com",type:["kb_admin"],kbId:"kb2",kbName:"技术研发知识库"},{id:"u18",label:"赵思是",email:"kb_admin3@company.com",type:["kb_admin"],kbId:"kb3",kbName:"技术研发知识库"},{id:"u19",label:"李桂呢",email:"kb_admin1@company.com",type:["kb_admin"],kbId:"kb1",kbName:"企业管理知识库"}]},k=v(()=>{const e=u.value?.key;return p[e]||[]}),c=v(()=>{let e=k.value;return m.value&&(e=e.filter(e=>e.label.includes(m.value))),["kb_owner","kb_admin"].includes(u.value?.key)&&b.value&&(e=e.filter(e=>e.kbName&&e.kbName.includes(b.value))),e}),y=()=>{t.value=!1,u.value=null,m.value="",b.value=""};return l({open:e=>{u.value=e,t.value=!0,m.value="",b.value=""},canOpenAssignees:(e,l)=>"platform_admin"===l?["platform_admin","super_admin"].includes(e.key):"super_admin"===l?"super_admin"!==e.key:"user"!==e.key||"redirect_to_user_management"}),(e,l)=>{const a=s("el-input"),p=s("el-table-column"),k=s("el-table"),_=s("el-dialog");return n(),o(_,{modelValue:t.value,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value=e),title:`授权人 - ${u.value?.name||""}`,width:"1000px","before-close":y},{default:i(()=>[r("div",C,[d(a,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),placeholder:"搜索用户名",clearable:"",style:{width:"260px"}},null,8,["modelValue"]),["kb_owner","kb_admin"].includes(u.value?.key)?(n(),o(a,{key:0,modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),placeholder:"搜索知识库名称",clearable:"",style:{width:"260px","margin-left":"10px"}},null,8,["modelValue"])):f("",!0)]),d(k,{data:c.value,style:{width:"100%"},stripe:""},{default:i(()=>[d(p,{prop:"label",label:"用户名",width:"150"}),d(p,{prop:"email",label:"邮箱",width:"200"}),"super_admin"===u.value?.key?(n(),o(p,{key:0,prop:"tenantName",label:"租户名称",width:"200"})):f("",!0),["kb_owner","kb_admin"].includes(u.value?.key)?(n(),o(p,{key:1,prop:"kbName",label:"关联知识库",width:"200"})):f("",!0)]),_:1},8,["data"])]),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-884503da"]]),A={class:"role-management"},K={class:"table-header"},R={class:"actions"},U=e({__name:"RoleManagement",setup(e){const t=_(),m="platform",c="kb",y="tenant",f="normal",w={[m]:"平台级",[c]:"知识库级",[y]:"租户级",[f]:"普通级"};a({roleKey:"all",roleType:"all"});const I=a([{id:"r-platform_admin",key:"platform_admin",name:"平台管理员",description:"平台级最高权限，管理全局与租户资源",type:"platform",typeLabel:"平台级",userCount:2,createdAt:"2023-01-15",updatedAt:"2023-09-20",permissions:["全局系统配置","租户管理","用户管理","角色管理"]},{id:"r-super_admin",key:"super_admin",name:"超级管理员",description:"高权限管理员，可管理系统设置与用户",type:"tenant",typeLabel:"租户级",userCount:5,createdAt:"2023-02-01",updatedAt:"2023-09-20",permissions:["系统设置","用户管理","知识库管理","角色管理"]},{id:"r-kb_owner",key:"kb_owner",name:"知识库所有人",description:"负责知识库整体配置与授权",type:"kb",typeLabel:"知识库级",userCount:8,createdAt:"2023-03-10",updatedAt:"2023-09-20",permissions:["知识库配置","知识库授权","知识库成员管理","知识库创建与删除"]},{id:"r-kb_admin",key:"kb_admin",name:"知识库管理员",description:"负责知识库日常管理与维护",type:"kb",typeLabel:"知识库级",userCount:13,createdAt:"2023-04-05",updatedAt:"2023-09-20",permissions:["知识库编辑","知识库成员管理","知识库日常维护"]},{id:"r-user",key:"user",name:"普通用户",description:"普通用户，具备基础使用权限",type:"normal",typeLabel:"普通级",userCount:120,createdAt:"2023-05-20",updatedAt:"2023-09-20",permissions:["基础知识库浏览","基于知识库智能问答","基本操作权限"]}]),V=v(()=>{const e=new Map;return I.value.forEach(l=>{l.key&&l.name&&e.set(l.key,{value:l.key,label:l.name})}),Array.from(e.values())}),C=[{value:m,label:w[m]},{value:c,label:w[c]},{value:y,label:w[y]},{value:f,label:w[f]}];v(()=>I.value);const U=a({roleKey:"all",roleType:"all"}),O=a({roleKey:"all",roleType:"all"}),L=v(()=>I.value.filter(e=>{const l="all"===O.value.roleKey||e.key===O.value.roleKey,a="all"===O.value.roleType||e.type===O.value.roleType;return l&&a})),T=()=>{U.value={roleKey:"all",roleType:"all"},O.value={roleKey:"all",roleType:"all"}},J=()=>{O.value={...U.value}},M=()=>{j.value?.open()},$=e=>{const l=JSON.parse(localStorage.getItem("platformAdmin"))||!1,a=JSON.parse(localStorage.getItem("tenantSuperAdmin"))||!1;return l?!["platform_admin","super_admin"].includes(e.key):!!a&&"super_admin"===e.key},z=e=>{const a=JSON.parse(localStorage.getItem("platformAdmin"))||!1,s=JSON.parse(localStorage.getItem("tenantSuperAdmin"))||!1;if($(e))return void l.warning("您没有权限查看该角色的授权人");const o=F.value,n=a?"platform_admin":s?"super_admin":"user";if("user"===e.key)return void t.push({name:"UsersList"});!1!==o.canOpenAssignees(e,n)?o.open(e):l.warning("您没有权限查看该角色的授权人")},j=a(null),q=a(null),D=a(null),F=a(null),P=()=>{const e=localStorage.getItem("roleManagementStore");if(e){const l=JSON.parse(e);I.value=l.allRoles}};return g(()=>{if(!localStorage.getItem("roleManagementStore")){const e={allRoles:I.value};localStorage.setItem("roleManagementStore",JSON.stringify(e))}}),(e,l)=>{const a=s("el-option"),t=s("el-select"),m=s("el-col"),c=s("el-button"),y=s("el-row"),_=s("el-table-column"),v=s("el-tooltip"),f=s("el-table");return n(),b("div",A,[d(y,{gutter:16},{default:i(()=>[d(m,{span:6},{default:i(()=>[d(t,{modelValue:U.value.roleKey,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value.roleKey=e),placeholder:"选择角色",clearable:"",style:{width:"100%"}},{default:i(()=>[d(a,{label:"全部角色",value:"all"}),(n(!0),b(p,null,k(V.value,e=>(n(),o(a,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(m,{span:6},{default:i(()=>[d(t,{modelValue:U.value.roleType,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value.roleType=e),placeholder:"选择角色类型",clearable:"",style:{width:"100%"}},{default:i(()=>[d(a,{label:"全部类型",value:"all"}),(n(),b(p,null,k(C,e=>d(a,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),d(m,{span:12,class:"text-right"},{default:i(()=>[d(c,{type:"primary",onClick:J},{default:i(()=>l[2]||(l[2]=[u("查询")])),_:1,__:[2]}),d(c,{onClick:T},{default:i(()=>l[3]||(l[3]=[u("重置")])),_:1,__:[3]})]),_:1})]),_:1}),r("div",K,[l[5]||(l[5]=r("div",{class:"title"},"角色列表",-1)),r("div",R,[d(c,{type:"primary",onClick:M},{default:i(()=>l[4]||(l[4]=[u("新建角色")])),_:1,__:[4]})])]),d(f,{data:L.value,style:{width:"100%"},stripe:""},{default:i(()=>[d(_,{prop:"name",label:"角色名",width:"180"}),d(_,{prop:"description",label:"描述","min-width":"240","show-overflow-tooltip":""}),d(_,{prop:"typeLabel",label:"角色类型",width:"140"}),d(_,{prop:"userCount",label:"用户数",width:"100"}),d(_,{label:"操作",width:"260",fixed:"right"},{default:i(({row:e})=>[d(c,{size:"small",onClick:l=>(e=>{q.value?.open(e)})(e)},{default:i(()=>l[6]||(l[6]=[u("角色信息")])),_:2,__:[6]},1032,["onClick"]),d(c,{size:"small",onClick:l=>(e=>{D.value?.open(e)})(e),type:"primary",plain:""},{default:i(()=>l[7]||(l[7]=[u("角色权限")])),_:2,__:[7]},1032,["onClick"]),"user"===e.key?(n(),o(v,{key:0,content:"将跳转到用户管理页面",placement:"top"},{default:i(()=>[d(c,{size:"small",onClick:l=>z(e),type:"success",plain:""},{default:i(()=>l[8]||(l[8]=[u(" 授权人 ")])),_:2,__:[8]},1032,["onClick"])]),_:2},1024)):(n(),o(c,{key:1,size:"small",onClick:l=>z(e),type:"success",plain:"",disabled:$(e)},{default:i(()=>l[9]||(l[9]=[u(" 授权人 ")])),_:2,__:[9]},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data"]),d(h,{ref_key:"createRoleRef",ref:j,onSuccess:P},null,512),d(N,{ref_key:"roleInfoRef",ref:q},null,512),d(S,{ref_key:"rolePermRef",ref:D,onSuccess:P},null,512),d(x,{ref_key:"roleAssigneesRef",ref:F,onSuccess:P},null,512)])}}},[["__scopeId","data-v-f2bc6f5c"]]);export{U as default};
