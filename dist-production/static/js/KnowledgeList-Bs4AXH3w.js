import{r as e,d as a,a as l,b1 as s,U as t,J as n,V as i,K as o,a1 as r,I as c,a0 as d,av as u,N as m,$ as p,Z as g,bS as v,w as f,F as _,bh as h,W as w,u as b,bE as k,ae as y,bc as V}from"./vue-vendor-BUDnSszI.js";import{c as z,u as U,g as C,a as x,d as L}from"./kb-DvJy3p-L.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{aL as S,aK as j}from"./vendor-zcc-V1Og.js";import{c as K}from"./chat-CTPsmCEm.js";import"./index-8D9d6p3q.js";import"./network-vendor-ztdpVPaQ.js";const F={class:"form-container"},q={class:"cover-section"},D={class:"cover-selection"},T=["onClick"],B=["src","alt"],$={class:"cover-name"},A={class:"basic-info-section"},I={class:"params-section"},Y={class:"params-grid"},E={class:"param-item"},O={class:"param-item"},Z={class:"param-item full-width"},H={class:"param-item full-width"},M={class:"dialog-footer"},W=R({__name:"CreateKB",emits:["success"],setup(v,{expose:f,emit:_}){const h=e(!1),w=e(!1),b=a(()=>window.innerWidth<=768),k=a(()=>b.value?"95%":"800px"),y=[{id:1,url:new URL("/static/images/technology-63wFSkzS.png",import.meta.url).href,name:"科技"},{id:2,url:new URL("/static/images/finance-Ck4acTzt.png",import.meta.url).href,name:"金融"},{id:3,url:new URL("/static/images/business-CCn3F5Yw.png",import.meta.url).href,name:"商业"},{id:4,url:new URL("/static/images/design-YZ1VK_EO.png",import.meta.url).href,name:"设计"},{id:5,url:new URL("/static/images/law-DpbzAc8H.png",import.meta.url).href,name:"法规"},{id:6,url:new URL("/static/images/default-CLFpqdAS.png",import.meta.url).href,name:"默认"}],V=l({name:"",description:"",icon:null,chunk_size:100,chunk_overlap:20,separator:"\n\n",embedding_model:"text2vec-base",access_mode:0,vector_store:"faiss",tags:["金融"]}),U={name:[{required:!0,message:"请输入知识库名称",trigger:"blur"}],icon:[{required:!0,message:"请选择封面",trigger:"change"}],access_mode:[{required:!0,message:"请选择访问模式",trigger:"change"}]},C=e(null),x=()=>{Object.assign(V,{name:"",description:"",icon:null,chunk_size:100,chunk_overlap:20,separator:"\n\n",embedding_model:"text2vec-base",access_mode:0,vector_store:"faiss",tags:[]})},L=()=>{h.value=!1,x()},R=()=>{C.value.validate(async e=>{if(e){w.value=!0;try{const e=await z({...V});e?(S.success("知识库创建成功"),h.value=!1,x(),j("success")):S.error(e.message||"创建失败")}catch(a){S.error("创建知识库失败，请重试")}finally{w.value=!1}}})};f({open:()=>{h.value=!0}});const j=_;return(e,a)=>{const l=s("el-form-item"),v=s("el-input"),f=s("el-radio"),_=s("el-radio-group"),z=s("el-option"),x=s("el-select"),S=s("el-input-number"),j=s("el-form"),K=s("el-button"),W=s("el-dialog");return n(),t(W,{modelValue:h.value,"onUpdate:modelValue":a[8]||(a[8]=e=>h.value=e),title:"新建知识库",width:k.value,"before-close":L,fullscreen:b.value,style:{"--el-dialog-border-radius":"12px"}},{footer:i(()=>[o("div",M,[r(K,{onClick:L,size:"large"},{default:i(()=>a[20]||(a[20]=[g("取消")])),_:1,__:[20]}),r(K,{type:"primary",onClick:R,size:"large",loading:w.value},{default:i(()=>[g(p(w.value?"创建中...":"创建知识库"),1)]),_:1},8,["loading"])])]),default:i(()=>[o("div",F,[r(j,{ref_key:"formRef",ref:C,model:V,rules:U,"label-width":"100px"},{default:i(()=>[o("div",q,[a[9]||(a[9]=o("div",{class:"section-title"},[o("span",{class:"title-icon"},"🖼️"),o("span",null,"选择知识库封面")],-1)),r(l,{prop:"icon"},{default:i(()=>[o("div",D,[(n(),c(d,null,u(y,e=>o("div",{key:e.id,class:m(["cover-item",{selected:V.icon===e.id}]),onClick:a=>{return l=e.id,void(V.icon=l);var l}},[o("img",{src:e.url,alt:e.name,class:"cover-image"},null,8,B),o("div",$,p(e.name),1)],10,T)),64))])]),_:1})]),o("div",A,[a[12]||(a[12]=o("div",{class:"section-title"},[o("span",{class:"title-icon"},"📝"),o("span",null,"基本信息")],-1)),r(l,{label:"知识库名称",prop:"name"},{default:i(()=>[r(v,{modelValue:V.name,"onUpdate:modelValue":a[0]||(a[0]=e=>V.name=e),placeholder:"请输入知识库名称",size:"large"},null,8,["modelValue"])]),_:1}),r(l,{label:"描述信息"},{default:i(()=>[r(v,{modelValue:V.description,"onUpdate:modelValue":a[1]||(a[1]=e=>V.description=e),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),r(l,{label:"访问模式",prop:"access_mode"},{default:i(()=>[r(_,{modelValue:V.access_mode,"onUpdate:modelValue":a[2]||(a[2]=e=>V.access_mode=e)},{default:i(()=>[r(f,{label:0},{default:i(()=>a[10]||(a[10]=[g("私有")])),_:1,__:[10]}),r(f,{label:1},{default:i(()=>a[11]||(a[11]=[g("公开")])),_:1,__:[11]})]),_:1},8,["modelValue"])]),_:1}),r(l,{label:"标签"},{default:i(()=>[r(x,{modelValue:V.tags,"onUpdate:modelValue":a[3]||(a[3]=e=>V.tags=e),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"输入或选择标签",style:{width:"100%"}},{default:i(()=>[(n(!0),c(d,null,u(V.tags,e=>(n(),t(z,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),o("div",I,[a[19]||(a[19]=o("div",{class:"section-title"},[o("span",{class:"title-icon"},"⚙️"),o("span",null,"初始化参数设置")],-1)),o("div",Y,[o("div",E,[a[13]||(a[13]=o("label",{class:"param-label"},"分块大小",-1)),r(S,{modelValue:V.chunk_size,"onUpdate:modelValue":a[4]||(a[4]=e=>V.chunk_size=e),min:100,max:5e3,step:100,size:"large"},null,8,["modelValue"]),a[14]||(a[14]=o("span",{class:"param-desc"},"字符数",-1))]),o("div",O,[a[15]||(a[15]=o("label",{class:"param-label"},"重叠大小",-1)),r(S,{modelValue:V.chunk_overlap,"onUpdate:modelValue":a[5]||(a[5]=e=>V.chunk_overlap=e),min:0,max:1e3,step:50,size:"large"},null,8,["modelValue"]),a[16]||(a[16]=o("span",{class:"param-desc"},"字符数",-1))]),o("div",Z,[a[17]||(a[17]=o("label",{class:"param-label"},"分隔符",-1)),r(v,{modelValue:V.separator,"onUpdate:modelValue":a[6]||(a[6]=e=>V.separator=e),placeholder:"例如：\\n\\n",size:"large"},null,8,["modelValue"])]),o("div",H,[a[18]||(a[18]=o("label",{class:"param-label"},"嵌入模型",-1)),r(x,{modelValue:V.embedding_model,"onUpdate:modelValue":a[7]||(a[7]=e=>V.embedding_model=e),placeholder:"选择模型",size:"large",class:"model-select"},{default:i(()=>[r(z,{label:"text2vec-base",value:"text2vec-base"}),r(z,{label:"text2vec-large",value:"text2vec-large"})]),_:1},8,["modelValue"])])])])]),_:1},8,["model"])])]),_:1},8,["modelValue","width","fullscreen"])}}},[["__scopeId","data-v-d99997ae"]]),J={class:"knowledge-base"},N={class:"header"},P={class:"knowledge-list-container"},G={class:"knowledge-list"},Q=["onClick"],X={class:"knowledge-header"},ee={class:"knowledge-info"},ae={class:"knowledge-title"},le={class:"knowledge-description"},se={class:"knowledge-tags"},te={class:"knowledge-footer"},ne={class:"update-time"},ie={class:"el-dropdown-link"},oe={class:"pagination"},re={key:1,class:"empty-state"},ce=R({__name:"KnowledgeList",setup(a){const l=e(""),m=e([]),z=e(!1),R=e(0),F=e(1),q=e(6),D=e(),T=v(),B=U();let $=null;const A={0:new URL("/static/images/technology-63wFSkzS.png",import.meta.url).href,1:new URL("/static/images/finance-Ck4acTzt.png",import.meta.url).href,2:new URL("/static/images/business-CCn3F5Yw.png",import.meta.url).href,3:new URL("/static/images/design-YZ1VK_EO.png",import.meta.url).href,4:new URL("/static/images/law-DpbzAc8H.png",import.meta.url).href,5:new URL("/static/images/default-CLFpqdAS.png",import.meta.url).href},I=e=>{if(!e)return"未知时间";try{const a=new Date(e),l=new Date,s=Math.floor((l-a)/864e5);return 0===s?"今天":1===s?"昨天":s<7?`${s}天前`:s<30?`${Math.floor(s/7)}周前`:a.toLocaleDateString()}catch{return e}},Y=async()=>{z.value=!0;try{const e={page:F.value,page_size:q.value};l.value.trim()&&(e.search=l.value.trim());const a=await C(e);m.value=a.items||[],R.value=a.total||0,B.setKBList(m.value)}catch(e){S.error("获取知识库列表失败"),m.value=[],R.value=0}finally{z.value=!1}};f(l,e=>{$&&clearTimeout($),$=setTimeout(()=>{F.value=1,Y()},500)});const E=e=>{F.value=e,Y()},O=e=>{q.value=e,F.value=1,Y()},Z=()=>{D.value.open(),Y()},H=(e,a)=>{"edit"===e||"delete"===e&&(e=>{j.confirm("确定要删除该知识库吗？此操作不可撤销！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await L(e.id),S.success("删除成功"),Y()}catch(a){S.error("删除失败")}}).catch(()=>{S.info("已取消删除")})})(a)};return _(()=>{Y()}),(e,a)=>{const v=s("el-icon"),f=s("el-input"),_=s("el-button"),U=s("el-avatar"),C=s("el-tag"),L=s("el-dropdown-item"),j=s("el-dropdown-menu"),$=s("el-dropdown"),Y=s("el-pagination"),M=s("el-empty"),ce=h("loading");return n(),c("div",J,[o("div",N,[r(f,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),placeholder:"搜索知识库名称、描述或标签",class:"pill-input search-input",clearable:""},{prefix:i(()=>[r(v,null,{default:i(()=>[r(b(k))]),_:1})]),_:1},8,["modelValue"]),r(_,{type:"primary",onClick:Z,round:"",class:"create-btn"},{default:i(()=>a[4]||(a[4]=[g(" 创建知识库 ")])),_:1,__:[4]})]),r(W,{ref_key:"createDialog",ref:D},null,512),w((n(),c("div",P,[m.value.length>0?(n(),c(d,{key:0},[o("div",G,[(n(!0),c(d,null,u(m.value,e=>{return n(),c("div",{key:e.id,class:"knowledge-card",onClick:a=>(e=>{B.setCurrentKB(e),x(e.id).then(e=>{B.setUserRole(e.role)}).catch(e=>{B.setUserRole(0)}),T.push(`/knowledgebase/${e.id}`)})(e)},[o("div",X,[r(U,{src:(l=e.icon,A[l??5]||A[5]),size:60,class:"item-icon"},null,8,["src"]),o("div",ee,[o("h3",ae,p(e.name),1),o("p",le,p(e.description),1)])]),o("div",se,[(n(!0),c(d,null,u(e.tags,(e,a)=>(n(),t(C,{key:a,size:"small"},{default:i(()=>[g(p(e),1)]),_:2},1024))),128)),r(C,{size:"small",effect:"plain"},{default:i(()=>[g(p(e.status),1)]),_:2},1024)]),o("div",te,[o("span",ne,"最后更新: "+p(I(e.updated_at)),1),r(_,{type:"primary",size:"small",onClick:y(a=>(async e=>{try{const a=await K({title:`${e.name} 的对话`,kb_id:e.id}),l=String(a.chat_id);T.push({path:"/service",query:{chatId:l}})}catch(a){S.error("创建对话失败，请稍后重试")}})(e),["stop"])},{default:i(()=>a[5]||(a[5]=[g(" 开始对话 ")])),_:2,__:[5]},1032,["onClick"])]),o("div",{class:"more-options",onClick:a[1]||(a[1]=y(()=>{},["stop"]))},[r($,{trigger:"click",onCommand:a=>H(a,e)},{dropdown:i(()=>[r(j,null,{default:i(()=>[r(L,{command:"edit"},{default:i(()=>a[6]||(a[6]=[g("编辑")])),_:1,__:[6]}),r(L,{command:"delete"},{default:i(()=>a[7]||(a[7]=[g("删除")])),_:1,__:[7]})]),_:1})]),default:i(()=>[o("span",ie,[r(v,{class:"more-icon"},{default:i(()=>[r(b(V))]),_:1})])]),_:2},1032,["onCommand"])])],8,Q);var l}),128))]),o("div",oe,[r(Y,{"current-page":F.value,"onUpdate:currentPage":a[2]||(a[2]=e=>F.value=e),"page-size":q.value,"onUpdate:pageSize":a[3]||(a[3]=e=>q.value=e),total:R.value,"page-sizes":[6,12,18,24],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:E,onSizeChange:O},null,8,["current-page","page-size","total"])])],64)):(n(),c("div",re,[r(M,{description:l.value?"未找到匹配的知识库":"暂无知识库"},null,8,["description"])]))])),[[ce,z.value]])])}}},[["__scopeId","data-v-d1e5b0ae"]]);export{ce as default};
