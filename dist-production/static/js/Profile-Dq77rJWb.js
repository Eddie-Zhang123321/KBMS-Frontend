import{bS as a,r as e,a as l,d as s,F as t,b1 as r,I as o,J as d,a1 as u,V as n,K as i,u as m,bT as c,aH as v,bq as p,$ as f,Z as g,X as w,a0 as _,av as b,U as h,N as y}from"./vue-vendor-BUDnSszI.js";import{u as V,j as P,k,l as S,m as C}from"./index-8D9d6p3q.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{aK as N,aL as j}from"./vendor-zcc-V1Og.js";import"./network-vendor-ztdpVPaQ.js";const U="/static/images/avatar1-BbFmvARF.jpg",A={class:"profile-page"},x={class:"user-info-section"},B={class:"avatar-section"},J={class:"avatar-container"},O={class:"info-section"},z={class:"info-header"},T={class:"title-section"},q={class:"role-badge"},E={class:"action-buttons"},F={class:"info-details"},D={class:"info-item"},K={class:"value"},M={key:0,class:"info-item"},R={class:"value"},X={class:"info-item"},Z={class:"value"},H={key:1,class:"info-item"},L={class:"value"},W={class:"info-item"},$={class:"value"},G={class:"preferences-section"},Q={class:"preferences-form"},Y={class:"cover-selection"},aa=["onClick"],ea=["src","alt"],la={class:"cover-name"},sa=I({__name:"Profile",setup(I){const sa=a(),ta=V(),ra=[{id:1,name:"头像1",url:U},{id:2,name:"头像2",url:"/static/images/avatar2-Bh4bEuay.jpg"},{id:3,name:"头像3",url:"/static/images/avatar3-BAZJ-hP6.jpg"},{id:4,name:"头像4",url:"/static/images/avatar4-D21nUqCj.jpg"},{id:5,name:"头像5",url:"/static/images/avatar5-BX7MIEmt.jpg"},{id:6,name:"头像6",url:"/static/images/avatar6-BtsMDCIW.jpg"}],oa=U,da=e({}),ua=l({defaultPage:"dashboard",language:"zh-CN",notifications:!0}),na=e(!1),ia=e(!1),ma=e(!1),ca=l({username:"",email:""}),va=l({oldPassword:"",newPassword:"",confirmPassword:""}),pa=e(),fa=s(()=>{const a=[{label:"工作台",value:"dashboard"},{label:"知识库列表",value:"knowledge"}];return(ta.tenantSuperAdmin||ta.platformAdmin)&&a.push({label:"系统管理中心",value:"system"}),ta.platformAdmin&&a.push({label:"租户管理中心",value:"tenant"}),a}),ga={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{validator:(a,e,l)=>{e!==va.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},wa=()=>{const a=[];return ta.platformAdmin&&a.push("平台管理员"),ta.tenantSuperAdmin&&a.push("超级管理员"),0===a.length?"普通用户":a.join("、")},_a=async()=>{try{await N.confirm("确定要退出登录吗？","提示",{type:"warning"}),localStorage.clear(),ta.logout(),sa.push("/login"),j.success("已退出登录")}catch(a){}},ba=async()=>{try{await k({email:ca.email});da.value.email=ca.email;const a=JSON.parse(localStorage.getItem("user")||"{}");a.email=ca.email,localStorage.setItem("user",JSON.stringify(a)),ta.user&&(ta.user.email=ca.email),na.value=!1,j.success("信息更新成功")}catch(a){j.error("更新用户信息失败")}},ha=async()=>{try{await pa.value.validate(),await S({oldPassword:va.oldPassword,newPassword:va.newPassword}),va.oldPassword="",va.newPassword="",va.confirmPassword="",ia.value=!1,j.success("密码修改成功")}catch(a){j.error("修改密码失败")}},ya=async()=>{try{localStorage.setItem("preferences",JSON.stringify(ua)),ta.setPreferences(ua),j.success("偏好设置保存成功")}catch(a){j.error("保存偏好设置失败")}};return t(()=>{(async()=>{try{const a=JSON.parse(localStorage.getItem("user")||"{}"),e=parseInt(localStorage.getItem("avatar"))||1,l=await P();let s=oa,t=e||l.avatar||1;const r=ra.find(a=>a.id===t);s=r?r.url:oa,da.value={id:l.id||ta.user?.id,username:l.username||ta.user?.username||"未知用户",email:a.email||l.email||ta.user?.email||"",tenantName:l.tenantName||ta.tenantName||"—",knowledgeBaseCount:l.knowledgeBaseCount||0,createTime:l.createTime||"—",roles:l.roles||ta.roles||[],avatar:s,avatarId:t},localStorage.setItem("user",JSON.stringify({id:da.value.id,username:da.value.username,email:da.value.email,avatar:t})),localStorage.setItem("avatar",t.toString()),ta.updateUserAvatar(t);const o={defaultPage:"dashboard",language:"zh-CN",notifications:!0};Object.assign(ua,o),localStorage.setItem("preferences",JSON.stringify(o)),ta.setPreferences(o),ca.username=da.value.username,ca.email=da.value.email}catch(a){const e=JSON.parse(localStorage.getItem("user")||"{}"),l=parseInt(localStorage.getItem("avatar"))||1,s=ra.find(a=>a.id===l),t=s?s.url:oa;da.value={id:e.id||ta.user?.id,username:e.username||ta.user?.username||"未知用户",email:e.email||ta.user?.email||"",tenantName:ta.tenantName||"—",knowledgeBaseCount:0,createTime:"—",roles:ta.roles||[],avatar:t,avatarId:l},Object.assign(ua,{defaultPage:"dashboard",language:"zh-CN",notifications:!0}),ca.username=da.value.username,ca.email=da.value.email}})()}),(a,e)=>{const l=r("el-icon"),s=r("el-avatar"),t=r("el-button"),V=r("el-card"),P=r("el-option"),k=r("el-select"),S=r("el-form-item"),I=r("el-radio"),N=r("el-radio-group"),U=r("el-form"),sa=r("el-input"),oa=r("el-dialog");return d(),o("div",A,[u(V,{class:"profile-card"},{default:n(()=>[i("div",x,[i("div",B,[i("div",J,[u(s,{size:80,src:m(ta).userAvatar,class:"user-avatar",onClick:e[0]||(e[0]=a=>ma.value=!0)},{default:n(()=>[u(l,null,{default:n(()=>[u(m(c))]),_:1})]),_:1},8,["src"])]),i("div",{class:"logout-link",onClick:_a},[u(l,null,{default:n(()=>[u(m(v))]),_:1}),e[16]||(e[16]=i("span",null,"退出账号",-1))])]),i("div",O,[i("div",z,[i("div",T,[e[17]||(e[17]=i("h2",null,"用户信息",-1)),i("div",q,[u(l,null,{default:n(()=>[u(m(p))]),_:1}),i("span",null,f(wa()),1)])]),i("div",E,[u(t,{type:"primary",onClick:e[1]||(e[1]=a=>na.value=!0)},{default:n(()=>e[18]||(e[18]=[g(" 修改信息 ")])),_:1,__:[18]}),u(t,{type:"primary",onClick:e[2]||(e[2]=a=>ia.value=!0)},{default:n(()=>e[19]||(e[19]=[g(" 修改密码 ")])),_:1,__:[19]})])]),i("div",F,[i("div",D,[e[20]||(e[20]=i("span",{class:"label"},"用户名：",-1)),i("span",K,f(da.value.username),1)]),m(ta).platformAdmin?w("",!0):(d(),o("div",M,[e[21]||(e[21]=i("span",{class:"label"},"所属租户：",-1)),i("span",R,f(da.value.tenantName||"—"),1)])),e[25]||(e[25]=i("div",{class:"info-item"},[i("span",{class:"label"},"密码："),i("span",{class:"value"},"******")],-1)),i("div",X,[e[22]||(e[22]=i("span",{class:"label"},"邮箱：",-1)),i("span",Z,f(da.value.email),1)]),m(ta).platformAdmin?w("",!0):(d(),o("div",H,[e[23]||(e[23]=i("span",{class:"label"},"加入知识库：",-1)),i("span",L,f(da.value.knowledgeBaseCount||0)+"个 ",1)])),i("div",W,[e[24]||(e[24]=i("span",{class:"label"},"加入时间：",-1)),i("span",$,f(da.value.createTime||"—"),1)])])])])]),_:1}),u(V,{class:"preferences-card"},{default:n(()=>[i("div",G,[e[29]||(e[29]=i("h3",null,"偏好设置",-1)),i("div",Q,[u(U,{model:ua,"label-width":"120px"},{default:n(()=>[u(S,{label:"默认进入页面："},{default:n(()=>[u(k,{modelValue:ua.defaultPage,"onUpdate:modelValue":e[3]||(e[3]=a=>ua.defaultPage=a),placeholder:"请选择默认页面"},{default:n(()=>[(d(!0),o(_,null,b(fa.value,a=>(d(),h(P,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(S,{label:"系统语言："},{default:n(()=>[u(k,{modelValue:ua.language,"onUpdate:modelValue":e[4]||(e[4]=a=>ua.language=a),placeholder:"请选择语言"},{default:n(()=>[u(P,{label:"中文",value:"zh-CN"}),u(P,{label:"English",value:"en-US"})]),_:1},8,["modelValue"])]),_:1}),u(S,{label:"接收通知："},{default:n(()=>[u(N,{modelValue:ua.notifications,"onUpdate:modelValue":e[5]||(e[5]=a=>ua.notifications=a)},{default:n(()=>[u(I,{value:!0},{default:n(()=>e[26]||(e[26]=[g("开启")])),_:1,__:[26]}),u(I,{value:!1},{default:n(()=>e[27]||(e[27]=[g("关闭")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1}),u(S,null,{default:n(()=>[u(t,{type:"primary",onClick:ya},{default:n(()=>e[28]||(e[28]=[g("保存设置")])),_:1,__:[28]})]),_:1})]),_:1},8,["model"])])])]),_:1}),u(oa,{modelValue:na.value,"onUpdate:modelValue":e[9]||(e[9]=a=>na.value=a),title:"修改信息",width:"500px"},{footer:n(()=>[u(t,{onClick:e[8]||(e[8]=a=>na.value=!1)},{default:n(()=>e[30]||(e[30]=[g("取消")])),_:1,__:[30]}),u(t,{type:"primary",onClick:ba},{default:n(()=>e[31]||(e[31]=[g("确定")])),_:1,__:[31]})]),default:n(()=>[u(U,{model:ca,"label-width":"100px"},{default:n(()=>[u(S,{label:"用户名"},{default:n(()=>[u(sa,{modelValue:ca.username,"onUpdate:modelValue":e[6]||(e[6]=a=>ca.username=a),disabled:""},null,8,["modelValue"])]),_:1}),u(S,{label:"邮箱"},{default:n(()=>[u(sa,{modelValue:ca.email,"onUpdate:modelValue":e[7]||(e[7]=a=>ca.email=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),u(oa,{modelValue:ia.value,"onUpdate:modelValue":e[14]||(e[14]=a=>ia.value=a),title:"修改密码",width:"500px"},{footer:n(()=>[u(t,{onClick:e[13]||(e[13]=a=>ia.value=!1)},{default:n(()=>e[32]||(e[32]=[g("取消")])),_:1,__:[32]}),u(t,{type:"primary",onClick:ha},{default:n(()=>e[33]||(e[33]=[g("确定")])),_:1,__:[33]})]),default:n(()=>[u(U,{model:va,"label-width":"100px",rules:ga,ref_key:"passwordFormRef",ref:pa},{default:n(()=>[u(S,{label:"原密码",prop:"oldPassword"},{default:n(()=>[u(sa,{modelValue:va.oldPassword,"onUpdate:modelValue":e[10]||(e[10]=a=>va.oldPassword=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),u(S,{label:"新密码",prop:"newPassword"},{default:n(()=>[u(sa,{modelValue:va.newPassword,"onUpdate:modelValue":e[11]||(e[11]=a=>va.newPassword=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),u(S,{label:"确认密码",prop:"confirmPassword"},{default:n(()=>[u(sa,{modelValue:va.confirmPassword,"onUpdate:modelValue":e[12]||(e[12]=a=>va.confirmPassword=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),u(oa,{modelValue:ma.value,"onUpdate:modelValue":e[15]||(e[15]=a=>ma.value=a),title:"选择头像",width:"400px"},{default:n(()=>[i("div",Y,[(d(),o(_,null,b(ra,a=>i("div",{key:a.id,class:y(["cover-item",{selected:da.value.avatarId===a.id}]),onClick:e=>(async a=>{try{const e=ra.find(e=>e.id===a);if(!e)return void j.error("头像选择失败");await C({avatar:a}),da.value.avatar=e.url,da.value.avatarId=a,ta.updateUserAvatar(a),ma.value=!1,j.success("头像更新成功")}catch(e){j.error("更新头像失败")}})(a.id)},[i("img",{src:a.url,alt:a.name,class:"cover-image"},null,8,ea),i("div",la,f(a.name),1)],10,aa)),64))])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-33bdd0fa"]]);export{sa as default};
